{"id":"northstar-0be","title":"Translate the dashboard widgets","description":"The dashboard page widgets are still mainly hardcoded strings. They need to following the internalitzation pattern established accross the codebase and translated the suitable strings. Mainly UI components and layout at the present moment.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T12:28:42.274869-03:00","created_by":"caiodgallo","updated_at":"2026-01-02T14:11:27.158751-03:00","closed_at":"2026-01-02T14:11:27.158751-03:00","close_reason":"Closed"}
{"id":"northstar-0c8","title":"Phase 4: Translate file-dropzone component","description":"Phase 4: Translate file-dropzone component\n\nFile: components/import-expenses/file-dropzone.tsx\n\nThis component has hardcoded strings that need translation:\n- Error messages ('Please select a CSV file', 'Failed to read file')\n- Drag and drop text\n\nSteps:\n1. Add useTranslations('fileDropzone') hook\n2. Replace all hardcoded strings with t() calls\n3. Add missing translation keys to messages/en.json and messages/pt-BR.json\n4. Verify dropzone works correctly in both languages\n\nExample translation key structure (already exists in messages):\nfileDropzone.invalidFileType, fileDropzone.failedToRead, fileDropzone.dragAndDropText","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T07:06:45.504066-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T09:58:48.749442-03:00","closed_at":"2026-01-05T09:58:48.749442-03:00","close_reason":"Closed"}
{"id":"northstar-0pt","title":"Phase 4: Translate category-form component","description":"Phase 4: Translate category-form component\n\nFile: components/category-form.tsx\n\nThis component has hardcoded strings that need translation:\n- Form labels (Name, Color, Icon)\n- Buttons (Save, Cancel, Create, Update, Saving...)\n- Error messages\n\nSteps:\n1. Add useTranslations('categoryForm') hook\n2. Replace all hardcoded strings with t() calls\n3. Add missing translation keys to messages/en.json and messages/pt-BR.json\n4. Verify form works correctly in both languages\n\nExample translation key structure (already exists in messages):\ncategoryForm.name, categoryForm.color, categoryForm.icon, categoryForm.save, etc.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T07:06:44.602898-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T09:58:48.441613-03:00","closed_at":"2026-01-05T09:58:48.441613-03:00","close_reason":"Closed"}
{"id":"northstar-0qa","title":"Tests: Dashboard - Test components and edge cases","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T10:27:33.121251-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T10:27:33.121251-03:00","dependencies":[{"issue_id":"northstar-0qa","depends_on_id":"northstar-797","type":"blocks","created_at":"2026-01-05T10:46:49.242092-03:00","created_by":"caiodgallo"}],"comments":[{"id":7,"issue_id":"northstar-0qa","author":"caiodgallo","text":"# User Journey: Dashboard Components\n\n## Components to Test\n\nThis focuses on testing the React components that display dashboard data. Component testing is lower priority than server action testing, but important for edge cases and user experience.\n\n### 1. BalanceSummary Component\n\n**Location:** `/components/balance-summary.tsx`\n\n**Tests:**\n\n- **Display Tests:**\n  - Shows total income, expenses, and net balance\n  - Colors: Green for positive balance, Red for negative\n  - Progress bar shows percentage of income spent\n  - Handles zero values correctly\n\n- **Edge Cases:**\n  - Zero income, zero expenses → shows 0, progress = 0%\n  - Zero income, positive expenses → division by zero (handle gracefully)\n  - Positive income, zero expenses → progress = 0%, full green bar\n  - Income = expenses → progress = 100%, net balance = 0\n  - Expenses \u003e income → negative balance, progress \u003e 100% (red)\n  - Very large amounts → formatted correctly (currency)\n\n- **Internationalization:**\n  - Displays correctly in English\n  - Displays correctly in Portuguese\n  - Currency formatting (R$ with correct decimal separator)\n\n### 2. SummaryCard Component\n\n**Location:** `/components/summary-card.tsx`\n\n**Tests:**\n\n- **Display Tests:**\n  - Shows total spent, total budget, remaining\n  - Progress bar: Red (\u003e100%), Yellow (80-100%), Green (\u003c80%)\n  - Remaining = budget - spent\n  - Handles over budget (negative remaining)\n\n- **Edge Cases:**\n  - Budget = 0, spent \u003e 0 → over budget\n  - Spent = 0, budget \u003e 0 → all remaining\n  - Spent = 0, budget = 0 → shows zeros\n  - Spent \u003e budget → negative remaining, red progress bar\n  - Spent = budget → zero remaining, yellow progress bar\n  - Missing budget (null) → handle gracefully\n  - Very large amounts → formatted correctly\n\n- **Color Coding:**\n  - spent/budget \u003c 0.8 → green\n  - spent/budget = 0.8-1.0 → yellow\n  - spent/budget \u003e 1.0 → red\n  - Test exact boundary values (0.8, 1.0)\n\n### 3. BudgetProgress Component\n\n**Location:** `/components/budget-progress.tsx`\n\n**Tests:**\n\n- **Display Tests:**\n  - Shows category icon, name, spent, budget\n  - Shows percentage\n  - Progress bar: Red (\u003e100%), Yellow (80-100%), Green (\u003c80%)\n  - Icon colored with category color\n\n- **Edge Cases:**\n  - Budget = 0, spent \u003e 0 → infinite percentage (handle gracefully)\n  - Spent = 0, budget \u003e 0 → 0% progress\n  - Spent = budget → 100% progress\n  - Spent \u003e budget → \u003e100% progress, red bar\n  - Missing budget (null) → show spent only? or 0?\n  - Missing icon → show default or nothing\n\n- **Icon Display:**\n  - Renders correct icon for category\n  - Applies category color to icon background\n  - Handles null icon gracefully\n\n- **Percentage Calculation:**\n  - Math.round() for display\n  - Test rounding edge cases (49.5%, 50.5%)\n\n### 4. RecentExpenses Component\n\n**Location:** `/components/recent-expenses.tsx`\n\n**Tests:**\n\n- **Display Tests:**\n  - Shows list of 5 most recent expenses\n  - Each item: icon, description, category name, account name, amount, date\n  - Links to full expenses page\n  - Empty state when no expenses exist\n\n- **Edge Cases:**\n  - No expenses → shows empty state message\n  - 1 expense → shows 1 item\n  - 5 expenses → shows 5 items\n  - \u003e5 expenses → shows only 5 most recent\n  - Expense without icon → handles gracefully\n  - Expense with very long description → truncates or wraps?\n  - Expense with very large amount → formatted correctly\n\n- **Ordering:**\n  - Verify ordered by createdAt DESC (most recent first)\n  - Test with expenses created at different times\n\n- **Link Navigation:**\n  - Clicking expense navigates to /expenses page\n  - Verifies query params are correct (month filter)\n\n### 5. MonthPicker Component\n\n**Location:** `/components/month-picker.tsx`\n\n**Tests:**\n\n- **Display Tests:**\n  - Shows current month name in Portuguese\n  - Previous/Next navigation buttons\n  - Prefetches adjacent months for performance\n\n- **Navigation:**\n  - Clicking \"Previous\" → goes to previous month\n  - Clicking \"Next\" → goes to next month\n  - Updates URL query param for yearMonth\n  - Navigates to correct route\n\n- **Date Arithmetic:**\n  - Jan → Previous → Dec previous year\n  - Dec → Next → Jan next year\n  - Feb 28 → Previous → Jan\n  - Test leap year (Feb 29)\n\n- **Internationalization:**\n  - Month names in Portuguese (janeiro, fevereiro, etc.)\n  - Correct formatting\n\n### Integration Tests\n\n#### 6. Dashboard Page Component\n\n**Location:** `/app/(app)/dashboard/page.tsx`\n\n**Tests:**\n\n- **Data Fetching:**\n  - Calls getDashboardData with correct yearMonth\n  - Uses URL query param or current month\n  - Renders with fetched data\n  - Shows loading state while fetching\n\n- **Component Integration:**\n  - BalanceSummary receives correct props\n  - SummaryCard receives correct props\n  - BudgetProgress cards receive correct props\n  - RecentExpenses receives correct props\n\n- **Empty States:**\n  - No budgets → shows message with link to settings\n  - No expenses → RecentExpenses shows empty state\n  - No income → BalanceSummary shows 0 income\n\n- **Month Navigation:**\n  - MonthPicker updates URL\n  - Dashboard refetches data for new month\n  - Components update with new data\n\n- **Responsive Layout:**\n  - Mobile: single column layout\n  - Desktop: 3-column grid (lg:grid-cols-3)\n  - Correct responsive classes applied\n\n### Loading States\n\n#### 7. Dashboard Loading Skeleton\n\n**Location:** `/app/(app)/dashboard/loading.tsx`\n\n**Tests:**\n\n- Shows skeleton placeholders\n- Matches final layout structure\n- Correct number of skeleton items\n- Renders while data is loading\n\n### Edge Cases \u0026 Error Handling\n\n#### 8. Data Validation\n\n- Missing data fields (null/undefined) → handle gracefully\n- Unexpected data types → handle or show error\n- Very large numbers → formatted correctly\n- Negative values where unexpected → handle appropriately\n\n#### 9. Internationalization\n\n- All components use useTranslations() hook\n- Test switching between pt-BR and en\n- All text displays in correct language\n- Currency formatting uses locale (R$, comma for decimals)\n\n#### 10. Accessibility\n\n- Semantic HTML elements\n- ARIA labels where appropriate\n- Keyboard navigation works\n- Color contrast is adequate\n- Screen reader compatibility\n\n### Test File Location\n`/test/components/dashboard.test.ts`\n\n### Implementation Notes\n- Use React Testing Library (@testing-library/react)\n- Use Vitest with happy-dom environment\n- Mock server actions (getDashboardData)\n- Test component rendering, props, and user interactions\n- Test edge cases with different data scenarios\n- Test internationalization (both pt-BR and en)\n- Component testing is lower priority than server action testing\n- Focus on critical edge cases and user experience\n- Don't test shadcn/ui components (they're tested by the library)\n","created_at":"2026-01-05T13:43:32Z"}]}
{"id":"northstar-110","title":"Fix: FAB modal shows 'Saving...' instead of optimistic UI","description":"## Problem\nThe FAB (Floating Action Button) and BottomTabBar modals show \"Saving...\" and wait for server response when creating expenses/income. They don't use optimistic UI like the list pages do.\n\n## Root Cause\nReact Context flows DOWN the component tree, not UP. Architecture issue:\n\n```\nLayout (app/(app)/layout.tsx)\n├── SidebarInset\n│   └── {children}  ← ExpenseListProvider/IncomeListProvider live HERE (page level)\n├── FAB (lines 38-43)\n│   └── TransactionForm  ← OUTSIDE providers, context = null\n└── BottomTabBar (lines 46-50)\n    └── TransactionForm  ← OUTSIDE providers, context = null\n```\n\n## What Happens\n1. User clicks FAB → opens TransactionForm\n2. `useExpenseContextOptional()` returns `null` (not inside provider)\n3. Falls back to: `await createExpense(data)` (line 137 in transaction-form.tsx)\n4. This IS blocking - modal waits for server\n5. \"Saving...\" persists until server completes\n\n## Solution: Fire-and-Forget in Form\nMake TransactionForm fire-and-forget when creating NEW items without context.\n\n**File: components/transaction-form.tsx**\n\nChange lines 136-138 from:\n```typescript\n} else {\n  await createExpense(data);  // BLOCKING\n}\n```\n\nTo:\n```typescript\n} else {\n  createExpense(data).catch(() =\u003e {\n    toast.error('Failed to create expense');\n  });\n}\n```\n\nSame for income (lines 165-167).\n\n## Files Involved\n- `components/transaction-form.tsx` - Form submission logic\n- `components/fab.tsx` - Desktop FAB (renders form outside context)\n- `components/bottom-tab-bar.tsx` - Mobile FAB (renders form outside context)\n- `lib/contexts/expense-context.tsx` - Optimistic context (works correctly)\n- `lib/contexts/income-context.tsx` - Optimistic context (works correctly)\n- `app/(app)/layout.tsx` - Where FAB/BottomTabBar mount\n- `app/(app)/expenses/page.tsx` - Where ExpenseListProvider lives\n- `app/(app)/income/page.tsx` - Where IncomeListProvider lives\n\n## Alternative Solutions\n1. Move providers to layout level (more complex, requires layout data fetching)\n2. Pass server actions as props to FAB (messy prop drilling)\n3. Use global state management (overkill for this)\n\nFire-and-forget in form is simplest - ~10 line change.\n\n## Testing Checklist\n- [ ] FAB from dashboard (no context) - closes immediately\n- [ ] FAB from expenses page (has context) - uses optimistic flow\n- [ ] Mobile bottom tab bar - closes immediately\n- [ ] Error toast shows on failure\n- [ ] Success case: data appears after revalidation\n- [ ] Edit mode still awaits (important!)","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-04T07:28:53.698397-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T07:07:06.337665-03:00","closed_at":"2026-01-05T07:07:06.337665-03:00","close_reason":"Fixed by removing FAB and moving transaction forms to page-level buttons inside provider context. Forms now use optimistic updates via useExpenseContext/useIncomeContext."}
{"id":"northstar-1y5","title":"Add fileDropzone namespace to en.json and pt-BR.json","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:03.598381-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T07:20:20.295131-03:00","closed_at":"2026-01-05T07:20:20.295131-03:00","close_reason":"Closed"}
{"id":"northstar-1z8","title":"Build: next build fails with null hash","description":"pnpm build fails with uncaughtException TypeError: Cannot read properties of null (reading 'hash') after serwist bundling; build exits 1. Investigate stack trace / culprit (possibly service worker or Next build plugin).","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-05T11:02:48.451065-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T11:02:52.592667-03:00"}
{"id":"northstar-20d","title":"[BUG] Manually created expense setting date to the wrong month","description":"When creating an expense (maybe an income also) if I set the purchase date to 31 Dec 2025, the purchase date actually appears as 31 Jan 2026 (my current year month). So the day looks correct but month/year wrong","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-03T05:45:31.582448-03:00","created_by":"caiodgallo","updated_at":"2026-01-03T06:02:53.604548-03:00","closed_at":"2026-01-03T06:02:53.604548-03:00","close_reason":"Closed"}
{"id":"northstar-2d6","title":"Add resetPassword namespace to en.json and pt-BR.json","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:02.722523-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T07:20:24.627128-03:00","closed_at":"2026-01-05T07:20:24.627128-03:00","close_reason":"forgotPassword and resetPassword namespaces already exist with complete translations"}
{"id":"northstar-2m9","title":"Lint: Fix edit-transaction-dialog warnings","description":"pnpm lint fails in components/edit-transaction-dialog.tsx: unused Income import and react-hooks/set-state-in-effect at line 51; refactor to avoid setState inside useEffect or suppress.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T11:02:22.213014-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T11:02:27.05973-03:00"}
{"id":"northstar-2v2","title":"Phase 3: Translate faturas.ts server action errors","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:29.971636-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T09:47:32.122806-03:00","closed_at":"2026-01-05T09:47:32.122806-03:00","close_reason":"Closed"}
{"id":"northstar-3hz","title":"Phase 3: Translate categories.ts server action errors","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:28.706789-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T09:41:05.830333-03:00","closed_at":"2026-01-05T09:41:05.830333-03:00","close_reason":"Closed"}
{"id":"northstar-42h","title":"Open add expense/income modal with keyboard open and amount input focused","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-03T18:10:44.464737-03:00","created_by":"caiodgallo","updated_at":"2026-01-03T18:15:09.494299-03:00","closed_at":"2026-01-03T18:15:09.494299-03:00","close_reason":"Closed"}
{"id":"northstar-4nv","title":"Translate the Categories page","description":"The Categories page is still mainly hardcoded strings. They need to following the internalitzation pattern established accross the codebase and translated the suitable strings. Mainly UI components and layout at the present moment.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T12:32:43.104249-03:00","created_by":"caiodgallo","updated_at":"2026-01-02T14:51:32.644368-03:00","closed_at":"2026-01-02T14:51:32.644368-03:00","close_reason":"Closed"}
{"id":"northstar-5b3","title":"Phase 4: Translate theme-toggle components","description":"Phase 4: Translate theme-toggle components\n\nFiles: \n- components/theme-toggle.tsx (66 lines)\n- components/theme-toggle-row.tsx (73 lines)\n\nHardcoded strings to translate:\n- Theme labels: 'System', 'Light', 'Dark' (line 58 in both files)\n\nThese keys already exist in messages:\ntheme.system, theme.light, theme.dark\n\nSteps:\n1. Add useTranslations('theme') hook to both components\n2. Replace the ternary operator theme label (line 58) with: t(theme)\n3. Verify theme switching works correctly in both languages\n4. Test in sidebar toggle (ThemeToggle) and settings row (ThemeToggleRow)\n\nNote: The components are small and only have these 3 theme labels hardcoded.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T07:06:45.957295-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T09:58:48.29119-03:00","closed_at":"2026-01-05T09:58:48.29119-03:00","close_reason":"Closed"}
{"id":"northstar-6b4","title":"Add click animation to 'popout' and 'hollow' Button variants on mobile","description":"Use the same animation as the current hover on desktop, but for the click on the mobile. FAB has something like this.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-03T18:12:20.993885-03:00","created_by":"caiodgallo","updated_at":"2026-01-03T18:17:42.51772-03:00","closed_at":"2026-01-03T18:17:42.51772-03:00","close_reason":"Closed"}
{"id":"northstar-797","title":"Tests: Dashboard - Test getDashboardData server action","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-05T10:27:31.862122-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T10:27:31.862122-03:00","dependencies":[{"issue_id":"northstar-797","depends_on_id":"northstar-th0","type":"blocks","created_at":"2026-01-05T10:46:48.902638-03:00","created_by":"caiodgallo"}],"comments":[{"id":1,"issue_id":"northstar-797","author":"caiodgallo","text":"# User Journey: Dashboard Data\n\n## Server Action: `getDashboardData(yearMonth)` (/lib/actions/dashboard.ts)\n\n### Happy Path Tests\n\n1. **Empty State**\n   - Month with no expenses, income, or budgets\n   - Verify returns zeros for all totals\n   - Verify empty categoryBreakdown array\n   - Verify empty recentExpenses/recentIncome arrays\n\n2. **Expenses Only**\n   - Month with multiple expenses across different categories\n   - Verify totalSpent is correct sum\n   - Verify categoryBreakdown has correct spent amounts per category\n   - Verify recentExpenses ordered by createdAt DESC (most recent first)\n   - Verify totalBudget is 0, totalIncome is 0\n\n3. **Income Only**\n   - Month with multiple income entries\n   - Verify totalIncome is correct sum\n   - Verify recentIncome ordered by createdAt DESC\n   - Verify totalSpent is 0, netBalance equals totalIncome\n\n4. **Budgets Without Spending**\n   - Month with budgets but no expenses\n   - Verify totalBudget is correct sum\n   - Verify categoryBreakdown shows budget amounts with spent=0\n   - Verify totalSpent is 0\n\n5. **Partial Budgets**\n   - Some categories have budgets, some don't\n   - Verify categoryBreakdown includes all spending categories (even without budgets)\n   - Verify categories with budgets show correct budget amounts\n   - Verify categories without budgets have budget=null or 0\n\n6. **Complete Scenario**\n   - Month with expenses, income, and budgets\n   - Verify all totals are correct (totalSpent, totalBudget, totalIncome, netBalance)\n   - Verify netBalance = totalIncome - totalSpent\n   - Verify categoryBreakdown aggregation is correct\n   - Verify recent lists are correctly ordered\n\n### Edge Case Tests\n\n1. **Month Boundary Handling**\n   - Expenses on first day of month (2025-01-01)\n   - Expenses on last day of month (2025-01-31)\n   - Income crossing month boundaries\n   - Verify date filtering uses correct ranges (inclusive)\n\n2. **Installment Expenses**\n   - Multiple installments of same transaction across months\n   - Verify only entries for current month are counted\n   - Verify installment amounts are correct\n\n3. **Spending Calculation Logic**\n   - Verify expenses filtered by purchaseDate (budget impact), NOT dueDate\n   - Verify credit card entries with different faturaMonth are handled correctly\n   - Test with entries where faturaMonth != purchaseDate month\n\n4. **Rounding and Money Handling**\n   - Test with amounts that don't divide evenly\n   - Verify all calculations in cents, converted correctly\n   - Test with very large amounts\n\n5. **Multiple Accounts**\n   - Expenses across multiple accounts (credit card, checking, cash)\n   - Verify aggregation includes all accounts\n   - Verify account names in recent lists are correct\n\n6. **Categories Without Spending**\n   - Categories with budgets but no spending\n   - Verify they appear in categoryBreakdown with spent=0\n\n7. **Recent Lists Limit**\n   - Create \u003e5 expenses in month\n   - Verify only most recent 5 returned\n   - Verify ordering is correct\n\n### Integration Tests\n\n1. **Dashboard Revalidation**\n   - Create expense → dashboard revalidated\n   - Update expense → dashboard revalidated\n   - Delete expense → dashboard revalidated\n   - Verify cache is invalidated properly\n\n2. **Multi-Month Data**\n   - Create expenses in Jan and Feb\n   - Query Jan → only Jan data returned\n   - Query Feb → only Feb data returned\n   - Verify months don't leak into each other\n\n3. **User Isolation**\n   - Create data for two users\n   - Query each user's dashboard\n   - Verify no data leakage between users\n\n### Test File Location\n`/test/lib/actions/dashboard.test.ts`\n\n### Implementation Notes\n- Use existing fixtures and helper functions\n- Mock auth with test user ID\n- Use in-memory PGlite database\n- Follow pattern from expenses.test.ts and income.test.ts\n","created_at":"2026-01-05T13:39:56Z"}]}
{"id":"northstar-7ax","title":"Lint: fix edit-transaction-dialog lint errors","description":"ESLint fails in components/edit-transaction-dialog.tsx: unused Income import and react-hooks/set-state-in-effect error (setTransaction in effect).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T11:09:56.321979-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T11:10:02.55349-03:00"}
{"id":"northstar-8qt","title":"Tests: Faturas - Test billing cycle calculations and edge cases","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T10:27:33.359526-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T10:27:33.359526-03:00","comments":[{"id":6,"issue_id":"northstar-8qt","author":"caiodgallo","text":"# User Journey: Faturas Billing Cycle Calculations\n\n## Utilities: `/lib/fatura-utils.ts`\n\nThese tests focus on the core billing cycle logic that determines which fatura an expense belongs to and when it's due. This is critical for Brazilian credit card billing.\n\n### Core Logic Tests\n\n#### 1. `getFaturaMonth(purchaseDate, closingDay)`\n- **Closing day logic:**\n  - Purchase on closing day → belongs to current month's fatura\n  - Purchase before closing day → belongs to current month's fatura\n  - Purchase after closing day → belongs to next month's fatura\n\n- **Edge Cases:**\n  - closingDay = 1 → all purchases go to next month (except day 1)\n  - closingDay = 28 → all purchases go to current month (except after 28)\n  - closingDay = 15 → mid-month split\n  - Purchase on day 1 with closingDay=1 → current month\n  - Purchase on day 1 with closingDay=15 → current month\n  - Purchase on day 15 with closingDay=15 → current month\n  - Purchase on day 16 with closingDay=15 → next month\n  - Purchase on day 31 with closingDay=28 → next month\n\n- **Month Boundary:**\n  - Jan 31, closingDay=15 → Feb fatura (\"2025-02\")\n  - Jan 15, closingDay=15 → Jan fatura (\"2025-01\")\n  - Jan 14, closingDay=15 → Jan fatura (\"2025-01\")\n  - Dec 31, closingDay=15 → Jan next year fatura (\"2026-01\")\n\n- **Timezone Handling:**\n  - Use UTC methods to avoid timezone issues\n  - Test with different dates to ensure consistency\n\n#### 2. `getFaturaPaymentDueDate(faturaMonth, paymentDueDay, closingDay)`\n- **Payment due date logic:**\n  - If paymentDueDay \u003c= closingDay → due NEXT month\n  - If paymentDueDay \u003e closingDay → due SAME month\n\n- **Edge Cases:**\n  - paymentDueDay = 5, closingDay = 15 → due next month\n  - paymentDueDay = 12, closingDay = 5 → due same month\n  - paymentDueDay = closingDay → due next month (equal case)\n\n- **Month Boundary:**\n  - Fatura \"2025-01\", closingDay=15, paymentDueDay=5 → due \"2025-02-05\"\n  - Fatura \"2025-01\", closingDay=5, paymentDueDay=12 → due \"2025-01-12\"\n  - Fatura \"2025-12\", closingDay=15, paymentDueDay=5 → due \"2026-01-05\"\n\n- **Day Validation:**\n  - paymentDueDay in range 1-28 (valid)\n  - paymentDueDay = 29, 30, 31 → handle month with fewer days (should work or fail?)\n  - Test with different month lengths (Feb=28, Apr=30, etc.)\n\n### Integration Tests with Expenses\n\n#### 3. Purchase Date to Fatura Month Mapping\n- Create expense on Jan 10, closingDay=15 → fatura \"2025-01\"\n- Create expense on Jan 20, closingDay=15 → fatura \"2025-02\"\n- Verify entry.faturaMonth is set correctly\n- Verify fatura record exists for that month\n\n#### 4. Due Date Calculation on Expense Creation\n- Create expense → verify entry.dueDate is correct\n- Check against account's billing config\n- Verify matches getFaturaPaymentDueDate calculation\n\n#### 5. Installment Expenses and Fatura Months\n- 3-installment expense on Jan 10, closingDay=15:\n  - Installment 1 (Jan) → fatura \"2025-01\"\n  - Installment 2 (Feb) → fatura \"2025-02\"\n  - Installment 3 (Mar) → fatura \"2025-03\"\n- Verify each entry has correct faturaMonth\n- Verify each entry has correct dueDate based on its faturaMonth\n\n#### 6. Multi-Month Installment Spanning Closing Day\n- Expense on Jan 20 (after closing day), 3 installments, closingDay=15:\n  - Purchase date: Jan 20 → fatura \"2025-02\"\n  - Installment 1 (Feb) → fatura \"2025-02\"\n  - Installment 2 (Mar) → fatura \"2025-03\"\n  - Installment 3 (Apr) → fatura \"2025-04\"\n- Verify each month's faturaMonth is correct\n\n### Edge Case Scenarios\n\n#### 7. First and Last Day of Month\n- Purchase on Jan 1, closingDay=1 → fatura \"2025-01\" (on closing day = current)\n- Purchase on Jan 1, closingDay=15 → fatura \"2025-01\"\n- Purchase on Jan 31, closingDay=28 → fatura \"2025-02\" (after closing day)\n- Purchase on Jan 31, closingDay=31 (if allowed) → fatura \"2025-01\"\n\n#### 8. Year Boundaries\n- Dec 31, closingDay=15 → Jan next year fatura\n- Jan 1, closingDay=28 → Jan fatura\n- Verify year rollover handled correctly\n\n#### 9. Leap Years\n- Feb 28, closingDay=15 → Feb fatura\n- Feb 29, closingDay=15 → Mar fatura (in leap year)\n- Verify leap year handling\n\n#### 10. No Billing Config (Fallback)\n- Account without closingDay/paymentDueDay\n- Use default closingDay=15? (check implementation)\n- Use default paymentDueDay=7? (check implementation)\n- Or use different fallback logic?\n- Test fallback behavior\n\n### Real-World Scenarios\n\n#### 11. Common Brazilian Billing Cycles\n- Nubank: closingDay=5, paymentDueDay=15 (same month due)\n- Itaú: closingDay=15, paymentDueDay=5 (next month due)\n- Test with common configs\n\n#### 12. Expense Updates Affecting Faturas\n- Create expense Jan 10 (fatura Jan)\n- Update to Jan 20 (after closing day) → fatura changes to Feb\n- Old fatura (Jan) total decreased, new fatura (Feb) total increased\n- Verify both faturas updated correctly\n\n#### 13. Expense Deletion Affecting Faturas\n- Create expense → fatura total increased\n- Delete expense → fatura total decreased\n- If last entry → fatura total = 0\n\n### Formatting Tests\n\n#### 14. `formatFaturaMonthWithLocale(yearMonth, locale)`\n- Format \"2025-01\" in pt-BR → \"janeiro de 2025\"\n- Format \"2025-01\" in en → \"January 2025\"\n- Test all 12 months in both locales\n- Verify locale-specific formatting\n\n### Data Consistency Tests\n\n#### 15. Fatura Month vs Purchase Date\n- Verify faturaMonth can be different from purchaseDate month\n- This is expected behavior due to billing cycles\n- Budget tracking uses purchaseDate month\n- Fatura grouping uses faturaMonth\n- Both serve different purposes\n\n#### 16. Fatura Uniqueness\n- Try to create duplicate fatura for same account+month\n- Verify unique constraint prevents duplicates\n- ensureFaturaExists should not create duplicates\n\n#### 17. Entry-Fatura Consistency\n- Verify all entries for account+month have correct faturaMonth\n- Query entries → verify faturaMonth matches billing logic\n- Test with multiple entries in same fatura\n\n### Regression Tests (Based on Migration Issues)\n\n#### 18. Historical Bug Fixes\nThese were real bugs that required migrations. Ensure they don't regress:\n\n- **Bug:** Fatura month was using purchase month instead of closing day logic\n  - Test: Purchase Jan 20, closingDay=15 → fatura \"2025-02\" (not \"2025-01\")\n\n- **Bug:** Due dates were one month off\n  - Test: Fatura \"2025-01\", closingDay=15, paymentDueDay=5 → due \"2025-02-05\" (not \"2025-01-05\")\n\n- **Bug:** Missing fatura records for some month/account combinations\n  - Test: Create expense → ensure fatura exists\n  - Test: backfillFaturas creates missing records\n\n### Performance Tests\n\n#### 19. Bulk Expense Creation\n- Create 100 expenses in same month\n- Verify fatura total calculated correctly\n- Verify performance is acceptable\n\n#### 20. Multiple Faturas Same Month\n- Create 5 credit cards with expenses\n- Verify each has correct fatura\n- Verify totals are correct\n\n### Test File Location\n`/test/lib/fatura-utils.test.ts`\n\n### Implementation Notes\n- Focus on pure function testing (no database needed for utility functions)\n- Test all edge cases of closing day and payment due day logic\n- Test timezone handling explicitly\n- Test leap years and month boundaries\n- Test real-world Brazilian billing cycle scenarios\n- Test integration with expense creation (requires database)\n- Use existing fixtures (creditCardWithBilling)\n- Regression tests based on historical bugs from migrations\n","created_at":"2026-01-05T13:43:32Z"}]}
{"id":"northstar-8qv","title":"Phase 3: Create server error translation helper (/lib/i18n/server-errors.ts)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:27.615698-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T10:09:04.055109-03:00","closed_at":"2026-01-05T10:09:04.055109-03:00","close_reason":"Closed"}
{"id":"northstar-8wh","title":"Create language switcher close to the theme switcher","description":"We must create a language switcher component close to the existing theme switcher one. It must follow the theme switcher style and idea.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T12:34:10.526382-03:00","created_by":"caiodgallo","updated_at":"2026-01-02T12:52:40.444278-03:00","closed_at":"2026-01-02T12:52:40.444278-03:00","close_reason":"Closed"}
{"id":"northstar-9i6","title":"Phase 5: Coverage audit for remaining hardcoded strings","description":"Phase 5: Coverage audit for remaining hardcoded strings\n\nComprehensive audit to find any remaining hardcoded English strings that aren't translated.\n\nAreas to check:\n1. Components directory - all .tsx files\n2. App directory - all pages\n3. UI components (components/ui/)\n4. Any error messages or validation text\n\nHow to audit:\n1. Use grep to find English text patterns:\n   - Single quotes: grep -rn \"'\" | grep -v \"import\"\n   - Or search for common words: 'Error', 'Failed', 'Required', 'Invalid'\n2. For each match, determine if it's:\n   - User-facing text (needs translation)\n   - Code strings (can stay hardcoded)\n3. Create tasks for any missing translations found\n\nExamples of what to look for:\n- Button text: 'Save', 'Cancel', 'Delete'\n- Labels: 'Name', 'Description', 'Amount'\n- Errors: 'Something went wrong', 'Invalid input'\n- Placeholders: 'Enter value here'\n\nTools to use:\n- rg (ripgrep) for fast search\n- Manual code review\n\nExpected outcome:\n- List of all remaining hardcoded user-facing strings\n- Either all translated or documented with reasons why they can't be","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T07:06:46.951849-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T10:04:02.386946-03:00","closed_at":"2026-01-05T10:04:02.386946-03:00","close_reason":"Closed"}
{"id":"northstar-9yc","title":"Phase 4: Translate account-form component","description":"Phase 4: Translate account-form component\n\nFile: components/account-form.tsx\n\nThis component has hardcoded strings that need translation:\n- Form labels (Name, Type, Closing Day, Payment Due Day, Select Day)\n- Buttons (Save, Cancel, Create, Update, Saving...)\n- Error messages\n\nSteps:\n1. Add useTranslations('accountForm') hook\n2. Replace all hardcoded strings with t() calls\n3. Add missing translation keys to messages/en.json and messages/pt-BR.json\n4. Verify form works correctly for creating/editing accounts\n\nExample translation key structure (already exists in messages):\naccountForm.name, accountForm.type, accountForm.closingDay, etc.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T07:06:45.018733-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T09:58:48.616779-03:00","closed_at":"2026-01-05T09:58:48.616779-03:00","close_reason":"Closed"}
{"id":"northstar-9zx","title":"Enhance login namespace with missing keys","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:04.388212-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T09:38:19.711509-03:00","closed_at":"2026-01-05T09:38:19.711509-03:00","close_reason":"Closed"}
{"id":"northstar-abg","title":"Phase 2: Translate reset-password page (/app/(auth)/reset-password/page.tsx)","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-05T07:06:16.410022-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T07:14:14.70723-03:00","closed_at":"2026-01-05T07:14:14.70723-03:00","close_reason":"Closed"}
{"id":"northstar-ahq","title":"Add edit transaction functionality","description":"## Summary\nAdd ability to edit transactions from expense/income cards and detail sheet.\n\n## Context\n- TransactionForm already supports edit mode via `transaction`/`income` props\n- Server actions `updateExpense` and `updateIncome` already exist\n- `getTransactionWithEntries(transactionId)` fetches transaction + entries\n\n## Key Behavior\nWhen editing expense with installments: ALL entries are deleted and regenerated, losing `paidAt` status.\n**Decision**: Show warning dialog before editing multi-installment expenses.\n\n## Implementation Steps\n\n### 1. Create EditTransactionDialog component\nNew file: `components/edit-transaction-dialog.tsx`\n- Handles fetching transaction with entries (for expenses)\n- Renders TransactionForm in edit mode\n- Shows warning for multi-installment expenses\n\n### 2. Update ExpenseCard\n- Add `accounts: Account[]` prop\n- Add \"Edit\" menu item to dropdown\n- Integrate EditTransactionDialog\n\n### 3. Update IncomeCard\n- Add `accounts: Account[]` prop\n- Add \"Edit\" menu item to dropdown\n- Integrate EditTransactionDialog\n\n### 4. Update TransactionDetailSheet\n- Add `accounts` and `categories` props\n- Make Edit button functional\n- Close sheet when opening edit dialog\n\n### 5. Update parent pages\nPass accounts prop to cards in:\n- `app/(app)/expenses/page.tsx`\n- `app/(app)/income/page.tsx`\n\n### 6. Add translations\nAdd keys to `messages/en.json` and `messages/pt-BR.json`:\n- `expenses.editTransaction`\n- `income.editTransaction`\n- Warning dialog text for multi-installment edits\n\n## Editable Fields\n**Expenses**: description, amount, category, account, purchaseDate, installments\n**Income**: description, amount, category, account, receivedDate\n\n## Files to Modify\n1. `components/edit-transaction-dialog.tsx` (new)\n2. `components/expense-card.tsx`\n3. `components/income-card.tsx`\n4. `components/transaction-detail-sheet.tsx`\n5. `app/(app)/expenses/page.tsx`\n6. `app/(app)/income/page.tsx`\n7. `messages/en.json`\n8. `messages/pt-BR.json`","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-03T06:44:47.98322-03:00","created_by":"caiodgallo","updated_at":"2026-01-03T06:53:54.658421-03:00","closed_at":"2026-01-03T06:53:54.658421-03:00","close_reason":"Closed"}
{"id":"northstar-aos","title":"Tests: Accounts - Test CRUD operations","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T10:27:32.348448-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T11:10:07.680657-03:00","closed_at":"2026-01-05T11:10:07.680657-03:00","close_reason":"Closed","comments":[{"id":3,"issue_id":"northstar-aos","author":"caiodgallo","text":"# User Journey: Accounts CRUD\n\n## Server Actions: `/lib/actions/accounts.ts`\n\n### Happy Path Tests\n\n#### 1. `getAccounts()`\n- Returns all accounts for current user\n- Ordered by name alphabetically\n- Returns empty array if user has no accounts\n- Filters by userId correctly (user isolation)\n\n#### 2. `createAccount(data)` - Happy Paths\n- Create checking account successfully\n- Create savings account successfully\n- Create cash account successfully\n- Create credit card account (without billing config)\n- Create credit card account (with closingDay and paymentDueDay)\n- Verify userId is auto-assigned\n- Verify currency defaults to 'BRL'\n- Verify all required fields are stored correctly\n\n#### 3. `updateAccount(id, data)` - Happy Paths\n- Update account name\n- Update account type (e.g., checking → savings)\n- Add billing config to credit card (closingDay, paymentDueDay)\n- Remove billing config from credit card (set to null)\n- Verify both id and userId must match (cannot update another user's account)\n\n#### 4. `deleteAccount(id)` - Happy Paths\n- Delete account successfully\n- Verify both id and userId must match\n- Verify account no longer exists after deletion\n- Cascade: verify linked faturas are deleted (FK cascade)\n\n### Edge Case Tests\n\n#### 1. Account Type Validation\n- Create account with each type: 'checking', 'savings', 'credit_card', 'cash'\n- Invalid type should be rejected by TypeScript/Drizzle\n\n#### 2. Billing Config Constraints\n- closingDay must be 1-28 (test with 1, 28, 15)\n- paymentDueDay must be 1-28 (test with 1, 28, 5)\n- Invalid closingDay (0, 29, 31) should fail\n- Invalid paymentDueDay should fail\n- closingDay/paymentDueDay should only be required for credit_card type\n\n#### 3. Account Name Constraints\n- Empty name should fail\n- Very long name (should work but test it)\n- Duplicate names (should be allowed - no unique constraint)\n- Special characters in name (should work)\n\n#### 4. Currency Field\n- Default 'BRL' when not provided\n- Should accept other currency codes if provided (test if schema allows)\n- Verify currency is stored correctly\n\n#### 5. Referential Integrity on Delete\n- Delete account with entries → should fail (FK constraint)\n- Delete account with income → should fail (FK constraint)\n- Delete account with faturas → should succeed (cascade delete)\n- Delete account used in transactions via entries → should fail\n\n### Error Handling Tests\n\n#### 1. Create Account Errors\n- Missing required fields (name, type)\n- Invalid account type\n\n#### 2. Update Account Errors\n- Update non-existent account\n- Update account belonging to another user (userId mismatch)\n- Invalid billing config values (day out of range)\n\n#### 3. Delete Account Errors\n- Delete non-existent account\n- Delete account belonging to another user\n- Delete account referenced by entries (FK constraint violation)\n- Delete account referenced by income (FK constraint violation)\n\n### Integration Tests\n\n#### 1. Account-Fatura Relationship\n- Create credit card account → create expense → fatura created\n- Verify fatura belongs to correct account\n- Delete account → all faturas cascade deleted\n\n#### 2. Account-Entry Relationship\n- Create checking account → create expense with this account\n- Verify entry references correct account\n- Try to delete account → should fail (FK constraint)\n\n#### 3. Account-Income Relationship\n- Create account → create income with this account\n- Verify income references correct account\n- Try to delete account → should fail (FK constraint)\n\n#### 4. User Isolation\n- Create accounts for two users\n- User A cannot see User B's accounts\n- User A cannot update/delete User B's accounts\n- getAccounts() returns only current user's accounts\n\n#### 5. Account Type Configuration\n- Create credit card with billing config → create expense\n- Verify fatura month calculated correctly using closingDay\n- Verify due date calculated correctly using paymentDueDay\n- Create credit card without billing config → use fallback logic\n\n#### 6. Multiple Accounts\n- Create multiple accounts of same type\n- Create multiple accounts of different types\n- Verify getAccounts() returns all\n- Verify ordering by name\n\n### Revalidation Tests\n\n#### 1. Cache Invalidation\n- createAccount → revalidatePath('/settings/accounts') called\n- updateAccount → revalidatePath('/settings/accounts') called\n- deleteAccount → revalidatePath('/settings/accounts') called\n- Verify revalidateTag('accounts') called\n\n### Test File Location\n`/test/lib/actions/accounts.test.ts`\n\n### Implementation Notes\n- Use existing fixtures (testAccounts)\n- Mock auth with test user ID\n- Use in-memory PGlite database\n- Test referential integrity explicitly (FK constraints)\n- Test user isolation extensively\n- Test billing config logic (critical for credit cards)\n- Follow pattern from expenses.test.ts\n","created_at":"2026-01-05T13:43:32Z"}]}
{"id":"northstar-b2h","title":"Complete i18n Implementation - Comprehensive Translation Coverage","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-05T07:04:28.80169-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T10:10:01.836064-03:00","closed_at":"2026-01-05T10:10:01.836064-03:00","close_reason":"Closed"}
{"id":"northstar-bbo","title":"Phase 3: Translate auth.ts server action errors","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:28.048369-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T09:39:42.230219-03:00","closed_at":"2026-01-05T09:39:42.230219-03:00","close_reason":"Closed"}
{"id":"northstar-byy","title":"Add accountForm namespace to en.json and pt-BR.json","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:03.333705-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T07:20:20.294114-03:00","closed_at":"2026-01-05T07:20:20.294114-03:00","close_reason":"Closed"}
{"id":"northstar-du1","title":"Add forgotPassword namespace to en.json and pt-BR.json","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:02.375668-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T07:20:24.624546-03:00","closed_at":"2026-01-05T07:20:24.624546-03:00","close_reason":"forgotPassword and resetPassword namespaces already exist with complete translations"}
{"id":"northstar-egy","title":"Phase 2: Translate forgot-password page (/app/(auth)/forgot-password/page.tsx)","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-05T07:06:16.120955-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T07:12:12.460091-03:00","closed_at":"2026-01-05T07:12:12.460091-03:00","close_reason":"Closed"}
{"id":"northstar-enc","title":"Phase 1: Audit and enhance translation files","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:02.113314-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T07:19:49.590389-03:00","closed_at":"2026-01-05T07:19:49.590389-03:00","close_reason":"Closed"}
{"id":"northstar-ep5","title":"Add missing error keys to errors namespace","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:04.127045-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T10:09:04.177628-03:00","closed_at":"2026-01-05T10:09:04.177628-03:00","close_reason":"Closed"}
{"id":"northstar-f1c","title":"Translate the Accounts page","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-02T12:31:36.862994-03:00","created_by":"caiodgallo","updated_at":"2026-01-02T12:31:52.644518-03:00","deleted_at":"2026-01-02T12:31:52.644518-03:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"northstar-gbp","title":"Translate the Accounts page","description":"The Accounts page is still mainly hardcoded strings. They need to following the internalitzation pattern established accross the codebase and translated the suitable strings. Mainly UI components and layout at the present moment.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T12:32:22.893286-03:00","created_by":"caiodgallo","updated_at":"2026-01-02T14:48:48.710898-03:00","closed_at":"2026-01-02T14:48:48.710898-03:00","close_reason":"Closed"}
{"id":"northstar-gde","title":"Tests: Add comprehensive test coverage for user journeys","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-05T10:27:27.066482-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T10:27:27.066482-03:00","comments":[{"id":8,"issue_id":"northstar-gde","author":"caiodgallo","text":"# Testing Plan Summary\n\n## Executive Summary\n\nComprehensive test coverage has been planned for all major user journeys in the Northstar application. The plan is organized into 8 tasks within a Tests epic, prioritized by business criticality.\n\n## Current State\n\n### Well-Tested (✓)\n- **Expenses** - 572 lines of tests, comprehensive coverage\n- **Income** - 467 lines of tests, comprehensive coverage\n\n### No Test Coverage (✗)\n- Dashboard - 0 tests\n- Faturas - No dedicated test file (partial coverage in expense tests)\n- Accounts - 0 tests\n- Categories - 0 tests\n- Budgets - 0 tests\n\n## Testing Infrastructure\n\n### Stack\n- **Test Runner**: Vitest with happy-dom environment\n- **Database**: In-memory PGlite (PostgreSQL)\n- **Testing Library**: @testing-library/react for components\n- **Mocking**: vi.mock for next/cache revalidatePath\n- **Auth**: Mock getCurrentUserId() with test user\n\n### Existing Patterns\n- Fixtures in `/test/fixtures.ts` (testAccounts, testCategories)\n- Helpers: createTestTransaction(), createTestEntry(), createTestIncome()\n- Setup: `/test/setup.ts` (cleanup, mocks)\n- DB Utils: `/test/db-utils.ts` (PGlite setup, table clearing)\n\n## Test Plan\n\n### Priority 1 (Critical - Business Critical)\n\n#### 1. Dashboard - Test getDashboardData server action\n**ID**: northstar-797\n**File**: `/test/lib/actions/dashboard.test.ts`\n\n**Why P1**: Dashboard is the main user-facing view, critical for user trust\n\n**Key Test Areas**:\n- Empty state handling\n- Expenses only, income only scenarios\n- Budget tracking (spending calculation by purchaseDate)\n- Recent lists ordering\n- Month boundary handling\n- Installment expense filtering\n- User isolation\n\n**Estimated Effort**: 3-4 hours\n\n#### 2. Faturas - Test CRUD operations and payment flows\n**ID**: northstar-wvj\n**File**: `/test/lib/actions/faturas.test.ts`\n\n**Why P1**: Faturas are core to Brazilian credit card billing, payment flow is critical\n\n**Key Test Areas**:\n- Auto-creation on expense creation\n- Total calculation and updates\n- Payment flow (mark paid/unpaid)\n- Fatura-entry relationships\n- Cascade deletion (account → faturas)\n- User isolation\n\n**Estimated Effort**: 2-3 hours\n\n### Priority 2 (Important - Business Important)\n\n#### 3. Accounts - Test CRUD operations\n**ID**: northstar-aos\n**File**: `/test/lib/actions/accounts.test.ts`\n\n**Why P2**: Accounts are foundational, but simple CRUD\n\n**Key Test Areas**:\n- Create/Update/Delete all account types\n- Billing config validation (closingDay, paymentDueDay)\n- Referential integrity (cannot delete if used)\n- User isolation\n\n**Estimated Effort**: 1-2 hours\n\n#### 4. Categories - Test CRUD operations\n**ID**: northstar-v0d\n**File**: `/test/lib/actions/categories.test.ts`\n\n**Why P2**: Categories are foundational, with referential integrity checks\n\n**Key Test Areas**:\n- Create/Update/Delete categories\n- Icon validation (38 predefined icons)\n- Referential integrity (cannot delete if used by transactions/income)\n- Cascade delete (budgets deleted when category deleted)\n- User isolation\n\n**Estimated Effort**: 1-2 hours\n\n#### 5. Budgets - Test CRUD and calculation logic\n**ID**: northstar-th0\n**File**: `/test/lib/actions/budgets.test.ts`\n\n**Why P2**: Budget calculation is complex and critical for dashboard accuracy\n\n**Key Test Areas**:\n- Create/Update/Delete budgets (per-category and monthly)\n- Spending calculation by purchaseDate\n- getBudgetsWithSpending aggregation logic\n- Copy budgets from previous month\n- Zero budgets and missing budgets\n- User isolation\n\n**Estimated Effort**: 2-3 hours\n\n#### 6. Faturas - Test billing cycle calculations\n**ID**: northstar-8qt\n**File**: `/test/lib/fatura-utils.test.ts`\n\n**Why P2**: Billing cycle logic is complex but tested in utility functions (no DB needed)\n\n**Key Test Areas**:\n- getFaturaMonth() closing day logic\n- getFaturaPaymentDueDate() calculation\n- Installment expense fatura month mapping\n- Month/year boundaries\n- Leap years\n- Real-world Brazilian billing cycles (Nubank, Itaú)\n- Regression tests for historical bugs\n\n**Estimated Effort**: 2-3 hours\n\n#### 7. Dashboard - Test components and edge cases\n**ID**: northstar-0qa\n**File**: `/test/components/dashboard.test.ts`\n\n**Why P2**: Component testing is lower priority than server actions\n\n**Key Test Areas**:\n- BalanceSummary component (income/expenses/balance display)\n- SummaryCard component (budget/spent/remaining)\n- BudgetProgress component (progress bars, color coding)\n- RecentExpenses component (list display)\n- MonthPicker component (navigation)\n- Edge cases (zero values, division by zero, over budget)\n- Internationalization (pt-BR/en)\n- Loading states\n\n**Estimated Effort**: 3-4 hours\n\n## Total Estimated Effort\n\n- **P1 Tasks**: 5-7 hours\n- **P2 Tasks**: 9-14 hours\n- **Total**: 14-21 hours\n\n## Test Strategy\n\n### Happy Paths\n- Focus on normal user workflows\n- Test each CRUD operation (Create, Read, Update, Delete)\n- Verify correct data flow from server action to database\n\n### Edge Cases\n- Zero values\n- Division by zero\n- Empty states\n- Month/year boundaries\n- Leap years\n- Very large amounts\n- Missing data (null/undefined)\n- Over budget scenarios\n- Multiple accounts/categories\n\n### Common Edge Cases Across All Journeys\n1. **User Isolation**: Verify no data leakage between users\n2. **Referential Integrity**: Foreign key constraints on delete\n3. **Money Handling**: All values in cents, convert correctly\n4. **Date Handling**: Timezone-safe, correct month boundaries\n5. **Internationalization**: Both pt-BR and en locales\n6. **Cache Invalidation**: revalidatePath/revalidateTag called\n7. **Validation**: Invalid inputs rejected with proper errors\n\n## Implementation Recommendations\n\n### 1. Follow Existing Patterns\n- Copy structure from `/test/lib/actions/expenses.test.ts`\n- Use existing fixtures and helper functions\n- Mock auth with `mockAuth()` from `/test/auth-utils.ts`\n- Use PGlite database with migrations\n\n### 2. Test Structure\n```typescript\n// Standard test file structure\nimport { describe, it, expect, beforeEach, afterEach } from 'vitest';\nimport { mockAuth } from '@/test/auth-utils';\nimport { setupTestDb, teardownTestDb, clearAllTables, getTestDb } from '@/test/db-utils';\nimport { TEST_USER_ID, testAccounts, testCategories } from '@/test/fixtures';\n\n// Mock auth before importing actions\nmockAuth();\n\ndescribe('Server Action: actionName', () =\u003e {\n  let db;\n  \n  beforeEach(async () =\u003e {\n    db = await setupTestDb();\n  });\n  \n  afterEach(async () =\u003e {\n    await clearAllTables();\n    await teardownTestDb();\n  });\n  \n  describe('Happy Paths', () =\u003e {\n    it('should do something', async () =\u003e {\n      // Arrange\n      const account = await db.insert(accounts).values(testAccounts.checking).returning();\n      \n      // Act\n      const result = await someAction(account[0].id);\n      \n      // Assert\n      expect(result).toBeDefined();\n    });\n  });\n  \n  describe('Edge Cases', () =\u003e {\n    // Edge case tests\n  });\n  \n  describe('Error Handling', () =\u003e {\n    // Error handling tests\n  });\n});\n```\n\n### 3. Test Data Management\n- Use `clearAllTables()` in afterEach to reset state\n- Create test data in beforeEach when needed\n- Use fixtures for common data (accounts, categories)\n- Create specific test data inline for each test\n\n### 4. Assertion Patterns\n- Verify database state after mutations\n- Verify return values are correct\n- Verify errors are thrown/rejected\n- Verify foreign key constraints work\n- Verify user isolation (filter by userId)\n\n### 5. Naming Conventions\n- Test files: `*.test.ts`\n- Describe blocks: Feature or action name\n- Test cases: \"should...\" format\n- Group tests: Happy Paths, Edge Cases, Error Handling, Integration\n\n### 6. Coverage Goals\n- Aim for 80%+ coverage on server actions\n- Test all public functions and methods\n- Test all error paths\n- Test validation logic\n- Test edge cases\n\n## Next Steps\n\n1. **Start with P1 tasks** (Dashboard and Faturas CRUD)\n   - Highest business value\n   - Most complex logic\n   - Foundation for other tests\n\n2. **Proceed to P2 tasks** (Accounts, Categories, Budgets, Billing Cycle)\n   - Simpler CRUD operations\n   - Foundation for application\n   - Complete coverage\n\n3. **Component testing last** (Dashboard Components)\n   - Lower priority\n   - Nice to have but not critical\n   - Server actions more important\n\n## Risk Mitigation\n\n### Testing Pitfalls to Avoid\n\n1. **Don't Test UI Framework Code**\n   - Don't test shadcn/ui components\n   - Don't test Next.js routing\n   - Focus on your application logic\n\n2. **Don't Over-Test**\n   - Don't test trivial getters/setters\n   - Don't test implementation details\n   - Test behavior, not code structure\n\n3. **Don't Ignore Timezone Issues**\n   - Always use UTC methods for date calculations\n   - Test with different timezones if relevant\n   - Verify parseLocalDate() is used\n\n4. **Don't Forget User Isolation**\n   - Always test with multiple users\n   - Verify queries filter by userId\n   - Test that users can't access each other's data\n\n5. **Don't Assume Data Integrity**\n   - Test with invalid data\n   - Test with missing data\n   - Test with contradictory data\n\n## Success Criteria\n\nA task is complete when:\n- All happy paths tested\n- Common edge cases tested\n- Error handling tested\n- User isolation tested\n- Referential integrity tested\n- Tests follow existing patterns\n- All tests pass\n- Code coverage meets goals (80%+)\n\n## Maintenance\n\n### Keeping Tests Relevant\n- Update tests when requirements change\n- Add tests for new features\n- Fix tests when code changes\n- Run tests before committing changes\n\n### Running Tests\n```bash\n# Run all tests\npnpm test\n\n# Run specific test file\npnpm test dashboard.test.ts\n\n# Run with coverage\npnpm test:coverage\n\n# Run in watch mode during development\npnpm test:ui\n```\n\n## Conclusion\n\nThis testing plan provides comprehensive coverage for all major user journeys in the application. The focus is on server actions and business logic, with component testing as a lower priority. Following existing patterns and infrastructure will ensure consistency and maintainability.\n","created_at":"2026-01-05T13:44:40Z"},{"id":9,"issue_id":"northstar-gde","author":"caiodgallo","text":"# Test Coverage Mapping\n\n## Current State\n\n### ✅ Well-Tested\n\n| Feature | Test File | Lines | Coverage |\n|---------|-----------|-------|----------|\n| Expenses | `/test/lib/actions/expenses.test.ts` | 572 | Comprehensive |\n| Income | `/test/lib/actions/income.test.ts` | 467 | Comprehensive |\n\n### ❌ No Test Coverage\n\n| Feature | Server Action | Status |\n|---------|--------------|--------|\n| Dashboard | `/lib/actions/dashboard.ts` | No tests |\n| Faturas | `/lib/actions/faturas.ts` | No dedicated tests (partial in expenses) |\n| Accounts | `/lib/actions/accounts.ts` | No tests |\n| Categories | `/lib/actions/categories.ts` | No tests |\n| Budgets | `/lib/actions/budgets.ts` | No tests |\n\n## Planned Tests\n\n### Epic: Tests (northstar-gde)\n\n#### P1 Tasks (Critical)\n\n| ID | Task | File | Est. Time |\n|----|------|------|-----------|\n| northstar-797 | Dashboard - getDashboardData | `/test/lib/actions/dashboard.test.ts` | 3-4h |\n| northstar-wvj | Faturas - CRUD \u0026 Payment | `/test/lib/actions/faturas.test.ts` | 2-3h |\n\n#### P2 Tasks (Important)\n\n| ID | Task | File | Est. Time |\n|----|------|------|-----------|\n| northstar-aos | Accounts - CRUD | `/test/lib/actions/accounts.test.ts` | 1-2h |\n| northstar-v0d | Categories - CRUD | `/test/lib/actions/categories.test.ts` | 1-2h |\n| northstar-th0 | Budgets - CRUD \u0026 Calculations | `/test/lib/actions/budgets.test.ts` | 2-3h |\n| northstar-8qt | Faturas - Billing Cycle Logic | `/test/lib/fatura-utils.test.ts` | 2-3h |\n| northstar-0qa | Dashboard - Components | `/test/components/dashboard.test.ts` | 3-4h |\n\n## Server Actions to Test\n\n### Dashboard (`/lib/actions/dashboard.ts`)\n- ✗ getDashboardData(yearMonth)\n\n### Faturas (`/lib/actions/faturas.ts`)\n- ✗ ensureFaturaExists(accountId, yearMonth)\n- ✗ updateFaturaTotal(accountId, yearMonth)\n- ✗ getFaturasByMonth(yearMonth)\n- ✗ getFaturasByAccount(accountId)\n- ✗ getFaturaWithEntries(faturaId)\n- ✗ payFatura(faturaId, fromAccountId)\n- ✗ markFaturaUnpaid(faturaId)\n\n### Accounts (`/lib/actions/accounts.ts`)\n- ✗ getAccounts()\n- ✗ createAccount(data)\n- ✗ updateAccount(id, data)\n- ✗ deleteAccount(id)\n\n### Categories (`/lib/actions/categories.ts`)\n- ✗ getCategories(type?)\n- ✗ createCategory(data)\n- ✗ updateCategory(id, data)\n- ✗ deleteCategory(id)\n\n### Budgets (`/lib/actions/budgets.ts`)\n- ✗ getBudgetsForMonth(yearMonth)\n- ✗ upsertBudget(categoryId, yearMonth, amount)\n- ✗ getMonthlyBudget(yearMonth)\n- ✗ upsertMonthlyBudget(yearMonth, amount)\n- ✗ getBudgetsWithSpending(yearMonth)\n- ✗ copyBudgetsFromMonth(sourceMonth, targetMonth)\n\n## Utility Functions to Test\n\n### Fatura Utils (`/lib/fatura-utils.ts`)\n- ✗ getFaturaMonth(purchaseDate, closingDay)\n- ✗ getFaturaPaymentDueDate(faturaMonth, paymentDueDay, closingDay)\n- ✗ formatFaturaMonthWithLocale(yearMonth, locale)\n\n## Components to Test\n\n### Dashboard Components\n- ✗ `/components/balance-summary.tsx`\n- ✗ `/components/summary-card.tsx`\n- ✗ `/components/budget-progress.tsx`\n- ✗ `/components/recent-expenses.tsx`\n- ✗ `/components/month-picker.tsx`\n- ✗ `/app/(app)/dashboard/page.tsx`\n- ✗ `/app/(app)/dashboard/loading.tsx`\n\n## Key Test Areas by Feature\n\n### Dashboard\n- Data aggregation (totalSpent, totalBudget, totalIncome, netBalance)\n- Spending calculation by purchaseDate (not dueDate)\n- Category breakdown aggregation\n- Recent lists ordering\n- Month boundary handling\n- Installment expense filtering\n\n### Faturas\n- Auto-creation on expense creation\n- Billing cycle logic (closing day, payment due day)\n- Payment flow (pay/unpay)\n- Total calculation and updates\n- Fatura-entry relationships\n- Cascade deletion\n\n### Accounts\n- CRUD operations for all account types\n- Billing config validation\n- Referential integrity (cannot delete if used)\n- User isolation\n\n### Categories\n- CRUD operations\n- Icon validation (38 predefined)\n- Color validation\n- Referential integrity (cannot delete if used)\n- Cascade delete (budgets)\n\n### Budgets\n- CRUD operations (per-category and monthly)\n- Spending calculation by purchaseDate\n- getBudgetsWithSpending aggregation\n- Copy budgets from previous month\n- Zero budgets and missing budgets\n- User isolation\n\n## Common Test Patterns\n\n### All Features\n- Happy paths (normal operations)\n- Edge cases (zero values, boundaries, missing data)\n- Error handling (invalid inputs, constraint violations)\n- User isolation (no data leakage)\n- Referential integrity (foreign key constraints)\n- Cache invalidation (revalidatePath/revalidateTag)\n- Money handling (cents to display conversion)\n- Date handling (timezone-safe)\n\n### Complex Features\n- **Dashboard**: Aggregation, filtering, ordering\n- **Faturas**: Billing cycle calculations, installments\n- **Budgets**: Spending calculation, multi-month data\n\n## Progress Tracking\n\n### Total Progress: 2/8 (25%)\n\n- ✅ Expenses (existing)\n- ✅ Income (existing)\n- ⏳ Dashboard (planned - P1)\n- ⏳ Faturas (planned - P1)\n- ⏳ Accounts (planned - P2)\n- ⏳ Categories (planned - P2)\n- ⏳ Budgets (planned - P2)\n- ⏳ Billing Cycle (planned - P2)\n\n### Estimated Remaining Time: 14-21 hours\n- P1 Tasks: 5-7 hours\n- P2 Tasks: 9-14 hours\n","created_at":"2026-01-05T13:45:09Z"},{"id":10,"issue_id":"northstar-gde","author":"caiodgallo","text":"# Test Dependencies Graph\n\n## Dependency Structure\n\n### Level 1 - No Dependencies (Start Here)\n```\n┌─────────────────────────────┐\n│ Accounts (P2)            │ northstar-aos\n│ - Foundational data        │\n│ - No dependencies         │\n└─────────────────────────────┘\n\n┌─────────────────────────────┐\n│ Categories (P2)           │ northstar-v0d\n│ - Foundational data        │\n│ - No dependencies         │\n└─────────────────────────────┘\n\n┌─────────────────────────────┐\n│ Faturas Billing (P2)      │ northstar-8qt\n│ - Pure functions          │\n│ - No database deps       │\n│ - Independent            │\n└─────────────────────────────┘\n```\n\n### Level 2 - Depends on Level 1\n```\nBudgets (P2) ───────────────→ Categories (P2)\nnorthstar-th0                   northstar-v0d\n- Spending calculations\n- Per-category budgets\n\nFaturas CRUD (P1) ───────────→ Accounts (P2)\nnorthstar-wvj                    northstar-aos\n- Payment flows\n- Fatura-entry relationships\n```\n\n### Level 3 - Depends on Level 2\n```\nDashboard Server (P1) ──────→ Budgets (P2)\nnorthstar-797                   northstar-th0\n- Data aggregation\n- Complex calculations\n```\n\n### Level 4 - Depends on Level 3\n```\nDashboard Components (P2) ──→ Dashboard Server (P1)\nnorthstar-0qa                     northstar-797\n- UI testing\n- Component behavior\n```\n\n## Execution Order\n\n### Phase 1 - Foundation (Can start immediately)\n1. **Accounts** - Test CRUD operations (1-2h)\n2. **Categories** - Test CRUD operations (1-2h)\n3. **Faturas Billing Cycle** - Test utility functions (2-3h)\n\n### Phase 2 - Intermediate (After Phase 1)\n4. **Budgets** - Test CRUD \u0026 calculations (2-3h) [needs Categories]\n5. **Faturas CRUD** - Test payment flows (2-3h) [needs Accounts]\n\n### Phase 3 - User-Facing (After Phase 2)\n6. **Dashboard Server** - Test getDashboardData (3-4h) [needs Budgets]\n\n### Phase 4 - UI (After Phase 3)\n7. **Dashboard Components** - Test components (3-4h) [needs Dashboard Server]\n\n## Dependency Rationale\n\n### Why Accounts first?\n- Expenses, Income, Faturas all require accounts\n- Foreign key: entries.accountId, income.accountId, faturas.accountId\n- Testing accounts ensures fixtures are solid\n- Accounts are referenced by almost everything\n\n### Why Categories second?\n- Expenses, Income, Budgets all require categories\n- Foreign key: transactions.categoryId, income.categoryId, budgets.categoryId\n- Categories cascade delete to budgets (critical relationship)\n- Needed for budget calculations\n\n### Why Budgets before Dashboard?\n- Dashboard uses budget data from `getBudgetsWithSpending()`\n- Dashboard shows budget progress and summaries\n- Budgets are core to dashboard display\n- No sense testing dashboard without budget tests\n\n### Why Faturas CRUD after Accounts?\n- Faturas are tied to accounts (faturas.accountId FK)\n- Faturas cascade delete when account deleted\n- Need account fixtures for testing fatura creation\n- Credit card billing config is on accounts\n\n### Why Dashboard Server before Components?\n- Components depend on server action data\n- Server action is the source of truth\n- Component tests mock the server action\n- Should test data source before presentation layer\n\n### Why Faturas Billing Cycle is independent?\n- Pure utility functions (getFaturaMonth, getFaturaPaymentDueDate)\n- No database dependencies\n- Can test in parallel with foundation\n- Self-contained logic\n\n## Parallel Execution Opportunities\n\n### Can work in parallel (Phase 1):\n- **Accounts** + **Categories** + **Faturas Billing Cycle**\n  - No dependencies between them\n  - Different areas of codebase\n  - 3 different developers can work simultaneously\n  - Total time: max(1-2h, 1-2h, 2-3h) = ~3h\n\n### Can work in parallel (Phase 2):\n- **Budgets** + **Faturas CRUD**\n  - Budgets needs Categories (done in Phase 1)\n  - Faturas needs Accounts (done in Phase 1)\n  - Both available after Phase 1\n  - Total time: max(2-3h, 2-3h) = ~3h\n\n### Sequential (Phase 3+):\n- **Dashboard Server** → **Dashboard Components**\n  - Hard dependency chain\n  - Must complete in sequence\n\n## Critical Path\n\n**Longest path through dependencies:**\n\n1. Categories (2h)\n2. Budgets (3h) [depends on Categories]\n3. Dashboard Server (4h) [depends on Budgets]\n4. Dashboard Components (4h) [depends on Dashboard Server]\n\n**Total critical path: 13 hours**\n\n## Parallel Execution Strategy\n\n### Ideal Team Size: 3 developers\n\n**Developer 1:**\n1. Categories (2h) → Budgets (3h) → Dashboard Server (4h)\n   Total: 9h\n\n**Developer 2:**\n1. Accounts (2h) → Faturas CRUD (3h)\n   Total: 5h\n\n**Developer 3:**\n1. Faturas Billing Cycle (3h)\n   Total: 3h\n\n**Total calendar time: 9 hours** (vs 21 hours sequential)\n\n### Minimal Team Size: 1 developer\n\n**Sequential execution:**\n1. Accounts (2h)\n2. Categories (2h)\n3. Faturas Billing Cycle (3h)\n4. Budgets (3h) [after Categories]\n5. Faturas CRUD (3h) [after Accounts]\n6. Dashboard Server (4h) [after Budgets]\n7. Dashboard Components (4h) [after Dashboard Server]\n\n**Total: 21 hours** (3 days)\n\n## Dependency Commands\n\n```bash\n# View full dependency tree\nbd dep tree northstar-797\n\n# List dependencies of an issue\nbd dep list northstar-797\n\n# List dependents of an issue\nbd dep list --reverse northstar-v0d\n\n# Check for cycles\nbd dep cycles\n\n# Add a dependency\nbd dep add \u003cissue\u003e \u003cdepends-on\u003e\n\n# Remove a dependency\nbd dep remove \u003cissue\u003e \u003cdepends-on\u003e\n```\n\n## Current Status\n\n### Ready (No blockers) - 4 tasks\n1. Accounts (northstar-aos)\n2. Categories (northstar-v0d)\n3. Faturas Billing Cycle (northstar-8qt)\n4. Epic (northstar-gde)\n\n### Blocked (Waiting) - 4 tasks\n1. Budgets (northstar-th0) - blocked by Categories\n2. Faturas CRUD (northstar-wvj) - blocked by Accounts\n3. Dashboard Server (northstar-797) - blocked by Budgets\n4. Dashboard Components (northstar-0qa) - blocked by Dashboard Server\n","created_at":"2026-01-05T13:47:43Z"}]}
{"id":"northstar-htn","title":"Enhance transactionDetail namespace in en.json and pt-BR.json","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:03.853235-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T07:21:34.107512-03:00","closed_at":"2026-01-05T07:21:34.107512-03:00","close_reason":"Closed"}
{"id":"northstar-ic4","title":"Phase 3: Translate budgets.ts server action errors","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:28.344299-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T09:40:30.446953-03:00","closed_at":"2026-01-05T09:40:30.446953-03:00","close_reason":"Closed"}
{"id":"northstar-kgb","title":"Phase 2: Translate offline page (/app/offline/page.tsx)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:16.757745-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T09:37:15.333139-03:00","closed_at":"2026-01-05T09:37:15.333139-03:00","close_reason":"Closed"}
{"id":"northstar-lsh","title":"Phase 3: Translate expenses.ts server action errors","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:28.936228-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T09:42:59.933931-03:00","closed_at":"2026-01-05T09:42:59.933931-03:00","close_reason":"Closed"}
{"id":"northstar-nek","title":"Phase 4: Translate transaction-detail-sheet component","description":"Phase 4: Translate transaction-detail-sheet component\n\nFile: components/transaction-detail-sheet.tsx (205 lines)\n\nHardcoded strings to translate:\n- Status labels: 'Paid', 'Pending', 'Received' (lines 34-35)\n- Date labels: 'Due Date', 'Received Date' (line 37)\n- Field labels: 'Amount', 'Status', 'Category', 'Account', 'Purchase Date', 'Fatura', 'Installment' (lines 65, 76, 93, 96, 114, 125, 135)\n- Installment text: '{n} of {n}' (line 138)\n- Buttons: 'View All {n} Installments', 'Edit' (lines 60, 74)\n\nMost keys already exist in messages:\n- transactionDetail namespace has: amount, status, category, account, dueDate, receivedDate, purchaseDate, fatura, installment, paid, pending, received, edit\n- Need to add: 'of' (line 138)\n- Need to update: 'viewAllInstallments' (already exists in messages/transactionDetail: 'View All {count} Installments')\n\nSteps:\n1. Add useTranslations('transactionDetail') hook\n2. Replace all hardcoded strings with t() calls\n3. Add 'transactionDetail.of' key to messages (English: 'of', Portuguese: 'de')\n4. Verify sheet works correctly in both languages\n\nNote: This component uses a DetailRow helper component that accepts a label prop.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T07:06:46.359939-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T09:58:48.907979-03:00","closed_at":"2026-01-05T09:58:48.907979-03:00","close_reason":"Closed"}
{"id":"northstar-o3p","title":"Security Hardening for Public Launch","description":"Complete security audit and hardening before public launch with multi-user support. Addresses critical multi-tenancy vulnerabilities, authorization, rate limiting, and auth hardening.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-02T15:50:42.526809-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T06:59:41.762679-03:00","closed_at":"2026-01-05T06:59:41.762679-03:00","close_reason":"Closed"}
{"id":"northstar-o3p.1","title":"Add userId to schema and migrate existing data","description":"CRITICAL: Add userId column to all tables (accounts, categories, budgets, monthlyBudgets, transactions, income, faturas). Create Drizzle migration, write data migration SQL, and add RLS policies.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T15:51:24.712209-03:00","created_by":"caiodgallo","updated_at":"2026-01-03T05:59:33.331082-03:00","closed_at":"2026-01-03T05:59:33.331082-03:00","close_reason":"Closed","labels":["database","security"],"dependencies":[{"issue_id":"northstar-o3p.1","depends_on_id":"northstar-o3p","type":"parent-child","created_at":"2026-01-02T15:51:24.716313-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-o3p.2","title":"Implement authorization checks in all server actions","description":"CRITICAL: Create lib/auth/get-current-user.ts helper. Update all server actions (accounts, categories, expenses, budgets, income, faturas, import) with userId filtering and ownership verification.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T15:51:25.848561-03:00","created_by":"caiodgallo","updated_at":"2026-01-04T06:44:27.641225-03:00","closed_at":"2026-01-04T06:44:27.641225-03:00","close_reason":"Closed","labels":["authorization","security"],"dependencies":[{"issue_id":"northstar-o3p.2","depends_on_id":"northstar-o3p","type":"parent-child","created_at":"2026-01-02T15:51:25.862439-03:00","created_by":"caiodgallo"},{"issue_id":"northstar-o3p.2","depends_on_id":"northstar-o3p.1","type":"blocks","created_at":"2026-01-02T15:52:17.215987-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-o3p.3","title":"Add Upstash rate limiting to server actions","description":"Install @upstash/ratelimit and @upstash/redis. Create rate limiter utility. Apply to auth actions and bulk operations.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T15:51:26.935934-03:00","created_by":"caiodgallo","updated_at":"2026-01-04T12:15:36.727782-03:00","closed_at":"2026-01-04T12:15:36.727782-03:00","close_reason":"Closed","labels":["rate-limiting","security"],"dependencies":[{"issue_id":"northstar-o3p.3","depends_on_id":"northstar-o3p","type":"parent-child","created_at":"2026-01-02T15:51:26.939627-03:00","created_by":"caiodgallo"},{"issue_id":"northstar-o3p.3","depends_on_id":"northstar-o3p.2","type":"blocks","created_at":"2026-01-02T15:52:17.349329-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-o3p.4","title":"Add security headers and strengthen auth","description":"Add security headers to next.config.ts (CSP, HSTS, X-Frame-Options). Update supabase/config.toml for 8+ char passwords. Enable email confirmation. Add hCaptcha/Turnstile to login.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T15:51:28.473209-03:00","created_by":"caiodgallo","updated_at":"2026-01-04T11:58:28.094268-03:00","closed_at":"2026-01-04T11:58:28.094268-03:00","close_reason":"Closed","labels":["auth","headers","security"],"dependencies":[{"issue_id":"northstar-o3p.4","depends_on_id":"northstar-o3p","type":"parent-child","created_at":"2026-01-02T15:51:28.476001-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-o3p.5","title":"Harden input validation and cleanup secrets","description":"Add validation to accounts.ts, income.ts, categories.ts. Add file upload validation (MIME type, size limits). Remove commented credentials from .env. Reduce error logging verbosity.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T15:51:29.592432-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T06:59:52.980097-03:00","closed_at":"2026-01-05T06:59:52.980097-03:00","close_reason":"Closed","labels":["security","validation"],"dependencies":[{"issue_id":"northstar-o3p.5","depends_on_id":"northstar-o3p","type":"parent-child","created_at":"2026-01-02T15:51:29.594404-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-o7n","title":"Add categoryForm namespace to en.json and pt-BR.json","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:03.083352-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T07:20:20.292835-03:00","closed_at":"2026-01-05T07:20:20.292835-03:00","close_reason":"Closed"}
{"id":"northstar-oas","title":"Phase 5: Manual testing of all translations","description":"Phase 5: Manual testing of all translations\n\nTest the complete i18n implementation by:\n1. Switching between languages (en/pt-BR) in settings\n2. Navigating through all pages (dashboard, expenses, income, budgets, faturas, settings)\n3. Testing all user flows:\n   - Login/logout\n   - Create/edit/delete expenses and income\n   - Create/edit/delete categories and accounts\n   - Import CSV files\n   - Pay faturas\n   - Switch themes\n4. Verifying all server action errors are translated\n5. Checking form placeholders, labels, buttons, and error messages\n\nFile locations to test:\n- All pages in app/ directory\n- All components in components/ directory\n- All server actions in lib/actions/ directory\n\nExpected outcome: All user-facing text should display correctly in both English and Portuguese without any hardcoded strings remaining.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:46.684904-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T10:09:19.565629-03:00","closed_at":"2026-01-05T10:09:19.565629-03:00","close_reason":"Closed"}
{"id":"northstar-seb","title":"Phase 3: Translate import.ts server action errors","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:29.576049-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T09:44:53.664224-03:00","closed_at":"2026-01-05T09:44:53.664224-03:00","close_reason":"Closed"}
{"id":"northstar-t9p","title":"Translate the Budgets(settings) page","description":"The Budgets(settings) page is still mainly hardcoded strings. They need to following the internalitzation pattern established accross the codebase and translated the suitable strings. Mainly UI components and layout at the present moment.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T12:33:11.3106-03:00","created_by":"caiodgallo","updated_at":"2026-01-02T14:51:32.827899-03:00","closed_at":"2026-01-02T14:51:32.827899-03:00","close_reason":"Closed"}
{"id":"northstar-th0","title":"Tests: Budgets - Test CRUD and calculation logic","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T10:27:32.902025-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T10:27:32.902025-03:00","dependencies":[{"issue_id":"northstar-th0","depends_on_id":"northstar-v0d","type":"blocks","created_at":"2026-01-05T10:46:48.629948-03:00","created_by":"caiodgallo"}],"comments":[{"id":5,"issue_id":"northstar-th0","author":"caiodgallo","text":"# User Journey: Budgets CRUD\n\n## Server Actions: `/lib/actions/budgets.ts`\n\n### Happy Path Tests\n\n#### 1. `getBudgetsForMonth(yearMonth)`\n- Returns all categories for the month\n- Includes categories even without budgets (budgetId = null, budgetAmount = null)\n- Left joins with budgets table\n- Ordered by category name\n- Filters by userId correctly (user isolation)\n- Returns empty array if user has no categories\n\n#### 2. `upsertBudget(categoryId, yearMonth, amount)` - Happy Paths\n- Create new budget for category+month\n- Update existing budget (same category+month)\n- Create budget for amount 0 (allowed)\n- Update budget to different amount\n- Verify userId is auto-assigned\n- Verify amount stored in cents (convert from display)\n- Verify unique constraint (userId, categoryId, yearMonth)\n\n#### 3. `getMonthlyBudget(yearMonth)`\n- Returns monthly budget for month\n- Returns null if no monthly budget set\n- Filters by userId correctly\n- Returns correct amount in cents\n\n#### 4. `upsertMonthlyBudget(yearMonth, amount)` - Happy Paths\n- Create new monthly budget for month\n- Update existing monthly budget\n- Set to amount 0 (allowed)\n- Verify userId is auto-assigned\n- Verify unique constraint (userId, yearMonth)\n\n#### 5. `getBudgetsWithSpending(yearMonth)` - Happy Paths\n- Returns budgets with spending data\n- Calculates totalSpent correctly (sum of all category spending)\n- Calculates totalBudget correctly (sum of all category budgets)\n- Returns budget array with spent and budget per category\n- Calculates spent by purchaseDate (budget impact), NOT dueDate\n- Handles categories with budgets but no spending (spent=0)\n- Handles spending in categories without budgets (budget=0 or null)\n\n#### 6. `copyBudgetsFromMonth(sourceMonth, targetMonth)` - Happy Paths\n- Copy budgets from previous month to current month\n- Copies all category budgets that don't exist in target\n- Copies monthlyBudget if exists in source\n- Skips categories that already have budgets in target month\n- Returns stats: { copied, skipped, total, monthlyBudgetCopied }\n\n### Edge Case Tests\n\n#### 1. Budget Amount Constraints\n- Negative amounts should fail (validation)\n- Zero amount is allowed\n- Very large amounts should work (within integer range)\n- Non-integer amounts should fail (stored as cents, must be integer)\n\n#### 2. YearMonth Format Validation\n- Valid format: \"YYYY-MM\" (2025-01, 2025-12)\n- Invalid format should fail validation\n- Month out of range (00, 13) should fail\n- Future months should be allowed\n- Past months should be allowed\n\n#### 3. Upsert Logic\n- upsertBudget called twice with same params → updates existing\n- getBudgetsForMonth shows latest amount after update\n- Verify no duplicates created\n\n#### 4. Spending Calculation Edge Cases\n- No spending for the month → totalSpent = 0\n- Spending in categories without budgets → included in totalSpent\n- Categories with budgets but no spending → spent = 0 in breakdown\n- Multiple entries in same category → sum correctly\n- Installment expenses → only entries in target month counted\n\n#### 5. Budget Deletion via Cascade\n- Delete category → budget should cascade delete\n- Verify ON DELETE CASCADE works\n- Update budget to 0 is not deletion (budget still exists)\n\n### Error Handling Tests\n\n#### 1. Upsert Budget Errors\n- Invalid categoryId (doesn't exist)\n- Invalid yearMonth format\n- Negative amount\n- Non-integer amount\n\n#### 2. Get Monthly Budget Errors\n- Invalid yearMonth format\n- Month with no monthly budget (returns null, not error)\n\n#### 3. Copy Budgets Errors\n- Source month has no budgets (no error, returns copied=0)\n- Invalid yearMonth formats\n- Source same as target (no error, no budgets copied)\n\n#### 4. Referential Integrity\n- Create budget for non-existent category (should fail FK constraint)\n- Create budget for another user's category (should fail userId check or FK)\n\n### Integration Tests\n\n#### 1. Budget-Spending Calculation\n- Create budgets and expenses for month\n- Verify getBudgetsWithSpending calculates correctly\n- Spending filtered by purchaseDate in month range\n- Verify spending = sum of entry amounts\n- Verify totalBudget = sum of category budget amounts\n\n#### 2. Category-Budget Relationship\n- Create category → create budget\n- Delete category → budget should cascade delete\n- getBudgetsForMonth should not include deleted category's budget\n\n#### 3. Monthly Budget Integration\n- Set monthly budget → getMonthlyBudget returns it\n- Create category budgets → monthlyBudget is separate\n- Total budget = monthlyBudget OR sum of category budgets (depending on usage)\n- Test how dashboard uses monthlyBudget vs category budgets\n\n#### 4. Multi-Month Data\n- Create budgets for Jan and Feb\n- Query Jan → only Jan budgets returned\n- Query Feb → only Feb budgets returned\n- Verify months don't leak into each other\n\n#### 5. User Isolation\n- Create budgets for two users\n- User A cannot see User B's budgets\n- User A cannot update/delete User B's budgets\n- getBudgetsForMonth returns only current user's budgets\n\n#### 6. Copy Budgets Logic\n- Source: 3 budgets, Target: 1 budget (different category)\n- Result: 2 copied (categories not in target), 1 skipped\n- Verify monthlyBudget copied if exists in source\n- Verify budgets that exist in target are not overwritten\n\n#### 7. Budget Progress Calculation\n- Budget \u003e spent → percentage \u003c 100%\n- Budget = spent → percentage = 100%\n- Budget \u003c spent → percentage \u003e 100%\n- Budget = 0, spent \u003e 0 → division by zero (handle this case)\n- Spent = 0, budget \u003e 0 → percentage = 0%\n\n#### 8. Installment Expenses and Budgets\n- Create 3-installment expense in Jan\n- Each installment appears in different month\n- Verify each month's budget only counts that month's installment\n- Verify totalSpent per month is correct\n\n### Revalidation Tests\n\n#### 1. Cache Invalidation\n- upsertBudget → revalidatePath('/settings/budgets') and '/budgets' called\n- upsertMonthlyBudget → revalidatePath('/settings/budgets') called\n- Verify caching works correctly (use React cache)\n\n### Business Logic Tests\n\n#### 1. Budget Types\n- Per-category budgets (budgets table)\n- Monthly total budget (monthlyBudgets table)\n- How they interact and are used in dashboard\n\n#### 2. Zero Budgets\n- Budget of 0 is valid\n- Spending \u003e 0 with budget of 0 → over budget\n- Should display correctly in UI (red progress bar)\n\n#### 3. Missing Budgets\n- Category with spending but no budget\n- Should appear in breakdown with budget = 0 or null\n- Dashboard should handle this correctly\n\n### Test File Location\n`/test/lib/actions/budgets.test.ts`\n\n### Implementation Notes\n- Create category fixtures for testing\n- Mock auth with test user ID\n- Use in-memory PGlite database\n- Test spending calculation logic extensively (critical)\n- Test purchaseDate vs dueDate filtering\n- Test user isolation extensively\n- Test cascade delete with categories\n- Follow pattern from expenses.test.ts\n- Verify money handling in cents (conversion utilities)\n","created_at":"2026-01-05T13:43:32Z"}]}
{"id":"northstar-v0d","title":"Tests: Categories - Test CRUD operations","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T10:27:32.665432-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T11:03:48.280287-03:00","closed_at":"2026-01-05T11:03:48.280287-03:00","close_reason":"Closed","comments":[{"id":4,"issue_id":"northstar-v0d","author":"caiodgallo","text":"# User Journey: Categories CRUD\n\n## Server Actions: `/lib/actions/categories.ts`\n\n### Happy Path Tests\n\n#### 1. `getCategories(type?)`\n- Returns all expense categories (no filter)\n- Returns all income categories (filter by type='income')\n- Returns empty array if no categories\n- Ordered by name alphabetically\n- Filters by userId correctly (user isolation)\n\n#### 2. `createCategory(data)` - Happy Paths\n- Create expense category successfully\n- Create income category successfully\n- Create category with custom color\n- Create category with icon\n- Create category with both color and icon\n- Create category without icon (icon = null)\n- Verify userId is auto-assigned\n- Verify default color is '#6b7280' when not provided\n- Verify default type is 'expense' when not provided\n\n#### 3. `updateCategory(id, data)` - Happy Paths\n- Update category name\n- Update category color\n- Update category icon\n- Update category type (expense ↔ income)\n- Update all fields simultaneously\n- Verify both id and userId must match (cannot update another user's category)\n\n#### 4. `deleteCategory(id)` - Happy Paths\n- Delete unused category successfully\n- Verify both id and userId must match\n- Verify category no longer exists after deletion\n- Verify returns { success: true }\n\n### Edge Case Tests\n\n#### 1. Category Name Constraints\n- Empty name should fail (validation)\n- Very long name (should work but test it)\n- Duplicate names (should be allowed - no unique constraint)\n- Special characters in name (should work)\n- Names with spaces (should work)\n- Leading/trailing whitespace (should be trimmed or preserved)\n\n#### 2. Color Constraints\n- Valid hex colors (6 digits with # prefix)\n- Invalid color formats (should fail validation)\n- Empty color (should use default or fail?)\n- Very long color string (should fail)\n\n#### 3. Icon Validation\n- Valid icon names from predefined list (38 icons)\n- Invalid icon names (should fail validation)\n- Null icon (should be allowed)\n- Empty string icon (should fail or convert to null?)\n- Icon case sensitivity\n\n#### 4. Type Constraints\n- Valid types: 'expense', 'income'\n- Invalid type should be rejected\n\n#### 5. Referential Integrity on Delete\n- Delete category used by transactions → should fail with error\n- Delete category used by income → should fail with error\n- Verify error message is user-friendly (\"Cannot delete category with transactions/income\")\n- Delete category used by budgets → should succeed (CASCADE)\n  - Verify budgets are deleted when category deleted (ON DELETE CASCADE)\n\n### Error Handling Tests\n\n#### 1. Create Category Errors\n- Missing required fields (name, type)\n- Invalid type\n- Invalid color format\n- Invalid icon name\n\n#### 2. Update Category Errors\n- Update non-existent category\n- Update category belonging to another user\n- Invalid data (color, icon, type)\n\n#### 3. Delete Category Errors\n- Delete non-existent category\n- Delete category belonging to another user\n- Delete category with transactions (error returned, not exception)\n- Delete category with income (error returned, not exception)\n\n### Integration Tests\n\n#### 1. Category-Transaction Relationship\n- Create category → create expense with this category\n- Try to delete category → should fail\n- Update expense to different category → delete original → should succeed\n- Verify transactions reference correct category\n\n#### 2. Category-Income Relationship\n- Create category → create income with this category\n- Try to delete category → should fail\n- Update income to different category → delete original → should succeed\n- Verify income references correct category\n\n#### 3. Category-Budget Relationship\n- Create category → create budget for this category\n- Delete category → budget should cascade delete\n- Verify foreign key cascade works correctly\n\n#### 4. User Isolation\n- Create categories for two users\n- User A cannot see User B's categories\n- User A cannot update/delete User B's categories\n- getCategories() returns only current user's categories\n\n#### 5. Type Filtering\n- Create expense categories and income categories\n- getCategories('expense') → only expense categories\n- getCategories('income') → only income categories\n- getCategories() → all categories\n\n#### 6. Category Uniqueness and Display\n- Create categories with same name but different types (should work)\n- Create categories with same name but different users (should work)\n- Verify they appear correctly in UI (distinguished by type/user)\n\n#### 7. Icon Picker Integration\n- Verify all 38 predefined icons are valid\n- Test CategoryIcon component with each icon (if testing UI)\n- Verify icon display in category cards\n\n### Revalidation Tests\n\n#### 1. Cache Invalidation\n- createCategory → revalidatePath('/settings/categories') called\n- updateCategory → revalidatePath('/settings/categories') called\n- deleteCategory → revalidatePath('/settings/categories') called\n- Verify tags: 'categories', 'expense-categories', 'income-categories' revalidated\n\n### Business Logic Tests\n\n#### 1. Category Type Usage\n- Expense categories can only be used for transactions\n- Income categories can only be used for income\n- Verify type is enforced in forms (if testing UI)\n\n#### 2. Default Values\n- Default color: '#6b7280'\n- Default type: 'expense'\n- Default icon: null\n\n### Test File Location\n`/test/lib/actions/categories.test.ts`\n\n### Implementation Notes\n- Use existing fixtures (testCategories)\n- Mock auth with test user ID\n- Use in-memory PGlite database\n- Test referential integrity checks before deletion (explicit query)\n- Test icon name validation (type guard)\n- Test user isolation extensively\n- Test cascade delete with budgets\n- Follow pattern from expenses.test.ts\n","created_at":"2026-01-05T13:43:32Z"}]}
{"id":"northstar-vzq","title":"Phase 3: Translate income.ts server action errors","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:29.216082-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T09:43:54.219678-03:00","closed_at":"2026-01-05T09:43:54.219678-03:00","close_reason":"Closed"}
{"id":"northstar-wvj","title":"Tests: Faturas - Test CRUD operations and payment flows","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-05T10:27:32.106982-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T10:27:32.106982-03:00","dependencies":[{"issue_id":"northstar-wvj","depends_on_id":"northstar-aos","type":"blocks","created_at":"2026-01-05T10:46:48.414587-03:00","created_by":"caiodgallo"}],"comments":[{"id":2,"issue_id":"northstar-wvj","author":"caiodgallo","text":"# User Journey: Faturas CRUD\n\n## Server Actions: `/lib/actions/faturas.ts`\n\n### Happy Path Tests\n\n#### 1. `ensureFaturaExists(accountId, yearMonth)`\n- Creates fatura for account/month that doesn't exist\n- Does nothing if fatura already exists (no duplicate)\n- Sets initial totalAmount to 0\n- Calculates dueDate correctly from account billing config\n- Uses fallback values (day 1/7) if no billing config\n\n#### 2. `updateFaturaTotal(accountId, yearMonth)`\n- Sums all entries for the fatura correctly\n- Updates totalAmount field with correct sum\n- Handles fatura with no entries (totalAmount should be 0)\n- Handles fatura with multiple entries\n\n#### 3. `getFaturasByMonth(yearMonth)`\n- Returns all faturas for specific month\n- Includes account information via join\n- Orders by account name\n- Returns empty array if no faturas for month\n\n#### 4. `getFaturasByAccount(accountId)`\n- Returns all faturas for specific account\n- Orders by month descending (newest first)\n- Returns empty array if account has no faturas\n\n#### 5. `getFaturaWithEntries(faturaId)`\n- Returns fatura with all its entries\n- Joins with transactions and categories\n- Includes correct entry details (description, amounts, category info, installment numbers)\n- Returns null if fatura not found\n\n### Edge Case Tests\n\n#### 1. Billing Configuration Edge Cases\n- Account with closingDay=1 (all purchases go to next month)\n- Account with closingDay=28 (all purchases go to current month)\n- Account with paymentDueDay \u003c= closingDay (payment due next month)\n- Account with paymentDueDay \u003e closingDay (payment due same month)\n- Account without billing config (uses fallback due dates)\n\n#### 2. Fatura Creation on Expense Creation\n- Create credit card expense → fatura created for correct month\n- Create installment expense spanning multiple months → faturas created for each month\n- Create expense on closing day → goes to current month's fatura\n- Create expense day after closing day → goes to next month's fatura\n\n#### 3. Fatura Update on Expense Changes\n- Update expense amount → fatura total updated correctly\n- Update expense date → moves entry to different fatura, both faturas updated\n- Delete expense → fatura total decreased correctly\n- Last entry deleted → fatura total becomes 0 (fatura still exists)\n\n#### 4. Multiple Credit Cards\n- Create expenses on different credit cards\n- Verify faturas created for each account\n- Verify each fatura has correct total for its account\n- Query by month returns all faturas for all accounts\n\n### Payment Flow Tests\n\n#### 5. `payFatura(faturaId, fromAccountId)` - Happy Paths\n- Pays unpaid fatura successfully\n- Marks fatura as paid (paidAt set)\n- Sets paidFromAccountId\n- Marks all entries in fatura as paid\n- Cannot pay same fatura twice (error: faturaAlreadyPaid)\n- Cannot pay from credit card (error: cannotPayFromCreditCard)\n- Validates fatura exists (error: faturaNotFound)\n\n#### 6. `markFaturaUnpaid(faturaId)` - Happy Paths\n- Marks paid fatura as unpaid\n- Clears paidAt timestamp\n- Clears paidFromAccountId\n- Marks all entries in fatura as unpaid (paidAt = null)\n- Can re-mark as paid after marking unpaid\n\n### Integration Tests\n\n#### 1. Expense-Fatura Lifecycle\n- Create expense → fatura created → expense deleted → fatura total updated\n- Update expense → fatura total recalculated\n- Entry moves between faturas (date change) → both faturas updated\n\n#### 2. Payment-Repayment Cycle\n- Pay fatura → verify all entries marked paid\n- Mark unpaid → verify all entries marked pending\n- Pay again → verify works correctly\n\n#### 3. Multiple Faturas Same Month\n- Multiple credit cards with expenses in same month\n- Verify each fatura has correct total\n- Pay one fatura → doesn't affect other faturas\n- Verify account isolation\n\n#### 4. Fatura with Zero Total\n- Fatura created but all entries deleted\n- Verify totalAmount is 0\n- Can still be paid (edge case, should work)\n- Verify display handles zero correctly\n\n#### 5. User Isolation\n- Create faturas for different users with same accounts (different userId)\n- Query by user → returns only user's faturas\n- Verify no data leakage\n\n### Data Integrity Tests\n\n#### 1. Cascade Deletion\n- Delete account → all faturas cascade deleted\n- Verify foreign key constraint works\n\n#### 2. Fatura Uniqueness\n- Try to create duplicate fatura for same account+month\n- Verify unique constraint prevents duplicates\n\n#### 3. Entry-Fatura Consistency\n- Entries must have faturaMonth matching account billing logic\n- Verify updateFaturaTotal uses correct faturaMonth filter\n- Test edge cases around closing day\n\n### Test File Location\n`/test/lib/actions/faturas.test.ts`\n\n### Implementation Notes\n- Use existing fixtures (creditCardWithBilling)\n- Mock auth with test user ID\n- Use in-memory PGlite database\n- Test billing cycle logic extensively (critical for faturas)\n- Verify fatura total calculations match entry sums\n- Follow pattern from expenses.test.ts\n","created_at":"2026-01-05T13:40:39Z"}]}
{"id":"northstar-xr3","title":"Phase 2: Translate login page (/app/(auth)/login/page.tsx)","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-05T07:06:15.839799-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T07:10:52.118484-03:00","closed_at":"2026-01-05T07:10:52.118484-03:00","close_reason":"Closed"}
