{"id":"northstar-08t","title":"Test deleteEvent with cascade cleanup","description":"5 test cases: deletion, cascade to notificationJobs/notifications/recurrenceRules, handling missing related records","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-08T07:13:07.934545-03:00","created_by":"caiodgallo","updated_at":"2026-01-08T08:45:06.805725-03:00","closed_at":"2026-01-08T08:45:06.805725-03:00","close_reason":"Added 8 test cases covering deleteEvent: basic deletion, cascade to notificationJobs/notifications/recurrenceRules, missing related records, ownership check, non-existent event, and revalidation","dependencies":[{"issue_id":"northstar-08t","depends_on_id":"northstar-s19","type":"blocks","created_at":"2026-01-08T07:13:25.448697-03:00","created_by":"caiodgallo"},{"issue_id":"northstar-08t","depends_on_id":"northstar-5ad","type":"blocks","created_at":"2026-01-08T07:13:25.633569-03:00","created_by":"caiodgallo"},{"issue_id":"northstar-08t","depends_on_id":"northstar-62p","type":"parent-child","created_at":"2026-01-08T07:13:41.483803-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-0a6","title":"Create natural language parser (lib/natural-language-parser.ts)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T07:25:20.048921-03:00","created_by":"caiodgallo","updated_at":"2026-01-09T07:28:13.853679-03:00","closed_at":"2026-01-09T07:28:13.853679-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-0a6","depends_on_id":"northstar-ss7","type":"blocks","created_at":"2026-01-09T07:25:29.949926-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-0be","title":"Translate the dashboard widgets","description":"The dashboard page widgets are still mainly hardcoded strings. They need to following the internalitzation pattern established accross the codebase and translated the suitable strings. Mainly UI components and layout at the present moment.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T12:28:42.274869-03:00","created_by":"caiodgallo","updated_at":"2026-01-02T14:11:27.158751-03:00","closed_at":"2026-01-02T14:11:27.158751-03:00","close_reason":"Closed"}
{"id":"northstar-0c8","title":"Phase 4: Translate file-dropzone component","description":"Phase 4: Translate file-dropzone component\n\nFile: components/import-expenses/file-dropzone.tsx\n\nThis component has hardcoded strings that need translation:\n- Error messages ('Please select a CSV file', 'Failed to read file')\n- Drag and drop text\n\nSteps:\n1. Add useTranslations('fileDropzone') hook\n2. Replace all hardcoded strings with t() calls\n3. Add missing translation keys to messages/en.json and messages/pt-BR.json\n4. Verify dropzone works correctly in both languages\n\nExample translation key structure (already exists in messages):\nfileDropzone.invalidFileType, fileDropzone.failedToRead, fileDropzone.dragAndDropText","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T07:06:45.504066-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T09:58:48.749442-03:00","closed_at":"2026-01-05T09:58:48.749442-03:00","close_reason":"Closed"}
{"id":"northstar-0ga","title":"Use user settings for notification preferences","description":"User settings table exists but fields are ignored: notificationEmail (use for sending), timezone (use for display), notificationsEnabled (check before scheduling).","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-07T08:11:34.423903-03:00","created_by":"caiodgallo","updated_at":"2026-01-08T07:44:03.973058-03:00","closed_at":"2026-01-08T07:44:03.973058-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-0ga","depends_on_id":"northstar-vau","type":"blocks","created_at":"2026-01-07T08:11:57.653995-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-0pt","title":"Phase 4: Translate category-form component","description":"Phase 4: Translate category-form component\n\nFile: components/category-form.tsx\n\nThis component has hardcoded strings that need translation:\n- Form labels (Name, Color, Icon)\n- Buttons (Save, Cancel, Create, Update, Saving...)\n- Error messages\n\nSteps:\n1. Add useTranslations('categoryForm') hook\n2. Replace all hardcoded strings with t() calls\n3. Add missing translation keys to messages/en.json and messages/pt-BR.json\n4. Verify form works correctly in both languages\n\nExample translation key structure (already exists in messages):\ncategoryForm.name, categoryForm.color, categoryForm.icon, categoryForm.save, etc.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T07:06:44.602898-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T09:58:48.441613-03:00","closed_at":"2026-01-05T09:58:48.441613-03:00","close_reason":"Closed"}
{"id":"northstar-0q7","title":"Implement proper account balance tracking and transfer system for fatura payments","description":"# Problem Statement\n\nCredit card fatura payments create a double-counting risk in expense tracking:\n- Expenses are logged when card is swiped (e.g., R$500 at restaurant)\n- Fatura payment from checking account could be mistakenly logged as another expense\n- Result: R$500 counted twice in financial reports\n\n# Current Architecture (Correct Foundation)\n\nThe app correctly implements **accrual-based accounting with implicit transfers**:\n\n## How it works:\n1. Credit card purchases = expenses tracked immediately via `entries.purchaseDate` (budget impact)\n2. Credit card = liability account (debt owed to bank)\n3. Fatura payment = internal transfer from checking → credit card (NOT an expense)\n4. `faturas.paidFromAccountId` tracks which account paid the bill\n\n## Schema support:\n```\nentries.purchaseDate → budget impact (when expense occurred)\nentries.faturaMonth → which bill it belongs to\nentries.paidAt → marks individual charges as settled\nfaturas.paidAt → marks entire bill as paid\nfaturas.paidFromAccountId → transfer source\n```\n\n## What works:\n✅ Expenses tracked at purchase time\n✅ Fatura payment doesn't create duplicate expense\n✅ Source account tracking via paidFromAccountId\n✅ Entry-level and fatura-level paid status\n\n# Gaps in Current Implementation\n\n## 1. No Account Balances\n- Accounts have no running balance field\n- Can't show checking account decreased after paying fatura\n- Can't display available funds or liability totals\n\n## 2. No Transfer Table\n- Fatura payments are implicit transfers (via paidFromAccountId)\n- No audit trail for account-to-account movements\n- Can't track general transfers (checking → savings)\n- Can't generate cash flow reports\n\n## 3. No Income Integration with Balances\n- Income has `receivedAt` but doesn't affect account balances\n- Can't show salary deposits increasing checking balance\n\n# Recommended Implementation (Option 2 Enhancement)\n\n## Add Transfers Table\n\n```typescript\ntransfers: {\n  id: uuid\n  userId: uuid\n  fromAccountId: uuid    // checking account\n  toAccountId: uuid      // credit_card or other account\n  amount: integer        // cents\n  date: date\n  type: 'fatura_payment' | 'internal_transfer' | 'deposit' | 'withdrawal'\n  faturaId?: uuid        // links to fatura when type=fatura_payment\n  description?: text\n  createdAt: timestamp\n}\n```\n\n## Add Balance Tracking to Accounts\n\n```typescript\naccounts: {\n  // ... existing fields\n  currentBalance: integer  // cents, can be negative for credit cards\n  lastBalanceUpdate: timestamp\n}\n```\n\n## Update payFatura() Logic\n\nCurrent flow (`/lib/actions/faturas.ts:161-226`):\n1. Validate source account is NOT credit card\n2. Mark fatura.paidAt and paidFromAccountId\n3. Mark all entries as paid\n\nEnhanced flow:\n1. Validate source account\n2. **Create transfer record** (checking → credit_card)\n3. Mark fatura as paid (with transferId reference)\n4. Mark all entries as paid\n5. **Update account balances**:\n   - Decrease fromAccount balance by fatura amount\n   - Decrease credit card liability by fatura amount (towards zero)\n\n## Add Balance Calculation Functions\n\nIn `/lib/actions/accounts.ts`:\n```typescript\nasync function calculateAccountBalance(accountId: string): Promise\u003cnumber\u003e\nasync function updateAccountBalance(accountId: string, amount: number, operation: 'add' | 'subtract')\nasync function getAccountsWithBalances(userId: string)\n```\n\n# Implementation Steps\n\n1. **Create transfers schema** - Add table with relations\n2. **Add balance fields to accounts** - Migration for currentBalance\n3. **Create transfer actions** - CRUD for general transfers\n4. **Update payFatura()** - Create transfer record, update balances\n5. **Add balance calculation utils** - Recalculate from history\n6. **Update UI components**:\n   - Show balances in account cards\n   - Display transfers in transaction history\n   - Cash flow reports (income, expenses, transfers)\n7. **Add balance reconciliation** - Periodic job to ensure accuracy\n\n# Benefits\n\n✅ Complete audit trail of all money movements\n✅ Real-time account balances\n✅ Cash flow analysis (not just expenses)\n✅ Transfer between checking/savings support\n✅ No double-counting risk\n✅ Matches industry standard (YNAB, Copilot approach)\n\n# Files to Modify\n\n- `/lib/schema.ts` - Add transfers table, balance field\n- `/lib/actions/faturas.ts` - Update payFatura()\n- `/lib/actions/transfers.ts` - New file for transfer logic\n- `/lib/actions/accounts.ts` - Add balance functions\n- `/components/pay-fatura-dialog.tsx` - Update to create transfer\n- Dashboard components - Display balances\n\n# Testing Considerations\n\n- Balance accuracy after fatura payments\n- Transfer creation idempotency\n- Concurrent payment handling\n- Balance reconciliation from history\n- Migration for existing paid faturas (backfill transfers)","notes":"Plan:\n1) Review current schema/actions/UI to understand fatura payment flow, account/income models, and any existing balance/transfer concepts.\n2) Design DB changes: transfers table, account balance fields, fatura linkage; outline migration/backfill strategy for existing data.\n3) Implement backend logic: transfer actions, balance calculation/update helpers, and payFatura() changes to create transfers and adjust balances.\n4) Update UI to display balances and transfers where needed; ensure pay-fatura dialog uses new flow.\n5) Add/adjust tests or verification steps; capture any follow-ups as bd issues.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-08T11:51:52.395453-03:00","created_by":"caiodgallo","updated_at":"2026-01-08T13:17:19.650606-03:00","closed_at":"2026-01-08T13:17:19.650606-03:00","close_reason":"Closed"}
{"id":"northstar-0qa","title":"Tests: Dashboard - Test components and edge cases","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T10:27:33.121251-03:00","created_by":"caiodgallo","updated_at":"2026-01-14T11:27:20.871955-03:00","closed_at":"2026-01-05T12:51:57.777284-03:00","dependencies":[{"issue_id":"northstar-0qa","depends_on_id":"northstar-797","type":"blocks","created_at":"2026-01-05T10:46:49.242092-03:00","created_by":"caiodgallo"}],"comments":[{"id":1,"issue_id":"northstar-0qa","author":"caiodgallo","text":"# User Journey: Dashboard Components\n\n## Components to Test\n\nThis focuses on testing the React components that display dashboard data. Component testing is lower priority than server action testing, but important for edge cases and user experience.\n\n### 1. BalanceSummary Component\n\n**Location:** `/components/balance-summary.tsx`\n\n**Tests:**\n\n- **Display Tests:**\n  - Shows total income, expenses, and net balance\n  - Colors: Green for positive balance, Red for negative\n  - Progress bar shows percentage of income spent\n  - Handles zero values correctly\n\n- **Edge Cases:**\n  - Zero income, zero expenses → shows 0, progress = 0%\n  - Zero income, positive expenses → division by zero (handle gracefully)\n  - Positive income, zero expenses → progress = 0%, full green bar\n  - Income = expenses → progress = 100%, net balance = 0\n  - Expenses \u003e income → negative balance, progress \u003e 100% (red)\n  - Very large amounts → formatted correctly (currency)\n\n- **Internationalization:**\n  - Displays correctly in English\n  - Displays correctly in Portuguese\n  - Currency formatting (R$ with correct decimal separator)\n\n### 2. SummaryCard Component\n\n**Location:** `/components/summary-card.tsx`\n\n**Tests:**\n\n- **Display Tests:**\n  - Shows total spent, total budget, remaining\n  - Progress bar: Red (\u003e100%), Yellow (80-100%), Green (\u003c80%)\n  - Remaining = budget - spent\n  - Handles over budget (negative remaining)\n\n- **Edge Cases:**\n  - Budget = 0, spent \u003e 0 → over budget\n  - Spent = 0, budget \u003e 0 → all remaining\n  - Spent = 0, budget = 0 → shows zeros\n  - Spent \u003e budget → negative remaining, red progress bar\n  - Spent = budget → zero remaining, yellow progress bar\n  - Missing budget (null) → handle gracefully\n  - Very large amounts → formatted correctly\n\n- **Color Coding:**\n  - spent/budget \u003c 0.8 → green\n  - spent/budget = 0.8-1.0 → yellow\n  - spent/budget \u003e 1.0 → red\n  - Test exact boundary values (0.8, 1.0)\n\n### 3. BudgetProgress Component\n\n**Location:** `/components/budget-progress.tsx`\n\n**Tests:**\n\n- **Display Tests:**\n  - Shows category icon, name, spent, budget\n  - Shows percentage\n  - Progress bar: Red (\u003e100%), Yellow (80-100%), Green (\u003c80%)\n  - Icon colored with category color\n\n- **Edge Cases:**\n  - Budget = 0, spent \u003e 0 → infinite percentage (handle gracefully)\n  - Spent = 0, budget \u003e 0 → 0% progress\n  - Spent = budget → 100% progress\n  - Spent \u003e budget → \u003e100% progress, red bar\n  - Missing budget (null) → show spent only? or 0?\n  - Missing icon → show default or nothing\n\n- **Icon Display:**\n  - Renders correct icon for category\n  - Applies category color to icon background\n  - Handles null icon gracefully\n\n- **Percentage Calculation:**\n  - Math.round() for display\n  - Test rounding edge cases (49.5%, 50.5%)\n\n### 4. RecentExpenses Component\n\n**Location:** `/components/recent-expenses.tsx`\n\n**Tests:**\n\n- **Display Tests:**\n  - Shows list of 5 most recent expenses\n  - Each item: icon, description, category name, account name, amount, date\n  - Links to full expenses page\n  - Empty state when no expenses exist\n\n- **Edge Cases:**\n  - No expenses → shows empty state message\n  - 1 expense → shows 1 item\n  - 5 expenses → shows 5 items\n  - \u003e5 expenses → shows only 5 most recent\n  - Expense without icon → handles gracefully\n  - Expense with very long description → truncates or wraps?\n  - Expense with very large amount → formatted correctly\n\n- **Ordering:**\n  - Verify ordered by createdAt DESC (most recent first)\n  - Test with expenses created at different times\n\n- **Link Navigation:**\n  - Clicking expense navigates to /expenses page\n  - Verifies query params are correct (month filter)\n\n### 5. MonthPicker Component\n\n**Location:** `/components/month-picker.tsx`\n\n**Tests:**\n\n- **Display Tests:**\n  - Shows current month name in Portuguese\n  - Previous/Next navigation buttons\n  - Prefetches adjacent months for performance\n\n- **Navigation:**\n  - Clicking \"Previous\" → goes to previous month\n  - Clicking \"Next\" → goes to next month\n  - Updates URL query param for yearMonth\n  - Navigates to correct route\n\n- **Date Arithmetic:**\n  - Jan → Previous → Dec previous year\n  - Dec → Next → Jan next year\n  - Feb 28 → Previous → Jan\n  - Test leap year (Feb 29)\n\n- **Internationalization:**\n  - Month names in Portuguese (janeiro, fevereiro, etc.)\n  - Correct formatting\n\n### Integration Tests\n\n#### 6. Dashboard Page Component\n\n**Location:** `/app/(app)/dashboard/page.tsx`\n\n**Tests:**\n\n- **Data Fetching:**\n  - Calls getDashboardData with correct yearMonth\n  - Uses URL query param or current month\n  - Renders with fetched data\n  - Shows loading state while fetching\n\n- **Component Integration:**\n  - BalanceSummary receives correct props\n  - SummaryCard receives correct props\n  - BudgetProgress cards receive correct props\n  - RecentExpenses receives correct props\n\n- **Empty States:**\n  - No budgets → shows message with link to settings\n  - No expenses → RecentExpenses shows empty state\n  - No income → BalanceSummary shows 0 income\n\n- **Month Navigation:**\n  - MonthPicker updates URL\n  - Dashboard refetches data for new month\n  - Components update with new data\n\n- **Responsive Layout:**\n  - Mobile: single column layout\n  - Desktop: 3-column grid (lg:grid-cols-3)\n  - Correct responsive classes applied\n\n### Loading States\n\n#### 7. Dashboard Loading Skeleton\n\n**Location:** `/app/(app)/dashboard/loading.tsx`\n\n**Tests:**\n\n- Shows skeleton placeholders\n- Matches final layout structure\n- Correct number of skeleton items\n- Renders while data is loading\n\n### Edge Cases \u0026 Error Handling\n\n#### 8. Data Validation\n\n- Missing data fields (null/undefined) → handle gracefully\n- Unexpected data types → handle or show error\n- Very large numbers → formatted correctly\n- Negative values where unexpected → handle appropriately\n\n#### 9. Internationalization\n\n- All components use useTranslations() hook\n- Test switching between pt-BR and en\n- All text displays in correct language\n- Currency formatting uses locale (R$, comma for decimals)\n\n#### 10. Accessibility\n\n- Semantic HTML elements\n- ARIA labels where appropriate\n- Keyboard navigation works\n- Color contrast is adequate\n- Screen reader compatibility\n\n### Test File Location\n`/test/components/dashboard.test.ts`\n\n### Implementation Notes\n- Use React Testing Library (@testing-library/react)\n- Use Vitest with happy-dom environment\n- Mock server actions (getDashboardData)\n- Test component rendering, props, and user interactions\n- Test edge cases with different data scenarios\n- Test internationalization (both pt-BR and en)\n- Component testing is lower priority than server action testing\n- Focus on critical edge cases and user experience\n- Don't test shadcn/ui components (they're tested by the library)\n","created_at":"2026-01-05T13:43:32Z"}]}
{"id":"northstar-0uc","title":"Add check constraint for task completedAt/status invariant","description":"File: lib/schema.ts tasks table. Enforce that completedAt is non-null when status='completed' and null otherwise. Prevents invalid state where task is pending but has completedAt.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T08:13:14.5527-03:00","created_by":"caiodgallo","updated_at":"2026-01-07T08:59:53.548571-03:00","closed_at":"2026-01-07T08:59:53.548571-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-0uc","depends_on_id":"northstar-vau","type":"blocks","created_at":"2026-01-07T08:13:28.586563-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-110","title":"Fix: FAB modal shows 'Saving...' instead of optimistic UI","description":"## Problem\nThe FAB (Floating Action Button) and BottomTabBar modals show \"Saving...\" and wait for server response when creating expenses/income. They don't use optimistic UI like the list pages do.\n\n## Root Cause\nReact Context flows DOWN the component tree, not UP. Architecture issue:\n\n```\nLayout (app/(app)/layout.tsx)\n├── SidebarInset\n│   └── {children}  ← ExpenseListProvider/IncomeListProvider live HERE (page level)\n├── FAB (lines 38-43)\n│   └── TransactionForm  ← OUTSIDE providers, context = null\n└── BottomTabBar (lines 46-50)\n    └── TransactionForm  ← OUTSIDE providers, context = null\n```\n\n## What Happens\n1. User clicks FAB → opens TransactionForm\n2. `useExpenseContextOptional()` returns `null` (not inside provider)\n3. Falls back to: `await createExpense(data)` (line 137 in transaction-form.tsx)\n4. This IS blocking - modal waits for server\n5. \"Saving...\" persists until server completes\n\n## Solution: Fire-and-Forget in Form\nMake TransactionForm fire-and-forget when creating NEW items without context.\n\n**File: components/transaction-form.tsx**\n\nChange lines 136-138 from:\n```typescript\n} else {\n  await createExpense(data);  // BLOCKING\n}\n```\n\nTo:\n```typescript\n} else {\n  createExpense(data).catch(() =\u003e {\n    toast.error('Failed to create expense');\n  });\n}\n```\n\nSame for income (lines 165-167).\n\n## Files Involved\n- `components/transaction-form.tsx` - Form submission logic\n- `components/fab.tsx` - Desktop FAB (renders form outside context)\n- `components/bottom-tab-bar.tsx` - Mobile FAB (renders form outside context)\n- `lib/contexts/expense-context.tsx` - Optimistic context (works correctly)\n- `lib/contexts/income-context.tsx` - Optimistic context (works correctly)\n- `app/(app)/layout.tsx` - Where FAB/BottomTabBar mount\n- `app/(app)/expenses/page.tsx` - Where ExpenseListProvider lives\n- `app/(app)/income/page.tsx` - Where IncomeListProvider lives\n\n## Alternative Solutions\n1. Move providers to layout level (more complex, requires layout data fetching)\n2. Pass server actions as props to FAB (messy prop drilling)\n3. Use global state management (overkill for this)\n\nFire-and-forget in form is simplest - ~10 line change.\n\n## Testing Checklist\n- [ ] FAB from dashboard (no context) - closes immediately\n- [ ] FAB from expenses page (has context) - uses optimistic flow\n- [ ] Mobile bottom tab bar - closes immediately\n- [ ] Error toast shows on failure\n- [ ] Success case: data appears after revalidation\n- [ ] Edit mode still awaits (important!)","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-04T07:28:53.698397-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T07:07:06.337665-03:00","closed_at":"2026-01-05T07:07:06.337665-03:00","close_reason":"Fixed by removing FAB and moving transaction forms to page-level buttons inside provider context. Forms now use optimistic updates via useExpenseContext/useIncomeContext."}
{"id":"northstar-18w","title":"Add authorization checks to recurrence rule actions","description":"File: lib/actions/recurrence.ts. updateRecurrenceRule() and deleteRecurrenceRule() don't verify user owns the item. Security vulnerability - any authenticated user can modify any recurrence rule.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-07T08:04:19.978177-03:00","created_by":"caiodgallo","updated_at":"2026-01-07T08:22:20.013404-03:00","closed_at":"2026-01-07T08:22:20.013404-03:00","close_reason":"Added authorization checks - verify user owns parent event/task before allowing recurrence rule updates/deletes","dependencies":[{"issue_id":"northstar-18w","depends_on_id":"northstar-vau","type":"blocks","created_at":"2026-01-07T08:11:52.580784-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-1ct","title":"Migrate drizzle/seed.ts to drizzle-seed and fix Playwright DB reset","description":"Switch drizzle/seed.ts to drizzle-seed (deterministic curated data via refine/valuesFromArray) and make Playwright E2E reset deterministic by running reset before each test + re-seeding E2E user after reset.","notes":"Progress: fixed Playwright reset (auto fixture) and seeded E2E user after reset. Converted drizzle/seed.ts to drizzle-seed with row-based seeding and explicit IDs to avoid PK collisions from GenerateIntPrimaryKey; sequences now reset via setval. db-reset now uses drizzle-seed reset.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T10:14:09.046514-03:00","created_by":"caiodgallo","updated_at":"2026-01-13T10:39:15.609856-03:00","closed_at":"2026-01-13T10:39:15.609856-03:00","close_reason":"Closed"}
{"id":"northstar-1y5","title":"Add fileDropzone namespace to en.json and pt-BR.json","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:03.598381-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T07:20:20.295131-03:00","closed_at":"2026-01-05T07:20:20.295131-03:00","close_reason":"Closed"}
{"id":"northstar-1z8","title":"Build: next build fails with null hash","description":"pnpm build fails with uncaughtException TypeError: Cannot read properties of null (reading 'hash') after serwist bundling; clearing .next fixes build (user reports build succeeds after deleting .next).","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T11:02:48.451065-03:00","created_by":"caiodgallo","updated_at":"2026-01-14T11:27:20.873284-03:00","closed_at":"2026-01-06T06:35:01.003548-03:00"}
{"id":"northstar-20d","title":"[BUG] Manually created expense setting date to the wrong month","description":"When creating an expense (maybe an income also) if I set the purchase date to 31 Dec 2025, the purchase date actually appears as 31 Jan 2026 (my current year month). So the day looks correct but month/year wrong","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-03T05:45:31.582448-03:00","created_by":"caiodgallo","updated_at":"2026-01-03T06:02:53.604548-03:00","closed_at":"2026-01-03T06:02:53.604548-03:00","close_reason":"Closed"}
{"id":"northstar-20h","title":"Phase 3: Calendar sync engine","description":"Create lib/actions/calendar-sources.ts with CRUD operations. Create lib/actions/calendar-sync.ts with syncCalendarSource() and syncAllCalendars(). Implement: fetch→parse→diff→upsert, recurring event expansion (6mo window, max 100), orphan detection/cancellation, retry logic (3 attempts).","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T07:28:52.243743-03:00","created_by":"caiodgallo","updated_at":"2026-01-09T09:18:38.986468-03:00","closed_at":"2026-01-09T09:18:38.986468-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-20h","depends_on_id":"northstar-p86","type":"parent-child","created_at":"2026-01-09T07:29:19.999664-03:00","created_by":"caiodgallo"},{"issue_id":"northstar-20h","depends_on_id":"northstar-5sz","type":"blocks","created_at":"2026-01-09T07:29:28.361202-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-2a2","title":"Consider discriminated union for ExtendedCalendarEvent","description":"ExtendedCalendarEvent allows invalid states like itemType without itemId.\n\nLocation: components/calendar/calendar-helpers.ts:11-19\n\nCurrent design issues:\n- Can have itemType without itemId or vice versa\n- When itemType='bill_reminder', amount/categoryId should be guaranteed present\n- No compile-time prevention of invalid states\n\nRecommendation: Use discriminated union pattern where each itemType has its own interface with required fields.\n\nBenefits:\n- Encapsulation: 2/5 → 4/5\n- Invariant Enforcement: 2/5 → 4/5\n- Type-safe narrowing in switch statements\n\nTrade-off: More verbose, potential breaking change\n\nFound by: type-design-analyzer agent\nConfidence: HIGH (good improvement but may be disruptive)","status":"open","priority":3,"issue_type":"task","owner":"caiogallo88@gmail.com","created_at":"2026-01-14T15:45:48.898491-03:00","created_by":"Caio Gallo","updated_at":"2026-01-14T15:45:48.898491-03:00","dependencies":[{"issue_id":"northstar-2a2","depends_on_id":"northstar-dal","type":"blocks","created_at":"2026-01-14T15:47:16.188802-03:00","created_by":"Caio Gallo"}]}
{"id":"northstar-2d6","title":"Add resetPassword namespace to en.json and pt-BR.json","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:02.722523-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T07:20:24.627128-03:00","closed_at":"2026-01-05T07:20:24.627128-03:00","close_reason":"forgotPassword and resetPassword namespaces already exist with complete translations"}
{"id":"northstar-2m9","title":"Lint: Fix edit-transaction-dialog warnings","description":"pnpm lint fails in components/edit-transaction-dialog.tsx: unused Income import and react-hooks/set-state-in-effect at line 51; refactor to avoid setState inside useEffect or suppress.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T11:02:22.213014-03:00","created_by":"caiodgallo","updated_at":"2026-01-14T11:27:20.873872-03:00","closed_at":"2026-01-05T12:52:23.237852-03:00"}
{"id":"northstar-2v2","title":"Phase 3: Translate faturas.ts server action errors","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:29.971636-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T09:47:32.122806-03:00","closed_at":"2026-01-05T09:47:32.122806-03:00","close_reason":"Closed"}
{"id":"northstar-30w","title":"Import installments: preserve per-row amounts + compute transaction total from actual rows","description":"Import logic for installment groups uses first row amount for all entries and totalAmount = installmentAmount * total. This can drift by 1–2 cents when issuer rounds last installment differently. Should sum actual row amounts (or distribute remainder) and store per-installment amounts accordingly.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-14T06:01:06.709745-03:00","created_by":"caiodgallo","updated_at":"2026-01-14T08:20:39.086679-03:00","closed_at":"2026-01-14T06:45:56.492887-03:00"}
{"id":"northstar-3hz","title":"Phase 3: Translate categories.ts server action errors","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:28.706789-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T09:41:05.830333-03:00","closed_at":"2026-01-05T09:41:05.830333-03:00","close_reason":"Closed"}
{"id":"northstar-3il","title":"Fix bill reminder recurrence validation and formatting","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T07:31:45.969368-03:00","created_by":"caiodgallo","updated_at":"2026-01-14T11:27:49.535979-03:00","closed_at":"2026-01-14T11:27:49.535979-03:00","close_reason":"Closed"}
{"id":"northstar-3v9","title":"Test production logging and error tracking integration","description":"Current coverage: 60% statements, 30% branches. Critical for production debugging and monitoring. Untested: error ID generation (72), Sentry integration (101-124), environment-specific behavior. Missing tests: logError with error IDs, logEvent for analytics, logForDebugging dev vs prod, error ID uniqueness. Real risk: lost error tracking in production = blind debugging. Sentry never receives errors = missed critical bugs. Error IDs collide = confusion in logs. Poor observability = slow incident response.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T16:27:47.835358-03:00","created_by":"caiodgallo","updated_at":"2026-01-12T17:30:29.883295-03:00","closed_at":"2026-01-12T17:30:29.883295-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-3v9","depends_on_id":"northstar-b91","type":"blocks","created_at":"2026-01-12T16:31:21.945063-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-3wk","title":"Fix dangerous type assertions in notification-jobs","description":"File: lib/actions/notification-jobs.ts:44,51. Using 'as unknown as [EventItem]' type casting. Should use proper type guards or satisfies pattern for type safety.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-07T08:04:43.393076-03:00","created_by":"caiodgallo","updated_at":"2026-01-07T08:32:09.166148-03:00","closed_at":"2026-01-07T08:32:09.166148-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-3wk","depends_on_id":"northstar-vau","type":"blocks","created_at":"2026-01-07T08:11:53.839109-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-42h","title":"Open add expense/income modal with keyboard open and amount input focused","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-03T18:10:44.464737-03:00","created_by":"caiodgallo","updated_at":"2026-01-03T18:15:09.494299-03:00","closed_at":"2026-01-03T18:15:09.494299-03:00","close_reason":"Closed"}
{"id":"northstar-48d","title":"Events and Tasks","description":"\n# Events and Tasks - Implementation Plan\n\n**Decisions:**\n- Email notifications: Resend\n- WhatsApp notifications: Ignored for now\n- Time zones: User timezone\n- Recurrence: RRULE using rrule.js\n- UI: Calendar page using schedule-x, month agenda view as main\n- Colors: Priority-based\n- Calendar: Single tab showing both events and tasks\n- Background worker: Vercel Cron + Serverless (free tier sufficient for single user)\n\n## Progress\n\n**Phase 1: Core Schema - COMPLETED**\n- Added events/tasks/recurrence_rules/notifications/notification_jobs tables to lib/schema.ts\n- Created migration 0006_ordinary_speed_demon.sql\n- Applied migration to database\n- Added type exports and relations\n\n**Phase 2: Backend Actions - COMPLETED**\n- Created lib/actions/events.ts (CRUD + status management)\n- Created lib/actions/tasks.ts (CRUD + status management)\n- Created lib/actions/recurrence.ts (RRULE validation + CRUD)\n- Created lib/actions/notifications.ts (config + scheduling)\n- Created lib/actions/notification-jobs.ts (cron processor + email send)\n\n**Phase 3: Recurrence Logic - COMPLETED**\n- Installed rrule.js\n- Created lib/recurrence.ts with helper functions (parse, expand, validate)\n\n**Phase 4: Notification Scheduling - COMPLETED**\n- Implemented scheduleNotificationJobs in notifications.ts\n- Integrated with create/update actions for events and tasks\n\n**Phase 5: Background Worker - COMPLETED**\n- Created /api/cron/notifications/route.ts with CRON_SECRET auth\n- Implemented job processing logic (batch processing, retry, cancellation)\n- Resend integration for email notifications\n- Added vercel.json with cron config (every 5 minutes)\n\n**Phase 6: UI - Calendar Page - COMPLETED**\n- Installed @schedule-x/react and dependencies\n- Created app/(app)/calendar/page.tsx with full calendar integration\n- Load real events/tasks from server actions\n- Implemented calendar-specific colors for events (blue) and tasks (green)\n- Added visual distinction between events and tasks\n- Added filter controls (by type, status, priority)\n- Added translation keys for calendar UI\n\n**Phase 7: UI - Forms - COMPLETED**\n- Created EventForm component with title, description, location, start/end date/time, all-day toggle, priority\n- Created TaskForm component with title, description, location, due date/time, optional start time and duration, priority, status\n- Add buttons to calendar page for creating events and tasks\n- Integrated forms with AlertDialog components\n- Forms handle both create and edit modes\n- Added translation keys for form fields in English and Portuguese\n- Forms validate date/time inputs\n- Reload calendar data after successful form submission\n- NOTE: Notification settings and recurrence rule editor not implemented - deferred to later\n\n**Phase 8: User Settings - COMPLETED**\n- Added user_settings table to schema with timezone, notification email, enabled flag, default offsets\n- Created migration 0007_tearful_rattler.sql\n- Created user-settings server actions (get, getOrCreate, update)\n- Created preferences page at /settings/preferences\n- Created PreferencesForm component for managing user settings\n- Added timezone selection with major cities list\n- Added notification offset options (0 min to 1 day)\n- Added translations for preferences in English and Portuguese\n- Added link to preferences from main settings page\n- Auto-creates user settings on first visit\n\n**Phase 9: Testing - COMPLETED**\n- Added comprehensive unit tests for recurrence logic in test/lib/recurrence.test.ts\n- Tests cover: parseRRule, expandOccurrences, getNextOccurrence, getAllOccurrencesBetween, isValidRRule, createSimpleRRule\n- Tests include edge cases: leap years, month boundaries, DST transitions\n- Tests include integration scenarios: multi-day events, recurring task due dates\n- All 14 test files passing with 342+ total tests\n\n**Phase 10: Polish - COMPLETED**\n- Add loading state to calendar page with centered spinner indicator\n- Add loading translation for calendar in English and Portuguese (\"Loading...\" / \"Carregando...\")\n- Improve user experience during data fetching\n- Skeleton loading UI with spinner\n- Better visual feedback for async operations\n\n## Implementation Complete\n\nAll 10 phases of the Events and Tasks feature are now complete:\n- Full backend with recurrence and notifications\n- Calendar UI with filters and colors\n- Event and Task forms\n- User settings for timezone and notifications\n- Comprehensive test coverage\n- Loading states and polish\n\n## Optional Future Enhancements (Not in Scope)\n\n1. Add notification settings to event and task forms (optional)\n2. Add recurrence rule editor to event and task forms (optional)\n3. Environment variables setup for production:\n   - RESEND_API_KEY\n   - RESEND_FROM_EMAIL\n   - CRON_SECRET\n   - NEXT_PUBLIC_APP_URL\n\n## Environment Variables Required for Notifications\n\n```env\nRESEND_API_KEY=re_xxxxxxxxx\nRESEND_FROM_EMAIL=noreply@yourdomain.com\nCRON_SECRET=your-secret-here\nNEXT_PUBLIC_APP_URL=https://your-domain.com\n```\n\n## Vercel Deployment Notes\n\n- Cron jobs will run automatically when deployed to Vercel\n- CRON_SECRET must be set in Vercel environment variables\n- Cron endpoint is protected with bearer token auth\n","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-06T14:59:43.073621-03:00","created_by":"caiodgallo","updated_at":"2026-01-06T17:53:05.255749-03:00","closed_at":"2026-01-06T17:53:05.255749-03:00","close_reason":"Closed"}
{"id":"northstar-4m5","title":"Test getEvents and getEventById","description":"7 test cases: ordering, filtering by userId, error handling, ownership checks","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-08T07:13:05.177806-03:00","created_by":"caiodgallo","updated_at":"2026-01-08T07:23:36.739447-03:00","closed_at":"2026-01-08T07:23:36.739447-03:00","close_reason":"Created comprehensive test suite with 10 tests covering: event ordering by startAt, userId filtering, ownership checks (can't access other users' events), error handling (graceful returns), and full data field validation. All tests passing.","dependencies":[{"issue_id":"northstar-4m5","depends_on_id":"northstar-s19","type":"blocks","created_at":"2026-01-08T07:13:22.401641-03:00","created_by":"caiodgallo"},{"issue_id":"northstar-4m5","depends_on_id":"northstar-5ad","type":"blocks","created_at":"2026-01-08T07:13:22.573886-03:00","created_by":"caiodgallo"},{"issue_id":"northstar-4m5","depends_on_id":"northstar-62p","type":"parent-child","created_at":"2026-01-08T07:13:40.916591-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-4nv","title":"Translate the Categories page","description":"The Categories page is still mainly hardcoded strings. They need to following the internalitzation pattern established accross the codebase and translated the suitable strings. Mainly UI components and layout at the present moment.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T12:32:43.104249-03:00","created_by":"caiodgallo","updated_at":"2026-01-02T14:51:32.644368-03:00","closed_at":"2026-01-02T14:51:32.644368-03:00","close_reason":"Closed"}
{"id":"northstar-4qh","title":"Remove unused getCurrentUserId call in notification-jobs cron","description":"File: lib/actions/notification-jobs.ts:136. getCurrentUserId() called but result not used. Makes no sense in cron context (no user session). Remove line.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-07T08:13:07.752973-03:00","created_by":"caiodgallo","updated_at":"2026-01-07T08:50:44.039242-03:00","closed_at":"2026-01-07T08:50:44.039242-03:00","close_reason":"No getCurrentUserId call found in notification-jobs.ts - already cleaned up","dependencies":[{"issue_id":"northstar-4qh","depends_on_id":"northstar-vau","type":"blocks","created_at":"2026-01-07T08:13:27.481989-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-50d","title":"Integrate QuickAddTask into task list page","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T07:25:20.721869-03:00","created_by":"caiodgallo","updated_at":"2026-01-09T07:32:55.542144-03:00","closed_at":"2026-01-09T07:32:55.542144-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-50d","depends_on_id":"northstar-7cc","type":"blocks","created_at":"2026-01-09T07:25:30.469418-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-50e","title":"Fix misleading 'Additional safety' comment in bill-reminder-schedule","description":"Comment at line 58 says 'Additional safety: skip ahead more aggressively' but this mischaracterizes the optimization.\n\nLocation: lib/bill-reminder-schedule.ts:58\n\nIssue: This switch block is the PRIMARY performance optimization, not 'additional safety'. Without it, loop would iterate day-by-day checking every single day until viewEnd. For yearly recurrence over 6 months, that's ~180 unnecessary iterations.\n\nFix: Change to 'Performance optimization: skip ahead by recurrence interval to avoid checking every day between occurrences'\n\nFound by: comment-analyzer agent\nConfidence: CRITICAL","status":"open","priority":3,"issue_type":"task","owner":"caiogallo88@gmail.com","created_at":"2026-01-14T15:45:43.996573-03:00","created_by":"Caio Gallo","updated_at":"2026-01-14T15:45:43.996573-03:00","dependencies":[{"issue_id":"northstar-50e","depends_on_id":"northstar-dal","type":"blocks","created_at":"2026-01-14T15:47:15.094812-03:00","created_by":"Caio Gallo"}]}
{"id":"northstar-5ad","title":"Update db-utils for events cleanup","description":"Add events, notificationJobs, notifications, recurrenceRules to clearAllTables() in test/db-utils.ts","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-08T07:13:04.289713-03:00","created_by":"caiodgallo","updated_at":"2026-01-08T07:17:26.202711-03:00","closed_at":"2026-01-08T07:17:26.202711-03:00","close_reason":"Completed: Added testEvents fixtures and createTestEvent() to test/fixtures.ts; Added events-related tables to clearAllTables() in test/db-utils.ts","dependencies":[{"issue_id":"northstar-5ad","depends_on_id":"northstar-62p","type":"parent-child","created_at":"2026-01-08T07:13:40.744794-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-5b3","title":"Phase 4: Translate theme-toggle components","description":"Phase 4: Translate theme-toggle components\n\nFiles: \n- components/theme-toggle.tsx (66 lines)\n- components/theme-toggle-row.tsx (73 lines)\n\nHardcoded strings to translate:\n- Theme labels: 'System', 'Light', 'Dark' (line 58 in both files)\n\nThese keys already exist in messages:\ntheme.system, theme.light, theme.dark\n\nSteps:\n1. Add useTranslations('theme') hook to both components\n2. Replace the ternary operator theme label (line 58) with: t(theme)\n3. Verify theme switching works correctly in both languages\n4. Test in sidebar toggle (ThemeToggle) and settings row (ThemeToggleRow)\n\nNote: The components are small and only have these 3 theme labels hardcoded.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T07:06:45.957295-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T09:58:48.29119-03:00","closed_at":"2026-01-05T09:58:48.29119-03:00","close_reason":"Closed"}
{"id":"northstar-5hf","title":"Quick Add Events/Tasks (Natural Language)","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-09T07:25:12.348491-03:00","created_by":"caiodgallo","updated_at":"2026-01-09T07:34:22.47875-03:00","closed_at":"2026-01-09T07:34:22.47875-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-5hf","depends_on_id":"northstar-ss7","type":"blocks","created_at":"2026-01-09T07:25:29.079914-03:00","created_by":"caiodgallo"},{"issue_id":"northstar-5hf","depends_on_id":"northstar-0a6","type":"blocks","created_at":"2026-01-09T07:25:29.254952-03:00","created_by":"caiodgallo"},{"issue_id":"northstar-5hf","depends_on_id":"northstar-tm6","type":"blocks","created_at":"2026-01-09T07:25:29.432954-03:00","created_by":"caiodgallo"},{"issue_id":"northstar-5hf","depends_on_id":"northstar-7cc","type":"blocks","created_at":"2026-01-09T07:25:29.602956-03:00","created_by":"caiodgallo"},{"issue_id":"northstar-5hf","depends_on_id":"northstar-50d","type":"blocks","created_at":"2026-01-09T07:25:29.775085-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-5mk","title":"Add error handling to all read operations","description":"Files: lib/actions/events.ts:14-17,19-27, lib/actions/tasks.ts:14-17,19-27, lib/actions/recurrence.ts:67-77, lib/actions/user-settings.ts:13-22. Database queries have no error handling. Should return empty arrays/null on failure rather than crashing.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-07T08:13:06.322046-03:00","created_by":"caiodgallo","updated_at":"2026-01-07T08:36:55.567588-03:00","closed_at":"2026-01-07T08:36:55.567588-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-5mk","depends_on_id":"northstar-vau","type":"blocks","created_at":"2026-01-07T08:13:27.216637-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-5sz","title":"Phase 2: iCal Parsing infrastructure","description":"Install ical.js dependency. Create lib/ical/fetch.ts with URL fetching (30s timeout, 10MB limit). Create lib/ical/parser.ts with VEVENT parsing, VTIMEZONE registration, RRULE handling, all-day event support.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T07:28:51.198634-03:00","created_by":"caiodgallo","updated_at":"2026-01-09T09:18:38.985135-03:00","closed_at":"2026-01-09T09:18:38.985135-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-5sz","depends_on_id":"northstar-p86","type":"parent-child","created_at":"2026-01-09T07:29:19.823901-03:00","created_by":"caiodgallo"},{"issue_id":"northstar-5sz","depends_on_id":"northstar-wgc","type":"blocks","created_at":"2026-01-09T07:29:28.180949-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-62n","title":"Add edit and delete capabilities from calendar view","description":"File: app/(app)/calendar/page.tsx. Currently only has create dialogs. Cannot edit or delete events/tasks from calendar UI.","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-07T08:11:33.129524-03:00","created_by":"caiodgallo","updated_at":"2026-01-07T09:33:19.325422-03:00","closed_at":"2026-01-07T09:33:19.325422-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-62n","depends_on_id":"northstar-vau","type":"blocks","created_at":"2026-01-07T08:11:57.454496-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-62p","title":"Events Feature Testing","description":"Comprehensive test suite for Events feature - server actions, notification integration, edge cases. ~25 test cases covering CRUD, authorization, cascade deletes, and notification scheduling.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-08T07:12:50.393736-03:00","created_by":"caiodgallo","updated_at":"2026-01-08T09:20:49.797129-03:00","closed_at":"2026-01-08T09:20:49.797129-03:00","close_reason":"Closed"}
{"id":"northstar-66h","title":"Fix events-create test for createEvent result","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T08:19:20.072377-03:00","created_by":"caiodgallo","updated_at":"2026-01-08T09:04:40.408578-03:00","closed_at":"2026-01-08T09:04:40.408578-03:00","close_reason":"Closed"}
{"id":"northstar-67a","title":"Add recurrence UI to event/task forms","description":"Forms don't have recurrence UI. Calendar doesn't expand recurrence rules. No way to create recurring events. Need to integrate recurrence logic with UI.","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-07T08:11:31.956943-03:00","created_by":"caiodgallo","updated_at":"2026-01-08T08:10:39.813274-03:00","closed_at":"2026-01-08T08:10:39.813274-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-67a","depends_on_id":"northstar-vau","type":"blocks","created_at":"2026-01-07T08:11:57.251138-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-6b4","title":"Add click animation to 'popout' and 'hollow' Button variants on mobile","description":"Use the same animation as the current hover on desktop, but for the click on the mobile. FAB has something like this.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-03T18:12:20.993885-03:00","created_by":"caiodgallo","updated_at":"2026-01-03T18:17:42.51772-03:00","closed_at":"2026-01-03T18:17:42.51772-03:00","close_reason":"Closed"}
{"id":"northstar-6g8","title":"Fix revalidateTag API misuse in events and tasks actions","description":"Files: lib/actions/events.ts:35,63,76,89,102 and lib/actions/tasks.ts:35,63,76,89,102,115. Currently calling revalidateTag('events', 'max') but API only accepts one argument. Should be revalidateTag('events').","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-07T08:04:17.187852-03:00","created_by":"caiodgallo","updated_at":"2026-01-07T08:20:10.261485-03:00","closed_at":"2026-01-07T08:20:10.261485-03:00","close_reason":"Fixed all revalidateTag calls - removed invalid second 'max' argument","dependencies":[{"issue_id":"northstar-6g8","depends_on_id":"northstar-vau","type":"blocks","created_at":"2026-01-07T08:11:52.221702-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-6gg","title":"Add cash flow report with transfers","description":"Extend dashboard/reporting to include transfer inflows/outflows alongside income and expenses.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T13:03:11.199162-03:00","created_by":"caiodgallo","updated_at":"2026-01-08T14:35:50.514412-03:00","closed_at":"2026-01-08T14:35:50.514412-03:00","close_reason":"Closed"}
{"id":"northstar-6kb","title":"Create custom calendar month agenda event item","description":"Let's create a custom month agenda event item for our schedule-x calendar layout. I want it to be very similar to the default schedule-x event item, but with the colors and layout patterns (like being square no rounded, with square shadow like the button hollow and popout variants). Let's think about a UI/UX that shows the info we need following our design pattern. Think about it and take your time, we have the CustomNorthstarEventItem as the placeholder element for the design.\n","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-07T15:17:10.647356-03:00","created_by":"caiodgallo","updated_at":"2026-01-08T07:21:20.030789-03:00","closed_at":"2026-01-08T07:21:20.030789-03:00","close_reason":"Enhanced MonthAgendaEventItem with: 4px shadow matching button variants, interactive hover/active translate effects, improved typography (semibold fonts), larger icons (3.5px priority, 3px status), better spacing (gap-2.5, px-3 py-2.5), border-2 for stronger presence, smooth transitions"}
{"id":"northstar-75f","title":"Add missing authorization to notification CRUD operations","description":"Files: lib/actions/notifications.ts:24 (updateNotification), :35 (deleteNotification), :44 (getNotificationsByItem). No user ownership validation. Any authenticated user can modify any notification. SECURITY VULNERABILITY.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-07T08:13:09.153429-03:00","created_by":"caiodgallo","updated_at":"2026-01-07T08:27:34.670967-03:00","closed_at":"2026-01-07T08:27:34.670967-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-75f","depends_on_id":"northstar-vau","type":"blocks","created_at":"2026-01-07T08:13:27.70751-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-78a","title":"Tasks Feature Review Findings","description":"Findings captured during Tasks feature review.\n- create/update allows status=completed without completedAt, which violates DB constraint (schema check) and likely fails on save.\n- deleteTask deletes notification/recurrence records before verifying task ownership (data isolation risk).\n- getRecurrenceRuleByItem does not enforce ownership; can leak rules for other users.\n- Task form allows startAt after dueAt (no UI validation), violating DB check.\n- Cancelled tasks are filtered out by default with no UI toggle, so they effectively disappear.\n- scheduleNotificationJobs inserts new jobs on every dueAt update without cleanup, risking duplicate/stale notifications.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T09:29:08.333032-03:00","created_by":"caiodgallo","updated_at":"2026-01-08T10:40:41.019604-03:00","closed_at":"2026-01-08T10:40:41.019604-03:00","close_reason":"Closed"}
{"id":"northstar-78p5","title":"Unified Calendar review findings","description":"Review notes for unified calendar rollout.\n\nFindings:\n- Deletion path uses detail sheet state to pick deleteTask vs deleteEvent, so context-menu/task edit deletes can hit deleteEvent when detailSheetData is null/stale (`app/(app)/calendar/page.tsx:309-314`). Store item type in deleteTarget or pass explicit type.\n- `EventDetailSheet` uses dynamic Tailwind class `bg-${typeColor}` so the indicator bar likely never renders in production builds (`components/calendar/event-detail-sheet.tsx:146-157`). Use explicit class strings.\n- Bill reminder detail sheet accepts `occurrenceDate/categoryName/categoryColor` but calendar page never passes them, so recurring occurrences show generic day and no category (`app/(app)/calendar/page.tsx:260-271`).\n- Hide Completed toggle only filters events/tasks; completed bill reminders still render (`app/(app)/calendar/page.tsx:434-448`).\n- `loadData` lacks error handling; server action failure leaves spinner stuck and no user feedback (`app/(app)/calendar/page.tsx:158-198`).","status":"open","priority":1,"issue_type":"task","owner":"caiogallo88@gmail.com","created_at":"2026-01-14T16:02:54.056522-03:00","created_by":"Caio Gallo","updated_at":"2026-01-14T16:03:07.859209-03:00"}
{"id":"northstar-797","title":"Tests: Dashboard - Test getDashboardData server action","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T10:27:31.862122-03:00","created_by":"caiodgallo","updated_at":"2026-01-14T11:27:20.874365-03:00","closed_at":"2026-01-05T12:40:52.932948-03:00","dependencies":[{"issue_id":"northstar-797","depends_on_id":"northstar-th0","type":"blocks","created_at":"2026-01-05T10:46:48.902638-03:00","created_by":"caiodgallo"}],"comments":[{"id":2,"issue_id":"northstar-797","author":"caiodgallo","text":"# User Journey: Dashboard Data\n\n## Server Action: `getDashboardData(yearMonth)` (/lib/actions/dashboard.ts)\n\n### Happy Path Tests\n\n1. **Empty State**\n   - Month with no expenses, income, or budgets\n   - Verify returns zeros for all totals\n   - Verify empty categoryBreakdown array\n   - Verify empty recentExpenses/recentIncome arrays\n\n2. **Expenses Only**\n   - Month with multiple expenses across different categories\n   - Verify totalSpent is correct sum\n   - Verify categoryBreakdown has correct spent amounts per category\n   - Verify recentExpenses ordered by createdAt DESC (most recent first)\n   - Verify totalBudget is 0, totalIncome is 0\n\n3. **Income Only**\n   - Month with multiple income entries\n   - Verify totalIncome is correct sum\n   - Verify recentIncome ordered by createdAt DESC\n   - Verify totalSpent is 0, netBalance equals totalIncome\n\n4. **Budgets Without Spending**\n   - Month with budgets but no expenses\n   - Verify totalBudget is correct sum\n   - Verify categoryBreakdown shows budget amounts with spent=0\n   - Verify totalSpent is 0\n\n5. **Partial Budgets**\n   - Some categories have budgets, some don't\n   - Verify categoryBreakdown includes all spending categories (even without budgets)\n   - Verify categories with budgets show correct budget amounts\n   - Verify categories without budgets have budget=null or 0\n\n6. **Complete Scenario**\n   - Month with expenses, income, and budgets\n   - Verify all totals are correct (totalSpent, totalBudget, totalIncome, netBalance)\n   - Verify netBalance = totalIncome - totalSpent\n   - Verify categoryBreakdown aggregation is correct\n   - Verify recent lists are correctly ordered\n\n### Edge Case Tests\n\n1. **Month Boundary Handling**\n   - Expenses on first day of month (2025-01-01)\n   - Expenses on last day of month (2025-01-31)\n   - Income crossing month boundaries\n   - Verify date filtering uses correct ranges (inclusive)\n\n2. **Installment Expenses**\n   - Multiple installments of same transaction across months\n   - Verify only entries for current month are counted\n   - Verify installment amounts are correct\n\n3. **Spending Calculation Logic**\n   - Verify expenses filtered by purchaseDate (budget impact), NOT dueDate\n   - Verify credit card entries with different faturaMonth are handled correctly\n   - Test with entries where faturaMonth != purchaseDate month\n\n4. **Rounding and Money Handling**\n   - Test with amounts that don't divide evenly\n   - Verify all calculations in cents, converted correctly\n   - Test with very large amounts\n\n5. **Multiple Accounts**\n   - Expenses across multiple accounts (credit card, checking, cash)\n   - Verify aggregation includes all accounts\n   - Verify account names in recent lists are correct\n\n6. **Categories Without Spending**\n   - Categories with budgets but no spending\n   - Verify they appear in categoryBreakdown with spent=0\n\n7. **Recent Lists Limit**\n   - Create \u003e5 expenses in month\n   - Verify only most recent 5 returned\n   - Verify ordering is correct\n\n### Integration Tests\n\n1. **Dashboard Revalidation**\n   - Create expense → dashboard revalidated\n   - Update expense → dashboard revalidated\n   - Delete expense → dashboard revalidated\n   - Verify cache is invalidated properly\n\n2. **Multi-Month Data**\n   - Create expenses in Jan and Feb\n   - Query Jan → only Jan data returned\n   - Query Feb → only Feb data returned\n   - Verify months don't leak into each other\n\n3. **User Isolation**\n   - Create data for two users\n   - Query each user's dashboard\n   - Verify no data leakage between users\n\n### Test File Location\n`/test/lib/actions/dashboard.test.ts`\n\n### Implementation Notes\n- Use existing fixtures and helper functions\n- Mock auth with test user ID\n- Use in-memory PGlite database\n- Follow pattern from expenses.test.ts and income.test.ts\n","created_at":"2026-01-05T13:39:56Z"}]}
{"id":"northstar-7ax","title":"Lint: fix edit-transaction-dialog lint errors","description":"ESLint fails in components/edit-transaction-dialog.tsx: unused Income import and react-hooks/set-state-in-effect error (setTransaction in effect).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T11:09:56.321979-03:00","created_by":"caiodgallo","updated_at":"2026-01-14T11:27:20.874808-03:00","closed_at":"2026-01-05T12:52:45.434342-03:00"}
{"id":"northstar-7cc","title":"Create QuickAddTask component","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T07:25:20.498832-03:00","created_by":"caiodgallo","updated_at":"2026-01-09T07:32:55.540726-03:00","closed_at":"2026-01-09T07:32:55.540726-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-7cc","depends_on_id":"northstar-0a6","type":"blocks","created_at":"2026-01-09T07:25:30.295897-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-7ta","title":"Test database error translation and handling","description":"Current coverage: 36% statements, 27% branches. Centralizes error handling for ALL database operations - affects every server action. Untested: error type detection and i18n translation (34-52). Missing tests: foreign key violations, unique constraints, not null violations, unknown error codes, null inputs. Real risk: users see 'Something went wrong' instead of 'This account name already exists'. Poor DX for developers - no context for debugging. Production errors lose critical diagnostic information.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T16:27:47.393831-03:00","created_by":"caiodgallo","updated_at":"2026-01-12T22:04:45.868282-03:00","closed_at":"2026-01-12T22:04:45.868282-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-7ta","depends_on_id":"northstar-b91","type":"blocks","created_at":"2026-01-12T16:31:21.600157-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-7tg","title":"Tasks Feature - Test Plan","description":"User-focused test plan for Tasks.\nCovers CRUD, filters, recurrence, notifications, timezone, and permissions.\nChild issues define specific test suites (unit/integration/e2e). ","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-08T09:27:08.646933-03:00","created_by":"caiodgallo","updated_at":"2026-01-08T10:44:02.944585-03:00","closed_at":"2026-01-08T10:44:02.944585-03:00","close_reason":"Closed"}
{"id":"northstar-7tg.1","title":"Test: Task CRUD \u0026 calendar rendering","description":"Covers create/edit/delete via UI and server actions.\n- Create task with due date/time only (no startAt) and verify calendar card + detail sheet.\n- Create task with start time + duration and verify time range.\n- Edit title/description/location/dueAt and verify UI refresh + calendar update.\n- Delete task and verify removal from calendar + detail sheet closes.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T09:27:24.253823-03:00","created_by":"caiodgallo","updated_at":"2026-01-08T10:00:32.758969-03:00","closed_at":"2026-01-08T10:00:32.758969-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-7tg.1","depends_on_id":"northstar-7tg","type":"parent-child","created_at":"2026-01-08T09:27:24.254599-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-7tg.2","title":"Test: Task status workflow \u0026 completedAt invariant","description":"Covers status transitions and DB constraint behavior.\n- Create/update task with status completed should set completedAt (or fail with clear error).\n- Verify status changes via edit form and server actions (start/complete/cancel).\n- Ensure cancelled tasks are handled consistently in UI (visibility or filter).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T09:27:39.823718-03:00","created_by":"caiodgallo","updated_at":"2026-01-08T10:00:58.819259-03:00","closed_at":"2026-01-08T10:00:58.819259-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-7tg.2","depends_on_id":"northstar-7tg","type":"parent-child","created_at":"2026-01-08T09:27:39.824513-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-7tg.3","title":"Test: Filters \u0026 visibility","description":"Validate status/priority filter behavior.\n- Toggling filters updates calendar events and preserves selection state.\n- Verify cancelled tasks handling (if hidden, confirm expected behavior).\n- Verify context menu edit/delete works from agenda items.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T09:27:55.429086-03:00","created_by":"caiodgallo","updated_at":"2026-01-08T10:01:21.473568-03:00","closed_at":"2026-01-08T10:01:21.473568-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-7tg.3","depends_on_id":"northstar-7tg","type":"parent-child","created_at":"2026-01-08T09:27:55.429949-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-7tg.4","title":"Test: Recurrence rules \u0026 occurrences","description":"Verify recurring tasks with RRULEs.\n- Daily/weekly/monthly/yearly with COUNT and UNTIL.\n- Update recurrence and remove recurrence (repeat=never).\n- Invalid RRULE fallback renders base task only.\n- Occurrence detail sheet uses correct start/end.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T09:28:10.89995-03:00","created_by":"caiodgallo","updated_at":"2026-01-08T10:25:12.548095-03:00","closed_at":"2026-01-08T10:25:12.548095-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-7tg.4","depends_on_id":"northstar-7tg","type":"parent-child","created_at":"2026-01-08T09:28:10.900758-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-7tg.5","title":"Test: Timezone \u0026 DST handling","description":"Ensure dueAt/startAt render correctly across timezones.\n- User settings timezone vs browser timezone selection.\n- DST boundary cases for recurring tasks.\n- Calendar event times match stored timestamps.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T09:28:26.456492-03:00","created_by":"caiodgallo","updated_at":"2026-01-08T10:25:27.726697-03:00","closed_at":"2026-01-08T10:25:27.726697-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-7tg.5","depends_on_id":"northstar-7tg","type":"parent-child","created_at":"2026-01-08T09:28:26.457324-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-7tg.6","title":"Test: Notifications scheduling for tasks","description":"Verify notification job scheduling for tasks.\n- Create task with notification configs produces jobs at offset.\n- Update dueAt reschedules without duplicate/stale jobs.\n- Deleting task removes notification jobs.\n- Notifications disabled in settings skips scheduling.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T09:28:42.107036-03:00","created_by":"caiodgallo","updated_at":"2026-01-08T10:25:37.879349-03:00","closed_at":"2026-01-08T10:25:37.879349-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-7tg.6","depends_on_id":"northstar-7tg","type":"parent-child","created_at":"2026-01-08T09:28:42.107853-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-7tg.7","title":"Test: Permissions \u0026 data isolation","description":"Security checks for server actions.\n- Ensure user cannot read/update/delete tasks they do not own.\n- Recurrence rule fetch/update/delete honors ownership.\n- Deleting a task does not delete other users' notification/recurrence records.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T09:28:57.775263-03:00","created_by":"caiodgallo","updated_at":"2026-01-08T10:25:48.088317-03:00","closed_at":"2026-01-08T10:25:48.088317-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-7tg.7","depends_on_id":"northstar-7tg","type":"parent-child","created_at":"2026-01-08T09:28:57.776073-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-7v5","title":"Fix test failures from new error messages","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T09:12:47.851555-03:00","created_by":"caiodgallo","updated_at":"2026-01-07T09:17:08.742999-03:00","closed_at":"2026-01-07T09:17:08.742999-03:00","close_reason":"Closed"}
{"id":"northstar-7xn","title":"Audit money handling for cents-only usage (faturas total discrepancy)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-14T05:53:24.279589-03:00","created_by":"caiodgallo","updated_at":"2026-01-14T06:02:20.94775-03:00","closed_at":"2026-01-14T06:02:20.94775-03:00","close_reason":"Closed"}
{"id":"northstar-84p","title":"Add try-catch around calculateNextDueDate in schedule builder","description":"calculateNextDueDate can throw on invalid recurrence types but is called without error handling.\n\nLocation: lib/bill-reminder-schedule.ts:42-45\nThrows: Error('Unsupported recurrence type: ...') from calculateNextDueDate utility\n\nImpact: Uncaught exception crashes calendar rendering if bill reminder has invalid data\n\nFix: Wrap in try-catch, log error with reminder ID, skip that reminder and continue processing others\n\nFound by: silent-failure-hunter agent\nConfidence: CRITICAL","status":"closed","priority":0,"issue_type":"bug","owner":"caiogallo88@gmail.com","created_at":"2026-01-14T15:39:15.576046-03:00","created_by":"Caio Gallo","updated_at":"2026-01-14T16:11:54.180668-03:00","closed_at":"2026-01-14T16:11:54.180668-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-84p","depends_on_id":"northstar-dal","type":"blocks","created_at":"2026-01-14T15:39:50.268757-03:00","created_by":"Caio Gallo"}]}
{"id":"northstar-8az","title":"Test notification scheduling and ownership verification","description":"Current coverage: 39% statements, 50% branches. Users rely on timely alerts for events/tasks. Untested: CRUD operations (60-100), ownership verification (security-critical), error handling in scheduleNotificationJobs (158). Missing tests: schedule with notifications disabled, multiple notifications per event, ownership bypass attempts, missing parent items. Real risk: silent notification failures mean missed appointments. Ownership bugs = security vulnerability (user A sees user B's events). Error swallowing masks systemic issues.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T16:27:47.165298-03:00","created_by":"caiodgallo","updated_at":"2026-01-14T08:21:54.504079-03:00","closed_at":"2026-01-14T08:21:54.504079-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-8az","depends_on_id":"northstar-b91","type":"blocks","created_at":"2026-01-12T16:31:21.425134-03:00","created_by":"caiodgallo"},{"issue_id":"northstar-8az","depends_on_id":"northstar-7ta","type":"blocks","created_at":"2026-01-12T16:31:27.523304-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-8lj","title":"Fix calendar timezone offset for events/tasks","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T10:14:43.951225-03:00","created_by":"caiodgallo","updated_at":"2026-01-07T10:30:15.655252-03:00","closed_at":"2026-01-07T10:30:15.655252-03:00","close_reason":"Closed"}
{"id":"northstar-8m3","title":"Add logging for empty bill reminder schedule generation","description":"generateOccurrences returning empty array provides no diagnostic info.\n\nLocation: lib/bill-reminder-schedule.ts:129-134\n\nCurrent: Silent fallback to empty array\nIssue: Can't distinguish 'legitimately no occurrences' from 'error occurred'\n\nFix: Add logging when generateOccurrences returns empty unexpectedly (e.g., viewStart \u003c now but no results)\n\nFound by: silent-failure-hunter agent\nConfidence: HIGH","status":"open","priority":2,"issue_type":"task","owner":"caiogallo88@gmail.com","created_at":"2026-01-14T15:39:20.030465-03:00","created_by":"Caio Gallo","updated_at":"2026-01-14T15:39:20.030465-03:00","dependencies":[{"issue_id":"northstar-8m3","depends_on_id":"northstar-dal","type":"blocks","created_at":"2026-01-14T15:39:51.146536-03:00","created_by":"Caio Gallo"}]}
{"id":"northstar-8qt","title":"Tests: Faturas - Test billing cycle calculations and edge cases","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T10:27:33.359526-03:00","created_by":"caiodgallo","updated_at":"2026-01-14T11:27:20.875258-03:00","closed_at":"2026-01-05T12:46:15.5851-03:00","comments":[{"id":3,"issue_id":"northstar-8qt","author":"caiodgallo","text":"# User Journey: Faturas Billing Cycle Calculations\n\n## Utilities: `/lib/fatura-utils.ts`\n\nThese tests focus on the core billing cycle logic that determines which fatura an expense belongs to and when it's due. This is critical for Brazilian credit card billing.\n\n### Core Logic Tests\n\n#### 1. `getFaturaMonth(purchaseDate, closingDay)`\n- **Closing day logic:**\n  - Purchase on closing day → belongs to current month's fatura\n  - Purchase before closing day → belongs to current month's fatura\n  - Purchase after closing day → belongs to next month's fatura\n\n- **Edge Cases:**\n  - closingDay = 1 → all purchases go to next month (except day 1)\n  - closingDay = 28 → all purchases go to current month (except after 28)\n  - closingDay = 15 → mid-month split\n  - Purchase on day 1 with closingDay=1 → current month\n  - Purchase on day 1 with closingDay=15 → current month\n  - Purchase on day 15 with closingDay=15 → current month\n  - Purchase on day 16 with closingDay=15 → next month\n  - Purchase on day 31 with closingDay=28 → next month\n\n- **Month Boundary:**\n  - Jan 31, closingDay=15 → Feb fatura (\"2025-02\")\n  - Jan 15, closingDay=15 → Jan fatura (\"2025-01\")\n  - Jan 14, closingDay=15 → Jan fatura (\"2025-01\")\n  - Dec 31, closingDay=15 → Jan next year fatura (\"2026-01\")\n\n- **Timezone Handling:**\n  - Use UTC methods to avoid timezone issues\n  - Test with different dates to ensure consistency\n\n#### 2. `getFaturaPaymentDueDate(faturaMonth, paymentDueDay, closingDay)`\n- **Payment due date logic:**\n  - If paymentDueDay \u003c= closingDay → due NEXT month\n  - If paymentDueDay \u003e closingDay → due SAME month\n\n- **Edge Cases:**\n  - paymentDueDay = 5, closingDay = 15 → due next month\n  - paymentDueDay = 12, closingDay = 5 → due same month\n  - paymentDueDay = closingDay → due next month (equal case)\n\n- **Month Boundary:**\n  - Fatura \"2025-01\", closingDay=15, paymentDueDay=5 → due \"2025-02-05\"\n  - Fatura \"2025-01\", closingDay=5, paymentDueDay=12 → due \"2025-01-12\"\n  - Fatura \"2025-12\", closingDay=15, paymentDueDay=5 → due \"2026-01-05\"\n\n- **Day Validation:**\n  - paymentDueDay in range 1-28 (valid)\n  - paymentDueDay = 29, 30, 31 → handle month with fewer days (should work or fail?)\n  - Test with different month lengths (Feb=28, Apr=30, etc.)\n\n### Integration Tests with Expenses\n\n#### 3. Purchase Date to Fatura Month Mapping\n- Create expense on Jan 10, closingDay=15 → fatura \"2025-01\"\n- Create expense on Jan 20, closingDay=15 → fatura \"2025-02\"\n- Verify entry.faturaMonth is set correctly\n- Verify fatura record exists for that month\n\n#### 4. Due Date Calculation on Expense Creation\n- Create expense → verify entry.dueDate is correct\n- Check against account's billing config\n- Verify matches getFaturaPaymentDueDate calculation\n\n#### 5. Installment Expenses and Fatura Months\n- 3-installment expense on Jan 10, closingDay=15:\n  - Installment 1 (Jan) → fatura \"2025-01\"\n  - Installment 2 (Feb) → fatura \"2025-02\"\n  - Installment 3 (Mar) → fatura \"2025-03\"\n- Verify each entry has correct faturaMonth\n- Verify each entry has correct dueDate based on its faturaMonth\n\n#### 6. Multi-Month Installment Spanning Closing Day\n- Expense on Jan 20 (after closing day), 3 installments, closingDay=15:\n  - Purchase date: Jan 20 → fatura \"2025-02\"\n  - Installment 1 (Feb) → fatura \"2025-02\"\n  - Installment 2 (Mar) → fatura \"2025-03\"\n  - Installment 3 (Apr) → fatura \"2025-04\"\n- Verify each month's faturaMonth is correct\n\n### Edge Case Scenarios\n\n#### 7. First and Last Day of Month\n- Purchase on Jan 1, closingDay=1 → fatura \"2025-01\" (on closing day = current)\n- Purchase on Jan 1, closingDay=15 → fatura \"2025-01\"\n- Purchase on Jan 31, closingDay=28 → fatura \"2025-02\" (after closing day)\n- Purchase on Jan 31, closingDay=31 (if allowed) → fatura \"2025-01\"\n\n#### 8. Year Boundaries\n- Dec 31, closingDay=15 → Jan next year fatura\n- Jan 1, closingDay=28 → Jan fatura\n- Verify year rollover handled correctly\n\n#### 9. Leap Years\n- Feb 28, closingDay=15 → Feb fatura\n- Feb 29, closingDay=15 → Mar fatura (in leap year)\n- Verify leap year handling\n\n#### 10. No Billing Config (Fallback)\n- Account without closingDay/paymentDueDay\n- Use default closingDay=15? (check implementation)\n- Use default paymentDueDay=7? (check implementation)\n- Or use different fallback logic?\n- Test fallback behavior\n\n### Real-World Scenarios\n\n#### 11. Common Brazilian Billing Cycles\n- Nubank: closingDay=5, paymentDueDay=15 (same month due)\n- Itaú: closingDay=15, paymentDueDay=5 (next month due)\n- Test with common configs\n\n#### 12. Expense Updates Affecting Faturas\n- Create expense Jan 10 (fatura Jan)\n- Update to Jan 20 (after closing day) → fatura changes to Feb\n- Old fatura (Jan) total decreased, new fatura (Feb) total increased\n- Verify both faturas updated correctly\n\n#### 13. Expense Deletion Affecting Faturas\n- Create expense → fatura total increased\n- Delete expense → fatura total decreased\n- If last entry → fatura total = 0\n\n### Formatting Tests\n\n#### 14. `formatFaturaMonthWithLocale(yearMonth, locale)`\n- Format \"2025-01\" in pt-BR → \"janeiro de 2025\"\n- Format \"2025-01\" in en → \"January 2025\"\n- Test all 12 months in both locales\n- Verify locale-specific formatting\n\n### Data Consistency Tests\n\n#### 15. Fatura Month vs Purchase Date\n- Verify faturaMonth can be different from purchaseDate month\n- This is expected behavior due to billing cycles\n- Budget tracking uses purchaseDate month\n- Fatura grouping uses faturaMonth\n- Both serve different purposes\n\n#### 16. Fatura Uniqueness\n- Try to create duplicate fatura for same account+month\n- Verify unique constraint prevents duplicates\n- ensureFaturaExists should not create duplicates\n\n#### 17. Entry-Fatura Consistency\n- Verify all entries for account+month have correct faturaMonth\n- Query entries → verify faturaMonth matches billing logic\n- Test with multiple entries in same fatura\n\n### Regression Tests (Based on Migration Issues)\n\n#### 18. Historical Bug Fixes\nThese were real bugs that required migrations. Ensure they don't regress:\n\n- **Bug:** Fatura month was using purchase month instead of closing day logic\n  - Test: Purchase Jan 20, closingDay=15 → fatura \"2025-02\" (not \"2025-01\")\n\n- **Bug:** Due dates were one month off\n  - Test: Fatura \"2025-01\", closingDay=15, paymentDueDay=5 → due \"2025-02-05\" (not \"2025-01-05\")\n\n- **Bug:** Missing fatura records for some month/account combinations\n  - Test: Create expense → ensure fatura exists\n  - Test: backfillFaturas creates missing records\n\n### Performance Tests\n\n#### 19. Bulk Expense Creation\n- Create 100 expenses in same month\n- Verify fatura total calculated correctly\n- Verify performance is acceptable\n\n#### 20. Multiple Faturas Same Month\n- Create 5 credit cards with expenses\n- Verify each has correct fatura\n- Verify totals are correct\n\n### Test File Location\n`/test/lib/fatura-utils.test.ts`\n\n### Implementation Notes\n- Focus on pure function testing (no database needed for utility functions)\n- Test all edge cases of closing day and payment due day logic\n- Test timezone handling explicitly\n- Test leap years and month boundaries\n- Test real-world Brazilian billing cycle scenarios\n- Test integration with expense creation (requires database)\n- Use existing fixtures (creditCardWithBilling)\n- Regression tests based on historical bugs from migrations\n","created_at":"2026-01-05T13:43:32Z"}]}
{"id":"northstar-8qv","title":"Phase 3: Create server error translation helper (/lib/i18n/server-errors.ts)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:27.615698-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T10:09:04.055109-03:00","closed_at":"2026-01-05T10:09:04.055109-03:00","close_reason":"Closed"}
{"id":"northstar-8wh","title":"Create language switcher close to the theme switcher","description":"We must create a language switcher component close to the existing theme switcher one. It must follow the theme switcher style and idea.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T12:34:10.526382-03:00","created_by":"caiodgallo","updated_at":"2026-01-02T12:52:40.444278-03:00","closed_at":"2026-01-02T12:52:40.444278-03:00","close_reason":"Closed"}
{"id":"northstar-9av","title":"Replace console.error with logError in calendar components","description":"Multiple catch blocks use console.error instead of project's logError for Sentry tracking.\n\nViolates CLAUDE.md conventions for error reporting.\n\nLocations to update:\n- Calendar page error handlers\n- Bill reminder schedule builder\n- Action error handlers\n\nFix: Import logError from @/lib/logger and replace console.error calls\n\nFound by: silent-failure-hunter agent\nConfidence: MEDIUM","status":"open","priority":2,"issue_type":"task","owner":"caiogallo88@gmail.com","created_at":"2026-01-14T15:39:21.10375-03:00","created_by":"Caio Gallo","updated_at":"2026-01-14T15:39:21.10375-03:00","dependencies":[{"issue_id":"northstar-9av","depends_on_id":"northstar-dal","type":"blocks","created_at":"2026-01-14T15:39:51.363998-03:00","created_by":"Caio Gallo"}]}
{"id":"northstar-9i6","title":"Phase 5: Coverage audit for remaining hardcoded strings","description":"Phase 5: Coverage audit for remaining hardcoded strings\n\nComprehensive audit to find any remaining hardcoded English strings that aren't translated.\n\nAreas to check:\n1. Components directory - all .tsx files\n2. App directory - all pages\n3. UI components (components/ui/)\n4. Any error messages or validation text\n\nHow to audit:\n1. Use grep to find English text patterns:\n   - Single quotes: grep -rn \"'\" | grep -v \"import\"\n   - Or search for common words: 'Error', 'Failed', 'Required', 'Invalid'\n2. For each match, determine if it's:\n   - User-facing text (needs translation)\n   - Code strings (can stay hardcoded)\n3. Create tasks for any missing translations found\n\nExamples of what to look for:\n- Button text: 'Save', 'Cancel', 'Delete'\n- Labels: 'Name', 'Description', 'Amount'\n- Errors: 'Something went wrong', 'Invalid input'\n- Placeholders: 'Enter value here'\n\nTools to use:\n- rg (ripgrep) for fast search\n- Manual code review\n\nExpected outcome:\n- List of all remaining hardcoded user-facing strings\n- Either all translated or documented with reasons why they can't be","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T07:06:46.951849-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T10:04:02.386946-03:00","closed_at":"2026-01-05T10:04:02.386946-03:00","close_reason":"Closed"}
{"id":"northstar-9v6","title":"Fix timezone handling inconsistency in event/task forms","description":"File: components/event-form.tsx:50-56. Date parsing uses 'new Date(`${startDate}T00:00:00`)' which parses in local timezone. Need explicit timezone handling for consistency.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-07T08:11:07.686564-03:00","created_by":"caiodgallo","updated_at":"2026-01-07T08:35:30.122665-03:00","closed_at":"2026-01-07T08:35:30.122665-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-9v6","depends_on_id":"northstar-vau","type":"blocks","created_at":"2026-01-07T08:11:54.259234-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-9wl","title":"Migrate auth to Auth.js (NextAuth)","description":"# Context\nWe want to replace Supabase Auth with Auth.js (NextAuth) while keeping the rest of the stack (Next.js App Router + Drizzle + Postgres). The goal is to avoid vendor lock-in and keep auth fully app-managed.\n\n# Findings (current auth surface)\n- Supabase Auth is wired through server/client helpers in `lib/supabase/server.ts`, `lib/supabase/client.ts`, and middleware-like logic in `lib/supabase/proxy.ts` plus `proxy.ts`.\n- Core auth entry points:\n  - `lib/auth.ts` exposes `getCurrentUserId()` (Supabase `auth.getUser()`).\n  - `lib/actions/auth.ts` implements login/logout/forgot/reset using Supabase.\n  - Pages: `app/(auth)/login/page.tsx`, `app/(auth)/forgot-password/page.tsx`, `app/(auth)/reset-password/page.tsx`.\n  - Callback route: `app/(auth)/auth/callback/route.ts` uses `exchangeCodeForSession()`.\n- Most server actions rely on `getCurrentUserId()` (many files under `lib/actions/*`).\n- Domain tables store `userId` as `text` and currently rely on Supabase user IDs (`lib/schema.ts`).\n- SQL/seed artifacts reference `auth.users` (e.g. `drizzle/0004_odd_prima.sql`, `supabase-migrations-combined.sql`, `drizzle/seed.ts`).\n- Tests mock auth via `test/auth-utils.ts` and many specs stub `@/lib/auth`.\n\n# Goals\n- Replace Supabase Auth with Auth.js (NextAuth) using Drizzle adapter.\n- Keep email/password flow + password reset (or explicitly decide on magic-link if acceptable).\n- Preserve `userId` references in domain tables without large rewrites.\n- Maintain testability (mockable `getCurrentUserId` equivalent).\n- Remove Supabase Auth dependencies while keeping Supabase Postgres optional.\n\n# Plan / Directions\n## 1) Decide auth model (keep password flow unless intentionally changing UX)\n- **Option A (recommended for parity):** Credentials provider with hashed passwords.\n  - Add `passwordHash` to `users` table (Drizzle) and implement verification with `bcrypt` or `argon2`.\n  - Implement password reset flow (custom token table + email send) since Auth.js does not include password reset out of the box.\n- **Option B (simpler but UX change):** Email magic link provider (no passwords); remove reset-password UI and replace with “sign in link” flow.\n\n## 2) Add Auth.js core + Drizzle adapter\n- Install deps: `next-auth` + `@auth/drizzle-adapter` (and `bcrypt`/`argon2` if using credentials).\n- Create Auth.js config module (e.g. `lib/auth/config.ts` or `auth.ts`) with:\n  - Providers (Credentials + Email optional).\n  - Adapter pointing to Drizzle `db` (`lib/db.ts`).\n  - Session strategy (database sessions recommended).\n  - Callbacks to inject `user.id` into session.\n- Add `app/api/auth/[...nextauth]/route.ts` to expose handlers (App Router).\n\n## 3) Add Auth.js tables + migrations\n- Extend `lib/schema.ts` with Auth.js tables: `users`, `accounts`, `sessions`, `verificationTokens`.\n- If using credentials: add `passwordHash` and optionally `passwordResetTokens`.\n- Generate migrations with Drizzle (`npx drizzle-kit generate`).\n- **Data migration strategy:** use existing `userId` values in domain tables to create matching `users.id` rows to avoid rewriting all foreign keys.\n  - If only one user exists, create a migration that inserts a user with `id` equal to that existing `userId` and sets email/name.\n\n## 4) Replace auth entry points\n- `lib/auth.ts`: replace Supabase calls with Auth.js `auth()`/`getServerSession()` and return `user.id`.\n- `lib/actions/auth.ts`:\n  - `login`: use `signIn('credentials', { redirect: false, ... })`.\n  - `logout`: use `signOut()` or server action + redirect.\n  - `forgotPassword`/`updatePassword`: implement custom token-based reset if staying with passwords.\n- Remove Supabase-only helpers (`lib/supabase/*`) or keep only DB usage if still needed.\n\n## 5) Replace middleware/session refresh\n- Replace `lib/supabase/proxy.ts` + `proxy.ts` with Auth.js `middleware.ts` (using `auth` from `next-auth/middleware` or `withAuth` equivalent).\n- Ensure public routes allowlist: `/login`, `/forgot-password`, `/reset-password`, `/auth/*`, `/api/cron`.\n\n## 6) Update pages and routes\n- `app/(auth)/login/page.tsx`: wire to new `login` action; remove Supabase error handling.\n- `app/(auth)/forgot-password/page.tsx` + `app/(auth)/reset-password/page.tsx`: align with custom reset flow or remove if switching to magic link.\n- `app/(auth)/auth/callback/route.ts`: remove Supabase exchange; not needed unless using OAuth providers with custom callback.\n\n## 7) Update tests \u0026 mocks\n- Update `test/auth-utils.ts` and all specs mocking `@/lib/auth` to match new API surface.\n- Add unit tests for new auth actions (credentials + reset flow).\n\n## 8) Cleanup \u0026 config\n- Remove Supabase auth env vars: `NEXT_PUBLIC_SUPABASE_URL`, `NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY` from auth usage (DB can still use `DATABASE_URL`).\n- Add Auth.js env vars (e.g., `AUTH_SECRET`, `AUTH_URL` or `NEXTAUTH_SECRET`, `NEXTAUTH_URL` depending on version).\n- Update CSP `connect-src` in `next.config.ts` to drop `*.supabase.co` unless still needed.\n- Update docs and seed/migration SQL to stop referencing `auth.users`.\n\n# Acceptance Criteria\n- Auth.js fully replaces Supabase Auth (no `@supabase/auth-js` usage for auth flows).\n- Protected routes enforce session via Auth.js middleware.\n- `getCurrentUserId()` (or equivalent) returns Auth.js user ID in server actions.\n- Login + password reset flows work end-to-end (or a deliberate switch to magic-link is documented and UI updated).\n- Tests updated and passing with new mocks.\n\n# Risks / Notes\n- Auth.js does not provide password reset flows; must build custom reset tokens + email send if keeping passwords.\n- If existing user IDs need to remain stable, ensure `users.id` values are aligned with current `userId` stored in domain tables.\n\n# Suggested labels\nauth, migration, security\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-13T07:13:36.855057-03:00","created_by":"caiodgallo","updated_at":"2026-01-13T08:12:00.020063-03:00","closed_at":"2026-01-13T08:12:00.020063-03:00","close_reason":"Auth.js migration complete. Using NextAuth v4 with JWT sessions, bcrypt password hashing, custom password reset flow, in-memory rate limiting. All tests passing, build successful."}
{"id":"northstar-9yc","title":"Phase 4: Translate account-form component","description":"Phase 4: Translate account-form component\n\nFile: components/account-form.tsx\n\nThis component has hardcoded strings that need translation:\n- Form labels (Name, Type, Closing Day, Payment Due Day, Select Day)\n- Buttons (Save, Cancel, Create, Update, Saving...)\n- Error messages\n\nSteps:\n1. Add useTranslations('accountForm') hook\n2. Replace all hardcoded strings with t() calls\n3. Add missing translation keys to messages/en.json and messages/pt-BR.json\n4. Verify form works correctly for creating/editing accounts\n\nExample translation key structure (already exists in messages):\naccountForm.name, accountForm.type, accountForm.closingDay, etc.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T07:06:45.018733-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T09:58:48.616779-03:00","closed_at":"2026-01-05T09:58:48.616779-03:00","close_reason":"Closed"}
{"id":"northstar-9zx","title":"Enhance login namespace with missing keys","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:04.388212-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T09:38:19.711509-03:00","closed_at":"2026-01-05T09:38:19.711509-03:00","close_reason":"Closed"}
{"id":"northstar-a2y","title":"Improve Nubank Extrato import","description":"When importing a CSV from Nubank Extrato, there are some informational pieces of text that repeat on every type of transaction, and those occupy a very large valuable space on screen, for example check the CSV data sample following:\n\n```csv\nData,Valor,Identificador,Descrição\n04/12/2025,13275.00,693193dd-e615-44a0-a910-21596234daed,Transferência Recebida - C D GALLO - 37.789.485/0001-54 - NU PAGAMENTOS - IP (0260) Agência: 1 Conta: 41450310-9\n04/12/2025,-7691.23,693199d0-3da3-4147-8124-4889aa41ba76,Pagamento de fatura\n04/12/2025,-114.90,693199fe-48b7-4aa7-964d-626e92fda4c0,Pagamento de boleto efetuado - GRUPO CEDNET\n04/12/2025,-587.77,69319a5f-2307-447b-a823-9ed296fa693c,Transferência enviada pelo Pix - MERCADO PAGO INSTITUICAO DE PAGAMENTO LTDA - 10.573.521/0001-91 - MERCADO PAGO IP LTDA. (0323) Agência: 1 Conta: 1488917887-3\n04/12/2025,-2210.00,69319caf-fb25-4fb6-9edb-6619af5691b8,Transferência enviada pelo Pix - Caio Delafiori Gallo - •••.633.698-•• - CAIXA ECONOMICA FEDERAL (0104) Agência: 327 Conta: 3701000000581599348-0\n04/12/2025,-60.00,69319d40-7299-4964-8095-6ffac9e67251,Transferência enviada pelo Pix - Caio Delafiori Gallo - •••.633.698-•• - BANCO INTER (0077) Agência: 1 Conta: 2440870-0\n04/12/2025,-70.00,69319d5d-a958-4a87-8c27-dc4be9005c63,Transferência enviada pelo Pix - Caio Delafiori Gallo - •••.633.698-•• - BANCO INTER (0077) Agência: 1 Conta: 2440870-0\n04/12/2025,-263.04,69319da4-6924-4ee5-8f8d-627b9b9f409a,Transferência enviada pelo Pix - CPFL SANTA CRUZ - 53.859.112/0001-69 - BCO SANTANDER (BRASIL) S.A. (0033) Agência: 445 Conta: 13000730-1\n04/12/2025,-76.90,69319df3-96eb-40b4-96a6-99cd695d6d2f,Transferência enviada pelo Pix - RECEITA FEDERAL - 00.394.460/0058-87 - ITAÚ UNIBANCO S.A. (0341) Agência: 332 Conta: 81010-0\n04/12/2025,-814.75,69319e35-c8d3-4b3d-8993-81b3932b6dbd,Pagamento de boleto efetuado - UNIMED DE OURINHOS COOPERATIVA DE TRABALHO MEDICO\n04/12/2025,-517.50,69319e80-b28c-430b-9341-b2369852cfca,Pagamento de boleto efetuado - BUSCH CONTABILIDADE E ADMINISTRACAO\n04/12/2025,-56.00,69319eeb-1736-4612-aa41-525ea9efff3a,Transferência enviada pelo Pix - Caio Delafiori Gallo - •••.633.698-•• - ITAÚ UNIBANCO S.A. (0341) Agência: 146 Conta: 63197-3\n04/12/2025,-343.03,6931a45e-f548-4330-a3b8-c00495cb891e,Transferência enviada pelo Pix - Caio Delafiori Gallo - •••.633.698-•• - CAIXA ECONOMICA FEDERAL (0104) Agência: 327 Conta: 3701000000581599348-0\n06/12/2025,-12.00,6934a1c7-3594-416d-9e87-fc29b9c9c269,Transferência enviada pelo Pix - DIOCESE DE OURINHOS - 03.101.168/0038-73 - COOP SICREDI NORTE SUL Agência: 720 Conta: 73783-6\n11/12/2025,420.00,693ab714-ff5d-4982-a4a4-8ed859fec535,Transferência Recebida - Andressa Maria Soares Bezerra - •••.031.168-•• - NU PAGAMENTOS - IP (0260) Agência: 1 Conta: 8639720-4\n11/12/2025,-877.28,693abc30-f506-4475-9b4d-8c2f9bba17be,Transferência enviada pelo Pix - RECEITA FEDERAL - 00.394.460/0058-87 - BCO DO BRASIL S.A. (0001) Agência: 1607 Conta: 333666-2\n12/12/2025,100.00,693c3884-3383-497c-9025-f3c8892e061f,Transferência Recebida - Andressa Maria Soares Bezerra - •••.031.168-•• - NU PAGAMENTOS - IP (0260) Agência: 1 Conta: 8639720-4\n12/12/2025,-50.00,693c695d-ceee-440a-9294-e5636900cd46,Transferência enviada pelo Pix - DAIANNE DE CARVALHO - •••.768.048-•• - CAIXA ECONOMICA FEDERAL (0104) Agência: 327 Conta: 1288000000771528711-4\n16/12/2025,473.40,69413c27-ba87-4472-abb9-1179897d7815,Transferência Recebida - Andressa Maria Soares Bezerra - •••.031.168-•• - NU PAGAMENTOS - IP (0260) Agência: 1 Conta: 8639720-4\n16/12/2025,-206.42,69413d20-9aad-40ab-a812-4ca392f4a901,Pagamento de boleto efetuado - UNIMED DE OURINHOS COOPERATIVA DE TRABALHO MEDICO\n17/12/2025,133.17,6942afae-e4d4-4204-a349-8a94e9c55f67,Valor adicionado na conta por cartão de crédito - Valor adicionado para Pix no Crédito\n17/12/2025,-133.17,6942afae-e4d4-4204-a349-8a9494c55f67,Transferência enviada pelo Pix - DIRETORIA GERAL DE FINANCAS - DGFIN - 46.377.222/0003-90 - BCO DO BRASIL S.A. (0001) Agência: 1897 Conta: 1300001-2\n17/12/2025,122.17,6942bd8e-ede5-432d-a224-fa59c91de5dd,Valor adicionado na conta por cartão de crédito - Valor adicionado para Pix no Crédito\n17/12/2025,-122.17,6942bd8e-ede5-432d-a224-fa59961de5dd,Transferência enviada pelo Pix - VALLESE COLONNELLA CLINICA MEDICA LTDA - 54.493.517/0001-99 - COOPERATIVA DE CRÉDITO LIVRE ADMISSÃO SICOOB OURICRED Agência: 4399 Conta: 8894-3\n19/12/2025,-101.89,6945961c-4a9f-42ef-8f65-579191d9e156,Pagamento de boleto efetuado - OURINHOS SANEAMENTO\n21/12/2025,-12.00,6947f56d-bd48-4396-9b98-2d3679600c5d,Transferência enviada pelo Pix - DIOCESE DE OURINHOS - 03.101.168/0038-73 - COOP SICREDI NORTE SUL Agência: 720 Conta: 73783-6\n25/12/2025,774.00,694d5209-474f-43f9-924e-37f0090930aa,Transferência recebida pelo Pix - AIRTON RODRIGUES - •••.995.348-•• - CAIXA ECONOMICA FEDERAL (0104) Agência: 327 Conta: 766617327-0\n```\n\nThe important part of the transaction description is concentrated after the dash ` - ` (even though the dash is not a good needle separator). Let's edit the transation description on import to convert these known repetitive description pieces to shorter variants. I want to know for example if it is a transfer or \"boleto\" payment. If it is a transfer, being positive or negative already says if it was sent or received. Let's think about how to integrate it effectivelly UI/UX wise in this flow. Make the matching of repetitive texts be very open by matching the text variants with upper or lower case, with or without ponctuation (acentos), etc. Think about it carefully and take your time.\n","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-08T06:10:57.191434-03:00","created_by":"caiodgallo","updated_at":"2026-01-08T07:09:21.807538-03:00","closed_at":"2026-01-08T07:09:21.807538-03:00","close_reason":"Closed"}
{"id":"northstar-a8y","title":"Create logging utilities and error tracking system","description":"According to CLAUDE.md, project needs logError (for production/Sentry), logForDebugging (user-facing), logEvent (analytics), and constants/errorIds.ts for error tracking. Currently using console.error everywhere.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-07T08:13:11.805461-03:00","created_by":"caiodgallo","updated_at":"2026-01-07T08:47:22.236835-03:00","closed_at":"2026-01-07T08:47:22.236835-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-a8y","depends_on_id":"northstar-vau","type":"blocks","created_at":"2026-01-07T08:13:28.154388-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-abg","title":"Phase 2: Translate reset-password page (/app/(auth)/reset-password/page.tsx)","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-05T07:06:16.410022-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T07:14:14.70723-03:00","closed_at":"2026-01-05T07:14:14.70723-03:00","close_reason":"Closed"}
{"id":"northstar-adh","title":"Fix misleading 'infinite loop' comment in bill-reminder-schedule","description":"Comment at line 56 claims '1 second after to avoid infinite loops' but this is inaccurate.\n\nLocation: lib/bill-reminder-schedule.ts:56\nCurrent: // 1 second after to avoid infinite loops\n\nIssue: The 1-second addition doesn't prevent infinite loops. Infinite loops are prevented by:\n- MAX_ITERATIONS = 365 safety counter\n- nextDue \u003e viewEnd break condition\n\nThe 1-second addition only ensures iteration moves past current date.\n\nFix: Change to 'Move forward 1 second to find the next occurrence after this one'\n\nFound by: comment-analyzer agent\nConfidence: CRITICAL","status":"open","priority":3,"issue_type":"task","owner":"caiogallo88@gmail.com","created_at":"2026-01-14T15:45:42.821244-03:00","created_by":"Caio Gallo","updated_at":"2026-01-14T15:45:42.821244-03:00","dependencies":[{"issue_id":"northstar-adh","depends_on_id":"northstar-dal","type":"blocks","created_at":"2026-01-14T15:47:14.80455-03:00","created_by":"Caio Gallo"}]}
{"id":"northstar-ahq","title":"Add edit transaction functionality","description":"## Summary\nAdd ability to edit transactions from expense/income cards and detail sheet.\n\n## Context\n- TransactionForm already supports edit mode via `transaction`/`income` props\n- Server actions `updateExpense` and `updateIncome` already exist\n- `getTransactionWithEntries(transactionId)` fetches transaction + entries\n\n## Key Behavior\nWhen editing expense with installments: ALL entries are deleted and regenerated, losing `paidAt` status.\n**Decision**: Show warning dialog before editing multi-installment expenses.\n\n## Implementation Steps\n\n### 1. Create EditTransactionDialog component\nNew file: `components/edit-transaction-dialog.tsx`\n- Handles fetching transaction with entries (for expenses)\n- Renders TransactionForm in edit mode\n- Shows warning for multi-installment expenses\n\n### 2. Update ExpenseCard\n- Add `accounts: Account[]` prop\n- Add \"Edit\" menu item to dropdown\n- Integrate EditTransactionDialog\n\n### 3. Update IncomeCard\n- Add `accounts: Account[]` prop\n- Add \"Edit\" menu item to dropdown\n- Integrate EditTransactionDialog\n\n### 4. Update TransactionDetailSheet\n- Add `accounts` and `categories` props\n- Make Edit button functional\n- Close sheet when opening edit dialog\n\n### 5. Update parent pages\nPass accounts prop to cards in:\n- `app/(app)/expenses/page.tsx`\n- `app/(app)/income/page.tsx`\n\n### 6. Add translations\nAdd keys to `messages/en.json` and `messages/pt-BR.json`:\n- `expenses.editTransaction`\n- `income.editTransaction`\n- Warning dialog text for multi-installment edits\n\n## Editable Fields\n**Expenses**: description, amount, category, account, purchaseDate, installments\n**Income**: description, amount, category, account, receivedDate\n\n## Files to Modify\n1. `components/edit-transaction-dialog.tsx` (new)\n2. `components/expense-card.tsx`\n3. `components/income-card.tsx`\n4. `components/transaction-detail-sheet.tsx`\n5. `app/(app)/expenses/page.tsx`\n6. `app/(app)/income/page.tsx`\n7. `messages/en.json`\n8. `messages/pt-BR.json`","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-03T06:44:47.98322-03:00","created_by":"caiodgallo","updated_at":"2026-01-03T06:53:54.658421-03:00","closed_at":"2026-01-03T06:53:54.658421-03:00","close_reason":"Closed"}
{"id":"northstar-aos","title":"Tests: Accounts - Test CRUD operations","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T10:27:32.348448-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T11:10:07.680657-03:00","closed_at":"2026-01-05T11:10:07.680657-03:00","close_reason":"Closed","comments":[{"id":4,"issue_id":"northstar-aos","author":"caiodgallo","text":"# User Journey: Accounts CRUD\n\n## Server Actions: `/lib/actions/accounts.ts`\n\n### Happy Path Tests\n\n#### 1. `getAccounts()`\n- Returns all accounts for current user\n- Ordered by name alphabetically\n- Returns empty array if user has no accounts\n- Filters by userId correctly (user isolation)\n\n#### 2. `createAccount(data)` - Happy Paths\n- Create checking account successfully\n- Create savings account successfully\n- Create cash account successfully\n- Create credit card account (without billing config)\n- Create credit card account (with closingDay and paymentDueDay)\n- Verify userId is auto-assigned\n- Verify currency defaults to 'BRL'\n- Verify all required fields are stored correctly\n\n#### 3. `updateAccount(id, data)` - Happy Paths\n- Update account name\n- Update account type (e.g., checking → savings)\n- Add billing config to credit card (closingDay, paymentDueDay)\n- Remove billing config from credit card (set to null)\n- Verify both id and userId must match (cannot update another user's account)\n\n#### 4. `deleteAccount(id)` - Happy Paths\n- Delete account successfully\n- Verify both id and userId must match\n- Verify account no longer exists after deletion\n- Cascade: verify linked faturas are deleted (FK cascade)\n\n### Edge Case Tests\n\n#### 1. Account Type Validation\n- Create account with each type: 'checking', 'savings', 'credit_card', 'cash'\n- Invalid type should be rejected by TypeScript/Drizzle\n\n#### 2. Billing Config Constraints\n- closingDay must be 1-28 (test with 1, 28, 15)\n- paymentDueDay must be 1-28 (test with 1, 28, 5)\n- Invalid closingDay (0, 29, 31) should fail\n- Invalid paymentDueDay should fail\n- closingDay/paymentDueDay should only be required for credit_card type\n\n#### 3. Account Name Constraints\n- Empty name should fail\n- Very long name (should work but test it)\n- Duplicate names (should be allowed - no unique constraint)\n- Special characters in name (should work)\n\n#### 4. Currency Field\n- Default 'BRL' when not provided\n- Should accept other currency codes if provided (test if schema allows)\n- Verify currency is stored correctly\n\n#### 5. Referential Integrity on Delete\n- Delete account with entries → should fail (FK constraint)\n- Delete account with income → should fail (FK constraint)\n- Delete account with faturas → should succeed (cascade delete)\n- Delete account used in transactions via entries → should fail\n\n### Error Handling Tests\n\n#### 1. Create Account Errors\n- Missing required fields (name, type)\n- Invalid account type\n\n#### 2. Update Account Errors\n- Update non-existent account\n- Update account belonging to another user (userId mismatch)\n- Invalid billing config values (day out of range)\n\n#### 3. Delete Account Errors\n- Delete non-existent account\n- Delete account belonging to another user\n- Delete account referenced by entries (FK constraint violation)\n- Delete account referenced by income (FK constraint violation)\n\n### Integration Tests\n\n#### 1. Account-Fatura Relationship\n- Create credit card account → create expense → fatura created\n- Verify fatura belongs to correct account\n- Delete account → all faturas cascade deleted\n\n#### 2. Account-Entry Relationship\n- Create checking account → create expense with this account\n- Verify entry references correct account\n- Try to delete account → should fail (FK constraint)\n\n#### 3. Account-Income Relationship\n- Create account → create income with this account\n- Verify income references correct account\n- Try to delete account → should fail (FK constraint)\n\n#### 4. User Isolation\n- Create accounts for two users\n- User A cannot see User B's accounts\n- User A cannot update/delete User B's accounts\n- getAccounts() returns only current user's accounts\n\n#### 5. Account Type Configuration\n- Create credit card with billing config → create expense\n- Verify fatura month calculated correctly using closingDay\n- Verify due date calculated correctly using paymentDueDay\n- Create credit card without billing config → use fallback logic\n\n#### 6. Multiple Accounts\n- Create multiple accounts of same type\n- Create multiple accounts of different types\n- Verify getAccounts() returns all\n- Verify ordering by name\n\n### Revalidation Tests\n\n#### 1. Cache Invalidation\n- createAccount → revalidatePath('/settings/accounts') called\n- updateAccount → revalidatePath('/settings/accounts') called\n- deleteAccount → revalidatePath('/settings/accounts') called\n- Verify revalidateTag('accounts') called\n\n### Test File Location\n`/test/lib/actions/accounts.test.ts`\n\n### Implementation Notes\n- Use existing fixtures (testAccounts)\n- Mock auth with test user ID\n- Use in-memory PGlite database\n- Test referential integrity explicitly (FK constraints)\n- Test user isolation extensively\n- Test billing config logic (critical for credit cards)\n- Follow pattern from expenses.test.ts\n","created_at":"2026-01-05T13:43:32Z"}]}
{"id":"northstar-apg","title":"Support task duration in calendar display","description":"File: app/(app)/calendar/page.tsx:91-103. Tasks render as point-in-time (start = end = dueAt). Should use startAt + durationMinutes when available to show task time blocks.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-07T08:04:45.066203-03:00","created_by":"caiodgallo","updated_at":"2026-01-07T08:32:45.213112-03:00","closed_at":"2026-01-07T08:32:45.213112-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-apg","depends_on_id":"northstar-vau","type":"blocks","created_at":"2026-01-07T08:11:54.047127-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-b2h","title":"Complete i18n Implementation - Comprehensive Translation Coverage","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-05T07:04:28.80169-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T10:10:01.836064-03:00","closed_at":"2026-01-05T10:10:01.836064-03:00","close_reason":"Closed"}
{"id":"northstar-b4a","title":"Create multi-installment expense from CC import","description":"Right now the credit card import ignore multi-installment purchase and import them as regular purchases. I want to be able to identify that a multi-installment purchase is being done and create the expense as such.\n\nThe import behavior I want is to not disrupt previous faturas. For example if it is a purchase like \"TV - Parcela 1/8\" we create all the installmentes since it is the first. Other wise if it is \"Bed - Parcela 4/8\" and the multi-installment purchase does not exist yet we create just the equivalent of the last  5 (4 inclusive to 8).\n\nChallenges to think about:\n\n- CC imports do not have naturally an external id WHEN the fatura is still open, so we would need a way to uniquely identify the CC purchases. date + description + amount is good candidate, the only edge case would be purchases on the same place on the exact same day with the same value, then it would not be really unique. How can we go about this challenge? It affects the CC import overall, not just the multi-install import aspect.\n\n\nExample nubank CC import with regular and multi-installment expenses\n\n```csv\n2025-12-02,Subway Ourinhos,85.40\n2025-12-02,F A dos Santos Minimer,5.59\n2025-12-01,Mercadolivre*Mercadol - Parcela 5/5,11.63\n2025-12-01,Hering Ourinhos - Parcela 2/5,143.18\n2025-12-01,Amazonmktplc*Alvesbaby - Parcela 6/10,99.99\n```\n\nThink about it carefully and take your time.\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T07:49:07.927069-03:00","created_by":"caiodgallo","updated_at":"2026-01-12T08:12:33.068645-03:00","closed_at":"2026-01-12T08:12:33.068645-03:00","close_reason":"Closed"}
{"id":"northstar-b91","title":"Test Coverage Improvement Initiative","description":"Improve test coverage for critical application flows from current 71.59% to 80%+ with focus on high-risk areas. Several critical systems have \u003c 40% coverage including natural language parsing (33%), CSV import (30%), and rate limiting (17%). These gaps hide production bugs in user-facing features and security-critical code.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-12T16:27:23.297094-03:00","created_by":"caiodgallo","updated_at":"2026-01-12T16:35:17.253927-03:00","closed_at":"2026-01-12T16:35:17.253927-03:00","close_reason":"Closed"}
{"id":"northstar-b9s","title":"Debug 401 error on login despite captchaToken fix","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-13T11:29:09.347698-03:00","created_by":"caiodgallo","updated_at":"2026-01-14T05:54:36.14219-03:00","closed_at":"2026-01-14T05:54:36.14219-03:00","close_reason":"Closed"}
{"id":"northstar-bab","title":"Test form field validation and accessibility","description":"Current coverage: 16% statements, 7% branches. Form fields used across entire app for data entry. Untested: field composition (11-25), error display (111-204), accessibility features. Missing tests: validation errors, help text, required indicators, disabled states, a11y compliance. Real risk: form validation UX bugs frustrate users during critical flows (expense entry, account setup). Accessibility issues exclude users with disabilities (WCAG compliance). Inconsistent error display confuses users. Component used everywhere = widespread impact.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T16:27:48.275021-03:00","created_by":"caiodgallo","updated_at":"2026-01-12T22:05:06.380857-03:00","closed_at":"2026-01-12T22:05:06.380857-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-bab","depends_on_id":"northstar-b91","type":"blocks","created_at":"2026-01-12T16:31:22.28665-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-bbo","title":"Phase 3: Translate auth.ts server action errors","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:28.048369-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T09:39:42.230219-03:00","closed_at":"2026-01-05T09:39:42.230219-03:00","close_reason":"Closed"}
{"id":"northstar-bcw","title":"Show duplicate indicator in CC import preview","description":"Now that CC imports generate synthetic externalIds (via hash), we can detect duplicates BEFORE import. Current behavior: duplicates silently skipped after user clicks import. Better UX: show duplicate badge in preview, default to unchecked.\n\nFlow:\n1. Add server action checkDuplicates(externalIds) \n2. Call in handleFileSelect after getCategorySuggestions\n3. Enrich rows with isDuplicate flag\n4. ImportPreview shows yellow 'Already imported' badge\n5. Default selectedRows = non-duplicates only\n\nFiles:\n- lib/actions/import.ts - new checkDuplicates action\n- components/import/import-modal.tsx - call checkDuplicates\n- components/import/import-preview.tsx - render duplicate badge","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T08:20:34.565406-03:00","created_by":"caiodgallo","updated_at":"2026-01-12T12:21:23.218061-03:00","closed_at":"2026-01-12T12:21:23.218061-03:00","close_reason":"Closed"}
{"id":"northstar-bk3","title":"Phase 6: Tests \u0026 polish for iCal sync","description":"Unit tests for iCal parser (sample .ics from Google, Outlook, Apple). Unit tests for sync engine (insert, update, orphan handling). Integration test for full sync flow.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T07:28:55.332796-03:00","created_by":"caiodgallo","updated_at":"2026-01-09T11:26:46.913373-03:00","closed_at":"2026-01-09T11:26:46.913373-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-bk3","depends_on_id":"northstar-p86","type":"parent-child","created_at":"2026-01-09T07:29:20.501886-03:00","created_by":"caiodgallo"},{"issue_id":"northstar-bk3","depends_on_id":"northstar-rxa","type":"blocks","created_at":"2026-01-09T07:29:28.860404-03:00","created_by":"caiodgallo"},{"issue_id":"northstar-bk3","depends_on_id":"northstar-bmf","type":"blocks","created_at":"2026-01-09T07:29:29.026165-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-blr","title":"Address existing lint warnings in coverage and test components","description":"pnpm lint reports warnings in coverage/block-navigation.js and test/components/* for unused variables; clean up or adjust lint config.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-13T10:40:20.881764-03:00","created_by":"caiodgallo","updated_at":"2026-01-14T08:07:33.962166-03:00","closed_at":"2026-01-14T08:07:33.962166-03:00","close_reason":"Closed"}
{"id":"northstar-bmf","title":"Phase 5: Calendar subscriptions UI","description":"Create settings/calendars page listing calendar sources. Add calendar source dialog (name, URL, color, test button). Calendar source card (status, last sync, toggle, sync now, edit, delete). Add translations (en.json, pt-BR.json). Add error IDs to constants/errorIds.ts.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T07:28:54.190448-03:00","created_by":"caiodgallo","updated_at":"2026-01-09T11:26:46.911337-03:00","closed_at":"2026-01-09T11:26:46.911337-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-bmf","depends_on_id":"northstar-p86","type":"parent-child","created_at":"2026-01-09T07:29:20.335358-03:00","created_by":"caiodgallo"},{"issue_id":"northstar-bmf","depends_on_id":"northstar-20h","type":"blocks","created_at":"2026-01-09T07:29:28.692215-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-byy","title":"Add accountForm namespace to en.json and pt-BR.json","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:03.333705-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T07:20:20.294114-03:00","closed_at":"2026-01-05T07:20:20.294114-03:00","close_reason":"Closed"}
{"id":"northstar-cbr","title":"Calendar does not display events/tasks created via frontend","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-07T09:39:22.460431-03:00","created_by":"caiodgallo","updated_at":"2026-01-07T09:54:41.481515-03:00","closed_at":"2026-01-07T09:54:41.481515-03:00","close_reason":"Closed"}
{"id":"northstar-cf8","title":"Test currency and date utility functions","description":"Current coverage: 54% statements, 10% branches. Core utilities used throughout the finance app. Untested: currency formatting and conversion (126-147), date arithmetic. Missing tests: centsToDisplay with negatives/edge cases, displayToCents with invalid input, formatting edge cases, timezone handling. Real risk: money display bugs in a FINANCE app = lost user trust. Off-by-one cent errors compound across thousands of transactions. Date bugs in fatura calculations = wrong billing cycles. Utils are foundational - bugs here affect every feature.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T16:27:48.057675-03:00","created_by":"caiodgallo","updated_at":"2026-01-12T17:29:51.457453-03:00","closed_at":"2026-01-12T17:29:51.457453-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-cf8","depends_on_id":"northstar-b91","type":"blocks","created_at":"2026-01-12T16:31:22.12012-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-coe","title":"Add error handling to getActiveBillReminders action","description":"getActiveBillReminders lacks try-catch unlike other actions in same file.\n\nLocation: lib/actions/bill-reminders.ts:25-32\nComparison: createBillReminder, updateBillReminder, deleteBillReminder all have try-catch\n\nImpact: DB or auth failures propagate uncaught, causing 500 errors\n\nFix: Add try-catch wrapper following pattern of other actions in file\n\nFound by: silent-failure-hunter agent\nConfidence: CRITICAL","status":"closed","priority":0,"issue_type":"bug","owner":"caiogallo88@gmail.com","created_at":"2026-01-14T15:39:16.69748-03:00","created_by":"Caio Gallo","updated_at":"2026-01-14T16:11:54.402985-03:00","closed_at":"2026-01-14T16:11:54.402985-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-coe","depends_on_id":"northstar-dal","type":"blocks","created_at":"2026-01-14T15:39:50.486553-03:00","created_by":"Caio Gallo"}]}
{"id":"northstar-cyu","title":"Fix Vercel cron job limit build error","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T14:45:02.871313-03:00","created_by":"caiodgallo","updated_at":"2026-01-08T14:49:29.633749-03:00","closed_at":"2026-01-08T14:49:29.633749-03:00","close_reason":"Closed"}
{"id":"northstar-dal","title":"Review: Unified Calendar Feature","description":"Comprehensive code review of the unified calendar feature that:\n- Merged Events, Tasks, and Bill Reminders into single Calendar page\n- Added toggle-based filtering (Events/Tasks/Bills/Hide Completed)\n- Implemented bill reminder schedule builder and detail sheet\n- Removed standalone /tasks route\n- Applied OKLCH color scheme for distinct item type styling\n\nReview areas: code quality, silent failures, error handling, type design, test coverage, comment accuracy","status":"closed","priority":1,"issue_type":"epic","owner":"caiogallo88@gmail.com","created_at":"2026-01-14T15:30:02.291974-03:00","created_by":"Caio Gallo","updated_at":"2026-01-14T16:03:23.197261-03:00","closed_at":"2026-01-14T16:03:23.197261-03:00","close_reason":"Closed"}
{"id":"northstar-dcc","title":"Fix recurrence rule creation for daily events","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-08T08:24:24.806588-03:00","created_by":"caiodgallo","updated_at":"2026-01-08T09:11:49.091554-03:00","closed_at":"2026-01-08T09:11:49.091554-03:00","close_reason":"Closed"}
{"id":"northstar-dji","title":"Improve catch block specificity for better error messages","description":"Files: All CRUD operations in lib/actions/*.ts. Currently catch all errors with generic messages. Should differentiate constraint violations, FK errors, connection failures, etc. to provide better user feedback.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T08:13:10.482493-03:00","created_by":"caiodgallo","updated_at":"2026-01-07T09:07:11.72021-03:00","closed_at":"2026-01-07T09:07:11.72021-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-dji","depends_on_id":"northstar-vau","type":"blocks","created_at":"2026-01-07T08:13:27.936677-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-dmc","title":"Add i18n translations to BillReminderDetailSheet","description":"BillReminderDetailSheet has hardcoded English strings throughout:\n- 'Amount', 'Category', 'This Occurrence', 'Next Due Date', 'Recurrence', 'Ends'\n- Weekday names in getRecurrenceDescription()\n- Status labels\n- Info note text\n\nLocation: components/calendar/bill-reminder-detail-sheet.tsx\nImpact: Breaks multi-language support for bill reminder details\n\nFix: Add useTranslations hook and use translation keys for all user-visible strings\n\nFound by: code-reviewer agent\nConfidence: 95%","status":"closed","priority":1,"issue_type":"bug","owner":"caiogallo88@gmail.com","created_at":"2026-01-14T15:39:13.565565-03:00","created_by":"Caio Gallo","updated_at":"2026-01-14T16:22:25.274844-03:00","closed_at":"2026-01-14T16:22:25.274844-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-dmc","depends_on_id":"northstar-dal","type":"blocks","created_at":"2026-01-14T15:39:49.851269-03:00","created_by":"Caio Gallo"}]}
{"id":"northstar-du1","title":"Add forgotPassword namespace to en.json and pt-BR.json","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:02.375668-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T07:20:24.624546-03:00","closed_at":"2026-01-05T07:20:24.624546-03:00","close_reason":"forgotPassword and resetPassword namespaces already exist with complete translations"}
{"id":"northstar-e7o","title":"Add i18n translations to calendar toggle filters","description":"Calendar toggle filters (Events/Tasks/Bills/Hide Completed) use hardcoded English strings instead of translation keys.\n\nLocation: app/(app)/calendar/page.tsx lines ~652-667\nImpact: Breaks multi-language support\n\nFix: Use t() translation function with keys like t('filter.events'), t('filter.tasks'), etc.\n\nFound by: code-reviewer agent\nConfidence: 95%","status":"closed","priority":1,"issue_type":"bug","owner":"caiogallo88@gmail.com","created_at":"2026-01-14T15:39:12.545747-03:00","created_by":"Caio Gallo","updated_at":"2026-01-14T16:22:25.480308-03:00","closed_at":"2026-01-14T16:22:25.480308-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-e7o","depends_on_id":"northstar-dal","type":"blocks","created_at":"2026-01-14T15:39:49.640797-03:00","created_by":"Caio Gallo"}]}
{"id":"northstar-ebo","title":"Test rate limiting for auth and bulk operations","description":"Current coverage: 17% statements, 7% branches. Security-critical: protects against brute force and DoS. Untested: all three limiters (login, bulk, password reset), Redis fallback behavior (15-71), IP extraction logic (54-62). Missing tests: limit exceeded scenarios, Redis unavailable, IP header variations, concurrent requests. Real risk: no rate limiting in prod if Redis misconfigured. Enables: login brute force, password reset abuse, bulk import DoS. Silent failure = security vulnerability with no visibility.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-12T16:27:47.614724-03:00","created_by":"caiodgallo","updated_at":"2026-01-12T17:30:09.956477-03:00","closed_at":"2026-01-12T17:30:09.956477-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-ebo","depends_on_id":"northstar-b91","type":"blocks","created_at":"2026-01-12T16:31:21.774623-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-ec9","title":"Fix authentication: login failing with 401 and dashboard not redirecting unauthenticated users","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-13T11:25:11.275762-03:00","created_by":"caiodgallo","updated_at":"2026-01-13T11:28:33.853322-03:00","closed_at":"2026-01-13T11:28:33.853322-03:00","close_reason":"Closed"}
{"id":"northstar-egy","title":"Phase 2: Translate forgot-password page (/app/(auth)/forgot-password/page.tsx)","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-05T07:06:16.120955-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T07:12:12.460091-03:00","closed_at":"2026-01-05T07:12:12.460091-03:00","close_reason":"Closed"}
{"id":"northstar-ehn","title":"Add validation for userSettings fields","description":"File: lib/actions/user-settings.ts. Validate timezone (IANA identifier), notificationEmail (email format), offset minutes (0-10080 range) before saving. Currently accepts any values.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T08:13:15.996968-03:00","created_by":"caiodgallo","updated_at":"2026-01-07T09:00:59.847171-03:00","closed_at":"2026-01-07T09:00:59.847171-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-ehn","depends_on_id":"northstar-vau","type":"blocks","created_at":"2026-01-07T08:13:28.799473-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-enc","title":"Phase 1: Audit and enhance translation files","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:02.113314-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T07:19:49.590389-03:00","closed_at":"2026-01-05T07:19:49.590389-03:00","close_reason":"Closed"}
{"id":"northstar-ep5","title":"Add missing error keys to errors namespace","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:04.127045-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T10:09:04.177628-03:00","closed_at":"2026-01-05T10:09:04.177628-03:00","close_reason":"Closed"}
{"id":"northstar-f1c","title":"Translate the Accounts page","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-02T12:31:36.862994-03:00","created_by":"caiodgallo","updated_at":"2026-01-02T12:31:52.644518-03:00","deleted_at":"2026-01-02T12:31:52.644518-03:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"northstar-f8i","title":"Add database check constraints for temporal invariants","description":"Files: lib/schema.ts events table (startAt \u003c endAt), tasks table (startAt \u003c= dueAt, durationMinutes \u003e 0). Add check constraints in migration to enforce at database level.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T08:13:13.114772-03:00","created_by":"caiodgallo","updated_at":"2026-01-07T08:56:04.977757-03:00","closed_at":"2026-01-07T08:56:04.977757-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-f8i","depends_on_id":"northstar-vau","type":"blocks","created_at":"2026-01-07T08:13:28.377649-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-fjo","title":"Test createEvent with notification scheduling","description":"5 test cases: all fields, minimal fields, notification scheduling, success/error returns","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-08T07:13:06.107466-03:00","created_by":"caiodgallo","updated_at":"2026-01-08T07:25:32.730049-03:00","closed_at":"2026-01-08T07:25:32.730049-03:00","close_reason":"Created comprehensive test suite with 11 tests covering: minimal fields, all fields populated, all-day events, notification job scheduling with multiple configs, disabled notification configs (no jobs created), success/error ActionResult format, automatic userId assignment, cache revalidation, all priority levels, and all status values. All tests passing.","dependencies":[{"issue_id":"northstar-fjo","depends_on_id":"northstar-s19","type":"blocks","created_at":"2026-01-08T07:13:23.442785-03:00","created_by":"caiodgallo"},{"issue_id":"northstar-fjo","depends_on_id":"northstar-5ad","type":"blocks","created_at":"2026-01-08T07:13:23.61629-03:00","created_by":"caiodgallo"},{"issue_id":"northstar-fjo","depends_on_id":"northstar-62p","type":"parent-child","created_at":"2026-01-08T07:13:41.138563-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-fm5","title":"Fix failing component tests (transaction/transfer/budget forms)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T14:34:11.301933-03:00","created_by":"caiodgallo","updated_at":"2026-01-12T14:55:29.21674-03:00","closed_at":"2026-01-12T14:55:29.21674-03:00","close_reason":"Closed"}
{"id":"northstar-fvx","title":"Handle notification scheduling failures in event/task creation","description":"File: lib/actions/notifications.ts:54-74. If scheduleNotificationJobs fails during event/task creation, error is swallowed. Should either propagate error or log warning.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-07T08:11:21.238915-03:00","created_by":"caiodgallo","updated_at":"2026-01-07T08:48:43.588401-03:00","closed_at":"2026-01-07T08:48:43.588401-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-fvx","depends_on_id":"northstar-vau","type":"blocks","created_at":"2026-01-07T08:11:55.89389-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-g28","title":"Test CSV import installment and duplicate handling","description":"Current coverage: 30% statements, 21% branches. Critical for user onboarding - many users migrate from spreadsheets. Untested: findExistingInstallmentTransaction (281-316), computeEntryDates (317-376), processInstallmentGroup (378-465), importMixed (467-645). Missing tests for: importing partial installments (Parcela 2/3 only), duplicate detection across all tables, mixed expense+income imports, installment date calculations. Real risk: data corruption on bulk import is catastrophic - wrong fatura months, duplicate entries, broken account balances. Hard to detect until users notice discrepancies weeks later.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-12T16:27:46.931025-03:00","created_by":"caiodgallo","updated_at":"2026-01-14T08:21:33.770597-03:00","closed_at":"2026-01-14T08:21:33.770597-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-g28","depends_on_id":"northstar-b91","type":"blocks","created_at":"2026-01-12T16:31:21.238997-03:00","created_by":"caiodgallo"},{"issue_id":"northstar-g28","depends_on_id":"northstar-7ta","type":"blocks","created_at":"2026-01-12T16:31:27.34363-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-gbe","title":"Fix hardcoded email address in notification system","description":"File: lib/actions/notification-jobs.ts:138. Email hardcoded to 'user@example.com'. Should fetch from userSettings.notificationEmail. All notifications currently go to wrong address.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-07T08:04:18.58971-03:00","created_by":"caiodgallo","updated_at":"2026-01-07T08:21:22.675988-03:00","closed_at":"2026-01-07T08:21:22.675988-03:00","close_reason":"Fetch notification email from userSettings.notificationEmail instead of hardcoded value","dependencies":[{"issue_id":"northstar-gbe","depends_on_id":"northstar-vau","type":"blocks","created_at":"2026-01-07T08:11:52.401246-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-gbp","title":"Translate the Accounts page","description":"The Accounts page is still mainly hardcoded strings. They need to following the internalitzation pattern established accross the codebase and translated the suitable strings. Mainly UI components and layout at the present moment.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T12:32:22.893286-03:00","created_by":"caiodgallo","updated_at":"2026-01-02T14:48:48.710898-03:00","closed_at":"2026-01-02T14:48:48.710898-03:00","close_reason":"Closed"}
{"id":"northstar-gde","title":"Tests: Add comprehensive test coverage for user journeys","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-05T10:27:27.066482-03:00","created_by":"caiodgallo","updated_at":"2026-01-14T11:27:20.875697-03:00","closed_at":"2026-01-06T06:34:55.471854-03:00","comments":[{"id":5,"issue_id":"northstar-gde","author":"caiodgallo","text":"# Testing Plan Summary\n\n## Executive Summary\n\nComprehensive test coverage has been planned for all major user journeys in the Northstar application. The plan is organized into 8 tasks within a Tests epic, prioritized by business criticality.\n\n## Current State\n\n### Well-Tested (✓)\n- **Expenses** - 572 lines of tests, comprehensive coverage\n- **Income** - 467 lines of tests, comprehensive coverage\n\n### No Test Coverage (✗)\n- Dashboard - 0 tests\n- Faturas - No dedicated test file (partial coverage in expense tests)\n- Accounts - 0 tests\n- Categories - 0 tests\n- Budgets - 0 tests\n\n## Testing Infrastructure\n\n### Stack\n- **Test Runner**: Vitest with happy-dom environment\n- **Database**: In-memory PGlite (PostgreSQL)\n- **Testing Library**: @testing-library/react for components\n- **Mocking**: vi.mock for next/cache revalidatePath\n- **Auth**: Mock getCurrentUserId() with test user\n\n### Existing Patterns\n- Fixtures in `/test/fixtures.ts` (testAccounts, testCategories)\n- Helpers: createTestTransaction(), createTestEntry(), createTestIncome()\n- Setup: `/test/setup.ts` (cleanup, mocks)\n- DB Utils: `/test/db-utils.ts` (PGlite setup, table clearing)\n\n## Test Plan\n\n### Priority 1 (Critical - Business Critical)\n\n#### 1. Dashboard - Test getDashboardData server action\n**ID**: northstar-797\n**File**: `/test/lib/actions/dashboard.test.ts`\n\n**Why P1**: Dashboard is the main user-facing view, critical for user trust\n\n**Key Test Areas**:\n- Empty state handling\n- Expenses only, income only scenarios\n- Budget tracking (spending calculation by purchaseDate)\n- Recent lists ordering\n- Month boundary handling\n- Installment expense filtering\n- User isolation\n\n**Estimated Effort**: 3-4 hours\n\n#### 2. Faturas - Test CRUD operations and payment flows\n**ID**: northstar-wvj\n**File**: `/test/lib/actions/faturas.test.ts`\n\n**Why P1**: Faturas are core to Brazilian credit card billing, payment flow is critical\n\n**Key Test Areas**:\n- Auto-creation on expense creation\n- Total calculation and updates\n- Payment flow (mark paid/unpaid)\n- Fatura-entry relationships\n- Cascade deletion (account → faturas)\n- User isolation\n\n**Estimated Effort**: 2-3 hours\n\n### Priority 2 (Important - Business Important)\n\n#### 3. Accounts - Test CRUD operations\n**ID**: northstar-aos\n**File**: `/test/lib/actions/accounts.test.ts`\n\n**Why P2**: Accounts are foundational, but simple CRUD\n\n**Key Test Areas**:\n- Create/Update/Delete all account types\n- Billing config validation (closingDay, paymentDueDay)\n- Referential integrity (cannot delete if used)\n- User isolation\n\n**Estimated Effort**: 1-2 hours\n\n#### 4. Categories - Test CRUD operations\n**ID**: northstar-v0d\n**File**: `/test/lib/actions/categories.test.ts`\n\n**Why P2**: Categories are foundational, with referential integrity checks\n\n**Key Test Areas**:\n- Create/Update/Delete categories\n- Icon validation (38 predefined icons)\n- Referential integrity (cannot delete if used by transactions/income)\n- Cascade delete (budgets deleted when category deleted)\n- User isolation\n\n**Estimated Effort**: 1-2 hours\n\n#### 5. Budgets - Test CRUD and calculation logic\n**ID**: northstar-th0\n**File**: `/test/lib/actions/budgets.test.ts`\n\n**Why P2**: Budget calculation is complex and critical for dashboard accuracy\n\n**Key Test Areas**:\n- Create/Update/Delete budgets (per-category and monthly)\n- Spending calculation by purchaseDate\n- getBudgetsWithSpending aggregation logic\n- Copy budgets from previous month\n- Zero budgets and missing budgets\n- User isolation\n\n**Estimated Effort**: 2-3 hours\n\n#### 6. Faturas - Test billing cycle calculations\n**ID**: northstar-8qt\n**File**: `/test/lib/fatura-utils.test.ts`\n\n**Why P2**: Billing cycle logic is complex but tested in utility functions (no DB needed)\n\n**Key Test Areas**:\n- getFaturaMonth() closing day logic\n- getFaturaPaymentDueDate() calculation\n- Installment expense fatura month mapping\n- Month/year boundaries\n- Leap years\n- Real-world Brazilian billing cycles (Nubank, Itaú)\n- Regression tests for historical bugs\n\n**Estimated Effort**: 2-3 hours\n\n#### 7. Dashboard - Test components and edge cases\n**ID**: northstar-0qa\n**File**: `/test/components/dashboard.test.ts`\n\n**Why P2**: Component testing is lower priority than server actions\n\n**Key Test Areas**:\n- BalanceSummary component (income/expenses/balance display)\n- SummaryCard component (budget/spent/remaining)\n- BudgetProgress component (progress bars, color coding)\n- RecentExpenses component (list display)\n- MonthPicker component (navigation)\n- Edge cases (zero values, division by zero, over budget)\n- Internationalization (pt-BR/en)\n- Loading states\n\n**Estimated Effort**: 3-4 hours\n\n## Total Estimated Effort\n\n- **P1 Tasks**: 5-7 hours\n- **P2 Tasks**: 9-14 hours\n- **Total**: 14-21 hours\n\n## Test Strategy\n\n### Happy Paths\n- Focus on normal user workflows\n- Test each CRUD operation (Create, Read, Update, Delete)\n- Verify correct data flow from server action to database\n\n### Edge Cases\n- Zero values\n- Division by zero\n- Empty states\n- Month/year boundaries\n- Leap years\n- Very large amounts\n- Missing data (null/undefined)\n- Over budget scenarios\n- Multiple accounts/categories\n\n### Common Edge Cases Across All Journeys\n1. **User Isolation**: Verify no data leakage between users\n2. **Referential Integrity**: Foreign key constraints on delete\n3. **Money Handling**: All values in cents, convert correctly\n4. **Date Handling**: Timezone-safe, correct month boundaries\n5. **Internationalization**: Both pt-BR and en locales\n6. **Cache Invalidation**: revalidatePath/revalidateTag called\n7. **Validation**: Invalid inputs rejected with proper errors\n\n## Implementation Recommendations\n\n### 1. Follow Existing Patterns\n- Copy structure from `/test/lib/actions/expenses.test.ts`\n- Use existing fixtures and helper functions\n- Mock auth with `mockAuth()` from `/test/auth-utils.ts`\n- Use PGlite database with migrations\n\n### 2. Test Structure\n```typescript\n// Standard test file structure\nimport { describe, it, expect, beforeEach, afterEach } from 'vitest';\nimport { mockAuth } from '@/test/auth-utils';\nimport { setupTestDb, teardownTestDb, clearAllTables, getTestDb } from '@/test/db-utils';\nimport { TEST_USER_ID, testAccounts, testCategories } from '@/test/fixtures';\n\n// Mock auth before importing actions\nmockAuth();\n\ndescribe('Server Action: actionName', () =\u003e {\n  let db;\n  \n  beforeEach(async () =\u003e {\n    db = await setupTestDb();\n  });\n  \n  afterEach(async () =\u003e {\n    await clearAllTables();\n    await teardownTestDb();\n  });\n  \n  describe('Happy Paths', () =\u003e {\n    it('should do something', async () =\u003e {\n      // Arrange\n      const account = await db.insert(accounts).values(testAccounts.checking).returning();\n      \n      // Act\n      const result = await someAction(account[0].id);\n      \n      // Assert\n      expect(result).toBeDefined();\n    });\n  });\n  \n  describe('Edge Cases', () =\u003e {\n    // Edge case tests\n  });\n  \n  describe('Error Handling', () =\u003e {\n    // Error handling tests\n  });\n});\n```\n\n### 3. Test Data Management\n- Use `clearAllTables()` in afterEach to reset state\n- Create test data in beforeEach when needed\n- Use fixtures for common data (accounts, categories)\n- Create specific test data inline for each test\n\n### 4. Assertion Patterns\n- Verify database state after mutations\n- Verify return values are correct\n- Verify errors are thrown/rejected\n- Verify foreign key constraints work\n- Verify user isolation (filter by userId)\n\n### 5. Naming Conventions\n- Test files: `*.test.ts`\n- Describe blocks: Feature or action name\n- Test cases: \"should...\" format\n- Group tests: Happy Paths, Edge Cases, Error Handling, Integration\n\n### 6. Coverage Goals\n- Aim for 80%+ coverage on server actions\n- Test all public functions and methods\n- Test all error paths\n- Test validation logic\n- Test edge cases\n\n## Next Steps\n\n1. **Start with P1 tasks** (Dashboard and Faturas CRUD)\n   - Highest business value\n   - Most complex logic\n   - Foundation for other tests\n\n2. **Proceed to P2 tasks** (Accounts, Categories, Budgets, Billing Cycle)\n   - Simpler CRUD operations\n   - Foundation for application\n   - Complete coverage\n\n3. **Component testing last** (Dashboard Components)\n   - Lower priority\n   - Nice to have but not critical\n   - Server actions more important\n\n## Risk Mitigation\n\n### Testing Pitfalls to Avoid\n\n1. **Don't Test UI Framework Code**\n   - Don't test shadcn/ui components\n   - Don't test Next.js routing\n   - Focus on your application logic\n\n2. **Don't Over-Test**\n   - Don't test trivial getters/setters\n   - Don't test implementation details\n   - Test behavior, not code structure\n\n3. **Don't Ignore Timezone Issues**\n   - Always use UTC methods for date calculations\n   - Test with different timezones if relevant\n   - Verify parseLocalDate() is used\n\n4. **Don't Forget User Isolation**\n   - Always test with multiple users\n   - Verify queries filter by userId\n   - Test that users can't access each other's data\n\n5. **Don't Assume Data Integrity**\n   - Test with invalid data\n   - Test with missing data\n   - Test with contradictory data\n\n## Success Criteria\n\nA task is complete when:\n- All happy paths tested\n- Common edge cases tested\n- Error handling tested\n- User isolation tested\n- Referential integrity tested\n- Tests follow existing patterns\n- All tests pass\n- Code coverage meets goals (80%+)\n\n## Maintenance\n\n### Keeping Tests Relevant\n- Update tests when requirements change\n- Add tests for new features\n- Fix tests when code changes\n- Run tests before committing changes\n\n### Running Tests\n```bash\n# Run all tests\npnpm test\n\n# Run specific test file\npnpm test dashboard.test.ts\n\n# Run with coverage\npnpm test:coverage\n\n# Run in watch mode during development\npnpm test:ui\n```\n\n## Conclusion\n\nThis testing plan provides comprehensive coverage for all major user journeys in the application. The focus is on server actions and business logic, with component testing as a lower priority. Following existing patterns and infrastructure will ensure consistency and maintainability.\n","created_at":"2026-01-05T13:44:40Z"},{"id":6,"issue_id":"northstar-gde","author":"caiodgallo","text":"# Test Coverage Mapping\n\n## Current State\n\n### ✅ Well-Tested\n\n| Feature | Test File | Lines | Coverage |\n|---------|-----------|-------|----------|\n| Expenses | `/test/lib/actions/expenses.test.ts` | 572 | Comprehensive |\n| Income | `/test/lib/actions/income.test.ts` | 467 | Comprehensive |\n\n### ❌ No Test Coverage\n\n| Feature | Server Action | Status |\n|---------|--------------|--------|\n| Dashboard | `/lib/actions/dashboard.ts` | No tests |\n| Faturas | `/lib/actions/faturas.ts` | No dedicated tests (partial in expenses) |\n| Accounts | `/lib/actions/accounts.ts` | No tests |\n| Categories | `/lib/actions/categories.ts` | No tests |\n| Budgets | `/lib/actions/budgets.ts` | No tests |\n\n## Planned Tests\n\n### Epic: Tests (northstar-gde)\n\n#### P1 Tasks (Critical)\n\n| ID | Task | File | Est. Time |\n|----|------|------|-----------|\n| northstar-797 | Dashboard - getDashboardData | `/test/lib/actions/dashboard.test.ts` | 3-4h |\n| northstar-wvj | Faturas - CRUD \u0026 Payment | `/test/lib/actions/faturas.test.ts` | 2-3h |\n\n#### P2 Tasks (Important)\n\n| ID | Task | File | Est. Time |\n|----|------|------|-----------|\n| northstar-aos | Accounts - CRUD | `/test/lib/actions/accounts.test.ts` | 1-2h |\n| northstar-v0d | Categories - CRUD | `/test/lib/actions/categories.test.ts` | 1-2h |\n| northstar-th0 | Budgets - CRUD \u0026 Calculations | `/test/lib/actions/budgets.test.ts` | 2-3h |\n| northstar-8qt | Faturas - Billing Cycle Logic | `/test/lib/fatura-utils.test.ts` | 2-3h |\n| northstar-0qa | Dashboard - Components | `/test/components/dashboard.test.ts` | 3-4h |\n\n## Server Actions to Test\n\n### Dashboard (`/lib/actions/dashboard.ts`)\n- ✗ getDashboardData(yearMonth)\n\n### Faturas (`/lib/actions/faturas.ts`)\n- ✗ ensureFaturaExists(accountId, yearMonth)\n- ✗ updateFaturaTotal(accountId, yearMonth)\n- ✗ getFaturasByMonth(yearMonth)\n- ✗ getFaturasByAccount(accountId)\n- ✗ getFaturaWithEntries(faturaId)\n- ✗ payFatura(faturaId, fromAccountId)\n- ✗ markFaturaUnpaid(faturaId)\n\n### Accounts (`/lib/actions/accounts.ts`)\n- ✗ getAccounts()\n- ✗ createAccount(data)\n- ✗ updateAccount(id, data)\n- ✗ deleteAccount(id)\n\n### Categories (`/lib/actions/categories.ts`)\n- ✗ getCategories(type?)\n- ✗ createCategory(data)\n- ✗ updateCategory(id, data)\n- ✗ deleteCategory(id)\n\n### Budgets (`/lib/actions/budgets.ts`)\n- ✗ getBudgetsForMonth(yearMonth)\n- ✗ upsertBudget(categoryId, yearMonth, amount)\n- ✗ getMonthlyBudget(yearMonth)\n- ✗ upsertMonthlyBudget(yearMonth, amount)\n- ✗ getBudgetsWithSpending(yearMonth)\n- ✗ copyBudgetsFromMonth(sourceMonth, targetMonth)\n\n## Utility Functions to Test\n\n### Fatura Utils (`/lib/fatura-utils.ts`)\n- ✗ getFaturaMonth(purchaseDate, closingDay)\n- ✗ getFaturaPaymentDueDate(faturaMonth, paymentDueDay, closingDay)\n- ✗ formatFaturaMonthWithLocale(yearMonth, locale)\n\n## Components to Test\n\n### Dashboard Components\n- ✗ `/components/balance-summary.tsx`\n- ✗ `/components/summary-card.tsx`\n- ✗ `/components/budget-progress.tsx`\n- ✗ `/components/recent-expenses.tsx`\n- ✗ `/components/month-picker.tsx`\n- ✗ `/app/(app)/dashboard/page.tsx`\n- ✗ `/app/(app)/dashboard/loading.tsx`\n\n## Key Test Areas by Feature\n\n### Dashboard\n- Data aggregation (totalSpent, totalBudget, totalIncome, netBalance)\n- Spending calculation by purchaseDate (not dueDate)\n- Category breakdown aggregation\n- Recent lists ordering\n- Month boundary handling\n- Installment expense filtering\n\n### Faturas\n- Auto-creation on expense creation\n- Billing cycle logic (closing day, payment due day)\n- Payment flow (pay/unpay)\n- Total calculation and updates\n- Fatura-entry relationships\n- Cascade deletion\n\n### Accounts\n- CRUD operations for all account types\n- Billing config validation\n- Referential integrity (cannot delete if used)\n- User isolation\n\n### Categories\n- CRUD operations\n- Icon validation (38 predefined)\n- Color validation\n- Referential integrity (cannot delete if used)\n- Cascade delete (budgets)\n\n### Budgets\n- CRUD operations (per-category and monthly)\n- Spending calculation by purchaseDate\n- getBudgetsWithSpending aggregation\n- Copy budgets from previous month\n- Zero budgets and missing budgets\n- User isolation\n\n## Common Test Patterns\n\n### All Features\n- Happy paths (normal operations)\n- Edge cases (zero values, boundaries, missing data)\n- Error handling (invalid inputs, constraint violations)\n- User isolation (no data leakage)\n- Referential integrity (foreign key constraints)\n- Cache invalidation (revalidatePath/revalidateTag)\n- Money handling (cents to display conversion)\n- Date handling (timezone-safe)\n\n### Complex Features\n- **Dashboard**: Aggregation, filtering, ordering\n- **Faturas**: Billing cycle calculations, installments\n- **Budgets**: Spending calculation, multi-month data\n\n## Progress Tracking\n\n### Total Progress: 2/8 (25%)\n\n- ✅ Expenses (existing)\n- ✅ Income (existing)\n- ⏳ Dashboard (planned - P1)\n- ⏳ Faturas (planned - P1)\n- ⏳ Accounts (planned - P2)\n- ⏳ Categories (planned - P2)\n- ⏳ Budgets (planned - P2)\n- ⏳ Billing Cycle (planned - P2)\n\n### Estimated Remaining Time: 14-21 hours\n- P1 Tasks: 5-7 hours\n- P2 Tasks: 9-14 hours\n","created_at":"2026-01-05T13:45:09Z"},{"id":7,"issue_id":"northstar-gde","author":"caiodgallo","text":"# Test Dependencies Graph\n\n## Dependency Structure\n\n### Level 1 - No Dependencies (Start Here)\n```\n┌─────────────────────────────┐\n│ Accounts (P2)            │ northstar-aos\n│ - Foundational data        │\n│ - No dependencies         │\n└─────────────────────────────┘\n\n┌─────────────────────────────┐\n│ Categories (P2)           │ northstar-v0d\n│ - Foundational data        │\n│ - No dependencies         │\n└─────────────────────────────┘\n\n┌─────────────────────────────┐\n│ Faturas Billing (P2)      │ northstar-8qt\n│ - Pure functions          │\n│ - No database deps       │\n│ - Independent            │\n└─────────────────────────────┘\n```\n\n### Level 2 - Depends on Level 1\n```\nBudgets (P2) ───────────────→ Categories (P2)\nnorthstar-th0                   northstar-v0d\n- Spending calculations\n- Per-category budgets\n\nFaturas CRUD (P1) ───────────→ Accounts (P2)\nnorthstar-wvj                    northstar-aos\n- Payment flows\n- Fatura-entry relationships\n```\n\n### Level 3 - Depends on Level 2\n```\nDashboard Server (P1) ──────→ Budgets (P2)\nnorthstar-797                   northstar-th0\n- Data aggregation\n- Complex calculations\n```\n\n### Level 4 - Depends on Level 3\n```\nDashboard Components (P2) ──→ Dashboard Server (P1)\nnorthstar-0qa                     northstar-797\n- UI testing\n- Component behavior\n```\n\n## Execution Order\n\n### Phase 1 - Foundation (Can start immediately)\n1. **Accounts** - Test CRUD operations (1-2h)\n2. **Categories** - Test CRUD operations (1-2h)\n3. **Faturas Billing Cycle** - Test utility functions (2-3h)\n\n### Phase 2 - Intermediate (After Phase 1)\n4. **Budgets** - Test CRUD \u0026 calculations (2-3h) [needs Categories]\n5. **Faturas CRUD** - Test payment flows (2-3h) [needs Accounts]\n\n### Phase 3 - User-Facing (After Phase 2)\n6. **Dashboard Server** - Test getDashboardData (3-4h) [needs Budgets]\n\n### Phase 4 - UI (After Phase 3)\n7. **Dashboard Components** - Test components (3-4h) [needs Dashboard Server]\n\n## Dependency Rationale\n\n### Why Accounts first?\n- Expenses, Income, Faturas all require accounts\n- Foreign key: entries.accountId, income.accountId, faturas.accountId\n- Testing accounts ensures fixtures are solid\n- Accounts are referenced by almost everything\n\n### Why Categories second?\n- Expenses, Income, Budgets all require categories\n- Foreign key: transactions.categoryId, income.categoryId, budgets.categoryId\n- Categories cascade delete to budgets (critical relationship)\n- Needed for budget calculations\n\n### Why Budgets before Dashboard?\n- Dashboard uses budget data from `getBudgetsWithSpending()`\n- Dashboard shows budget progress and summaries\n- Budgets are core to dashboard display\n- No sense testing dashboard without budget tests\n\n### Why Faturas CRUD after Accounts?\n- Faturas are tied to accounts (faturas.accountId FK)\n- Faturas cascade delete when account deleted\n- Need account fixtures for testing fatura creation\n- Credit card billing config is on accounts\n\n### Why Dashboard Server before Components?\n- Components depend on server action data\n- Server action is the source of truth\n- Component tests mock the server action\n- Should test data source before presentation layer\n\n### Why Faturas Billing Cycle is independent?\n- Pure utility functions (getFaturaMonth, getFaturaPaymentDueDate)\n- No database dependencies\n- Can test in parallel with foundation\n- Self-contained logic\n\n## Parallel Execution Opportunities\n\n### Can work in parallel (Phase 1):\n- **Accounts** + **Categories** + **Faturas Billing Cycle**\n  - No dependencies between them\n  - Different areas of codebase\n  - 3 different developers can work simultaneously\n  - Total time: max(1-2h, 1-2h, 2-3h) = ~3h\n\n### Can work in parallel (Phase 2):\n- **Budgets** + **Faturas CRUD**\n  - Budgets needs Categories (done in Phase 1)\n  - Faturas needs Accounts (done in Phase 1)\n  - Both available after Phase 1\n  - Total time: max(2-3h, 2-3h) = ~3h\n\n### Sequential (Phase 3+):\n- **Dashboard Server** → **Dashboard Components**\n  - Hard dependency chain\n  - Must complete in sequence\n\n## Critical Path\n\n**Longest path through dependencies:**\n\n1. Categories (2h)\n2. Budgets (3h) [depends on Categories]\n3. Dashboard Server (4h) [depends on Budgets]\n4. Dashboard Components (4h) [depends on Dashboard Server]\n\n**Total critical path: 13 hours**\n\n## Parallel Execution Strategy\n\n### Ideal Team Size: 3 developers\n\n**Developer 1:**\n1. Categories (2h) → Budgets (3h) → Dashboard Server (4h)\n   Total: 9h\n\n**Developer 2:**\n1. Accounts (2h) → Faturas CRUD (3h)\n   Total: 5h\n\n**Developer 3:**\n1. Faturas Billing Cycle (3h)\n   Total: 3h\n\n**Total calendar time: 9 hours** (vs 21 hours sequential)\n\n### Minimal Team Size: 1 developer\n\n**Sequential execution:**\n1. Accounts (2h)\n2. Categories (2h)\n3. Faturas Billing Cycle (3h)\n4. Budgets (3h) [after Categories]\n5. Faturas CRUD (3h) [after Accounts]\n6. Dashboard Server (4h) [after Budgets]\n7. Dashboard Components (4h) [after Dashboard Server]\n\n**Total: 21 hours** (3 days)\n\n## Dependency Commands\n\n```bash\n# View full dependency tree\nbd dep tree northstar-797\n\n# List dependencies of an issue\nbd dep list northstar-797\n\n# List dependents of an issue\nbd dep list --reverse northstar-v0d\n\n# Check for cycles\nbd dep cycles\n\n# Add a dependency\nbd dep add \u003cissue\u003e \u003cdepends-on\u003e\n\n# Remove a dependency\nbd dep remove \u003cissue\u003e \u003cdepends-on\u003e\n```\n\n## Current Status\n\n### Ready (No blockers) - 4 tasks\n1. Accounts (northstar-aos)\n2. Categories (northstar-v0d)\n3. Faturas Billing Cycle (northstar-8qt)\n4. Epic (northstar-gde)\n\n### Blocked (Waiting) - 4 tasks\n1. Budgets (northstar-th0) - blocked by Categories\n2. Faturas CRUD (northstar-wvj) - blocked by Accounts\n3. Dashboard Server (northstar-797) - blocked by Budgets\n4. Dashboard Components (northstar-0qa) - blocked by Dashboard Server\n","created_at":"2026-01-05T13:47:43Z"}]}
{"id":"northstar-gdv","title":"Add balance reconciliation job","description":"Implement a scheduled reconciliation that recomputes account currentBalance from entries/income/transfers (and a manual trigger).","notes":"Plan:\n1) Review balance helpers and find best entry points for reconciliation (cron + manual).\n2) Add reconciliation actions (per-user + all users), cron route, and manual trigger UI/action with revalidation.\n3) Add tests/coverage and update translations; run lint/build.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T13:02:46.643228-03:00","created_by":"caiodgallo","updated_at":"2026-01-08T13:41:41.62348-03:00","closed_at":"2026-01-08T13:41:41.62348-03:00","close_reason":"Closed"}
{"id":"northstar-hfw","title":"Improve UI/UI of Calendar page filters","description":"Right now there are 3 dropdowns for filtering in the calendar page. They occupy a lot space and are not the best experience on mobile. Let's come um with a better version of it. \n\nFor the type filtering between 'task' and 'event' we can have a toggle with icon, toggling between a calendar icon and a checkmark icon which will toggle between events and tasks, these are the only two types that will exist.\n\nFor the status filters, I only care about pending, in progress and finished. These must be represented as icon toggles also, in the same row as the type but separated by some ui element, and these can be stacked with the type filter.\n\nFor the priority filter, let's think about a new UI/UX following the lines and idea of the two we just describe.\n\nThink about this carefully, take your time.\n","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-07T15:11:25.612865-03:00","created_by":"caiodgallo","updated_at":"2026-01-07T15:33:46.402294-03:00","closed_at":"2026-01-07T15:33:46.402294-03:00","close_reason":"Closed"}
{"id":"northstar-htn","title":"Enhance transactionDetail namespace in en.json and pt-BR.json","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:03.853235-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T07:21:34.107512-03:00","closed_at":"2026-01-05T07:21:34.107512-03:00","close_reason":"Closed"}
{"id":"northstar-i4x","title":"Implement recurrence expansion for tasks view","description":"Recurrence rules are stored for tasks but tasks page only renders base tasks. Expand recurrence rules into schedule events similar to calendar events.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T08:35:08.174416-03:00","created_by":"caiodgallo","updated_at":"2026-01-08T08:48:38.276221-03:00","closed_at":"2026-01-08T08:48:38.276221-03:00","close_reason":"Closed"}
{"id":"northstar-ic4","title":"Phase 3: Translate budgets.ts server action errors","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:28.344299-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T09:40:30.446953-03:00","closed_at":"2026-01-05T09:40:30.446953-03:00","close_reason":"Closed"}
{"id":"northstar-jo8","title":"Fix smoke tests stuck on account creation","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T07:19:08.249495-03:00","created_by":"caiodgallo","updated_at":"2026-01-13T07:37:05.172682-03:00","closed_at":"2026-01-13T07:37:05.172682-03:00","close_reason":"Closed"}
{"id":"northstar-joq","title":"Strengthen ExtendedCalendarEvent status type from string to union","description":"ExtendedCalendarEvent.status is typed as bare 'string' but should be specific union.\n\nLocation: components/calendar/calendar-helpers.ts:13\n\nCurrent: status?: string\nIssue: Allows any string including invalid values\n\nFix: status?: 'active' | 'paused' | 'completed' | 'done' | 'todo' | 'in_progress' | 'confirmed' | 'tentative' | 'cancelled'\n\nBased on: getStatusConfig() usage shows these are the valid values\n\nFound by: type-design-analyzer agent\nConfidence: HIGH\nType Rating: Invariant Expression 3/5 (would be 5/5 with this fix)","status":"closed","priority":1,"issue_type":"task","owner":"caiogallo88@gmail.com","created_at":"2026-01-14T15:45:45.210321-03:00","created_by":"Caio Gallo","updated_at":"2026-01-14T16:28:41.859928-03:00","closed_at":"2026-01-14T16:28:41.859928-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-joq","depends_on_id":"northstar-dal","type":"blocks","created_at":"2026-01-14T15:47:15.363835-03:00","created_by":"Caio Gallo"}]}
{"id":"northstar-jyk","title":"Bypass rate limiting in test env","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-13T11:03:30.978114-03:00","created_by":"caiodgallo","updated_at":"2026-01-14T05:54:00.832957-03:00","closed_at":"2026-01-14T05:54:00.832957-03:00","close_reason":"Closed"}
{"id":"northstar-kgb","title":"Phase 2: Translate offline page (/app/offline/page.tsx)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:16.757745-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T09:37:15.333139-03:00","closed_at":"2026-01-05T09:37:15.333139-03:00","close_reason":"Closed"}
{"id":"northstar-kzm","title":"Calendar click-to-edit does not open event/task dialogs","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-07T10:03:33.126361-03:00","created_by":"caiodgallo","updated_at":"2026-01-07T10:04:58.0536-03:00","closed_at":"2026-01-07T10:04:58.0536-03:00","close_reason":"Closed"}
{"id":"northstar-lo2","title":"Fix tidy test failures","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T13:15:12.082007-03:00","created_by":"caiodgallo","updated_at":"2026-01-12T13:35:19.187954-03:00","closed_at":"2026-01-12T13:35:19.187954-03:00","close_reason":"Closed"}
{"id":"northstar-lsh","title":"Phase 3: Translate expenses.ts server action errors","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:28.936228-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T09:42:59.933931-03:00","closed_at":"2026-01-05T09:42:59.933931-03:00","close_reason":"Closed"}
{"id":"northstar-mii8","title":"Bundle related category fields in BillReminderDetailSheetProps","description":"categoryName and categoryColor are separate optional fields but should be bundled.\n\nLocation: components/calendar/bill-reminder-detail-sheet.tsx:30-31\n\nCurrent:\n- categoryName?: string | null\n- categoryColor?: string | null\n\nIssue: No enforcement that both are present or both absent. Redundant nullability.\n\nFix:\n- category?: { name: string; color: string }\n\nBenefits:\n- Enforces coordination\n- Cleaner API\n- Single optional check\n\nFound by: type-design-analyzer agent\nConfidence: MEDIUM","status":"open","priority":3,"issue_type":"task","owner":"caiogallo88@gmail.com","created_at":"2026-01-14T15:45:50.102794-03:00","created_by":"Caio Gallo","updated_at":"2026-01-14T15:45:50.102794-03:00","dependencies":[{"issue_id":"northstar-mii8","depends_on_id":"northstar-dal","type":"blocks","created_at":"2026-01-14T15:47:16.468331-03:00","created_by":"Caio Gallo"}]}
{"id":"northstar-mlr","title":"Test natural language parser token extraction and partial matching","description":"Current coverage: 33% statements, 24% branches. The parseInputWithTokens function (lines 223-373) and findPartialMatches (85-113) are largely untested. This parser powers the smart task/event creation UX - our key differentiator. Untested scenarios: prefix extraction ('event: dentist tomorrow'), partial date matching ('tom' → 'tomorrow'), combined patterns ('p1 tomorrow for 30m'), token position accuracy. Real risk: silent parsing failures lead to wrong dates, lost priorities, or corrupted task data. Users expect Todoist-level intelligence; bugs here break that trust.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T16:27:46.693852-03:00","created_by":"caiodgallo","updated_at":"2026-01-12T17:29:28.567935-03:00","closed_at":"2026-01-12T17:29:28.567935-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-mlr","depends_on_id":"northstar-b91","type":"blocks","created_at":"2026-01-12T16:31:21.039107-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-moi","title":"Credit-card refunds/credits should reduce fatura totals during import","description":"Import parsers classify negative amounts as income, so statement credits (refunds/chargebacks) do not reduce fatura totals. Consider recording negative entries for credit-card statements or a dedicated credit entry flow so fatura totals match bank statements.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-14T06:01:51.493914-03:00","created_by":"caiodgallo","updated_at":"2026-01-14T06:11:39.142362-03:00","closed_at":"2026-01-14T06:11:39.142362-03:00","close_reason":"Closed"}
{"id":"northstar-mqn","title":"Tests Epic: Coverage \u0026 Reliability for Core Journeys","description":"Goal\n- Build a safety net for core finance + calendar workflows so new features ship safely and regressions are caught early.\n\nHow To Proceed (recommended order)\n1) Close P1 integration gaps (transfers + auth). These touch balances, access, and cashflow.\n2) Add settings/calendar source tests + background jobs to stabilize app-wide behavior.\n3) Add API route tests and UI form tests to cover edge cases at the boundary.\n4) Add Playwright smoke suite last (once fixtures and API coverage are stable).\n\nIn-Scope Journeys\n1) Auth \u0026 access: login/forgot/reset/logout → app access → redirect.\n2) Onboarding: create accounts + categories + preferences/timezone.\n3) Money tracking: create expense (installments) → entries + fatura → mark paid/pending → update/delete.\n4) Income: create income → mark received → balances update.\n5) Transfers: internal transfer, deposit/withdrawal, fatura payment → balances update.\n6) Budgets: set monthly + category budgets → dashboard/budget progress.\n7) Dashboard: totals, cashflow, recent activity, budget vs actual.\n8) Calendar/tasks: create/edit, recurrence, notifications, calendar sources sync, daily digest.\n9) Imports: CSV import → idempotency + category mapping + balance sync.\n\nOut of Scope (for this epic)\n- Cosmetic UI snapshot tests.\n- One-off visual quirks or micro-interactions.\n- Non-critical admin/dev tooling.\n\nTesting Layers (definition)\n- Unit: pure utils (money/date/recurrence/parser) with targeted edge cases.\n- Integration (Vitest + PGlite): server actions by domain; assert DB mutations, invariants (balances, idempotency), and cache revalidation.\n- Component (RTL): core finance forms + validation + key conditional rendering.\n- E2E (Playwright): 3–5 smoke flows only.\n\nConventions / Helpers\n- Use `setupTestDb`, `clearAllTables`, `mockAuth()` for server actions.\n- Mock `next/cache` and assert revalidatePath/revalidateTag when relevant.\n- Freeze time for jobs/recurrence tests (fake timers + explicit timezone).\n- Prefer fixtures in `test/fixtures.ts` (or new builders) to avoid duplication.\n\nDefinition of Done (Epic)\n- All child issues closed with tests passing locally.\n- Critical flows have at least integration + component coverage.\n- E2E smoke suite runs with stable seed data.\n\nChildren\n- northstar-mqn.1: Transfers integration tests\n- northstar-mqn.2: Auth actions tests\n- northstar-mqn.3: User settings + calendar sources tests\n- northstar-mqn.4: Background jobs tests\n- northstar-mqn.5: API route tests\n- northstar-mqn.6: Component tests for finance forms\n- northstar-mqn.7: Playwright smoke tests\n- northstar-mqn.8: Test utilities + coverage baseline\n","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-12T12:29:39.705888-03:00","created_by":"caiodgallo","updated_at":"2026-01-14T11:27:44.601646-03:00","closed_at":"2026-01-14T11:27:44.601646-03:00","close_reason":"Closed"}
{"id":"northstar-mqn.1","title":"Add integration tests for transfers actions","description":"Objective\n- Provide full integration coverage for transfers so balance/cashflow regressions are caught.\n\nFiles\n- New: `test/lib/actions/transfers.test.ts`\n- Fixtures: extend `test/fixtures.ts` with transfer + fatura builders if needed.\n\nTest Cases\nCreate Transfer (`createTransfer`)\n- Rejects invalid amount (\u003c=0 or non-integer) → throws translated error.\n- Rejects invalid date format (not YYYY-MM-DD).\n- Internal transfer/fatura_payment: requires both accounts and they must be different.\n- Deposit: requires `toAccountId`, must not allow `fromAccountId`.\n- Withdrawal: requires `fromAccountId`, must not allow `toAccountId`.\n- Ownership: if account(s) do not belong to current user → error.\n- Success: inserts row with trimmed description; syncAccountBalance called for affected accounts; revalidatePath called for `/transfers`, `/dashboard`, `/settings/accounts`.\n\nUpdate Transfer (`updateTransfer`)\n- Invalid transferId → error.\n- Not found for user → error.\n- Existing transfer with `faturaId` cannot be updated → error.\n- Same validation matrix as create (amount/date/type-specific accounts/ownership).\n- Success: updates row; syncAccountBalance invoked for any old + new accounts; revalidation paths called.\n\nDelete Transfer (`deleteTransfer`)\n- Invalid transferId → error.\n- Not found for user → error.\n- Existing transfer with `faturaId` cannot be deleted → error.\n- Success: deletes row; syncAccountBalance called for affected accounts; revalidation paths called.\n\nAcceptance Criteria\n- New test file passes with PGlite DB and `mockAuth()`.\n- All validations above are asserted (error messages or thrown errors).\n- Revalidation calls asserted via mocked `next/cache`.\n- Balance sync behavior verified via `vi.spyOn` on `syncAccountBalance`.\n\nImplementation Notes\n- Use `setupTestDb` and seed 2 accounts for internal transfers.\n- Consider a third account for ownership mismatch scenarios.\n- Reset modules after mocking `@/lib/db` + `@/lib/auth`.\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T12:30:17.567981-03:00","created_by":"caiodgallo","updated_at":"2026-01-12T13:34:08.43036-03:00","closed_at":"2026-01-12T13:34:08.43036-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-mqn.1","depends_on_id":"northstar-mqn","type":"parent-child","created_at":"2026-01-12T12:30:17.569032-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-mqn.2","title":"Add tests for auth actions and rate limits","description":"Objective\n- Ensure auth actions behave correctly under rate-limit, Supabase errors, and validation rules.\n\nFiles\n- New: `test/lib/actions/auth.test.ts`\n\nTest Cases\nLogin (`login`)\n- Rate limit denied → returns translated error with retryAfter text.\n- Supabase signIn error → returns authenticationFailed error.\n- Success → returns `{ error: null }`.\n\nForgot Password (`forgotPassword`)\n- Rate limit denied → returns translated error.\n- Supabase reset error → still returns `{ error: null }` (email enumeration safety).\n- Success → returns `{ error: null }`.\n\nUpdate Password (`updatePassword`)\n- Not authenticated → returns `notAuthenticated`.\n- Password \u003c 8 chars → `passwordTooShort`.\n- Missing letters or numbers → `passwordRequirementsNotMet`.\n- Supabase update error → `unexpectedError`.\n- Success → `{ error: null }`.\n\nLogout (`logout`)\n- Calls `supabase.auth.signOut()` and `redirect('/login')`.\n\nAcceptance Criteria\n- Supabase client mocked (createClient) with auth stubs for signIn/reset/update/signOut/getUser.\n- Rate-limit helpers mocked for both login and forgot-password.\n- All branches above asserted with clear expectations.\n\nImplementation Notes\n- Mock `next/navigation` redirect to capture calls.\n- Use `vi.resetModules()` between tests to ensure mocks apply before dynamic imports.\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T12:30:39.468686-03:00","created_by":"caiodgallo","updated_at":"2026-01-12T22:03:42.651759-03:00","closed_at":"2026-01-12T22:03:42.651759-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-mqn.2","depends_on_id":"northstar-mqn","type":"parent-child","created_at":"2026-01-12T12:30:39.469569-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-mqn.3","title":"Add tests for user settings and calendar sources actions","description":"Objective\n- Validate settings + calendar source CRUD and input validation.\n\nFiles\n- New: `test/lib/actions/user-settings.test.ts`\n- New: `test/lib/actions/calendar-sources.test.ts`\n\nUser Settings Test Cases (`lib/actions/user-settings.ts`)\n- `getUserSettings` returns existing settings for user.\n- `getOrCreateUserSettings` creates when missing; returns existing when present.\n- `updateUserSettings`:\n  - invalid timezone → `invalidTimezone`.\n  - invalid notificationEmail → `invalidEmail`.\n  - offset minutes \u003c0 or \u003e10080 → `invalidOffsetMinutes`.\n  - success updates DB + revalidates `/settings` and `/calendar`.\n\nCalendar Sources Test Cases (`lib/actions/calendar-sources.ts`)\n- `createCalendarSource`:\n  - invalid URL → `invalidUrl` error.\n  - success returns new id + revalidate path/tag.\n  - duplicate URL for same user → error from handleDbError.\n- `updateCalendarSource`:\n  - non-existent source → `notFound`.\n  - invalid URL → `invalidUrl`.\n  - success updates row + revalidates path/tag.\n- `deleteCalendarSource`:\n  - success deletes and revalidates `/settings/calendars`, `/calendar`, tag `calendar-sources` and `events`.\n  - verify FK cascade: events linked to calendarSourceId are removed.\n\nAcceptance Criteria\n- All cases above covered with PGlite DB.\n- Revalidation assertions via mocked `next/cache`.\n- Ownership enforced using `mockAuth()`.\n\nImplementation Notes\n- Seed two users to validate ownership scoping.\n- Use fixtures in `test/fixtures.ts` for sources/events.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T12:30:59.713763-03:00","created_by":"caiodgallo","updated_at":"2026-01-12T13:34:25.964694-03:00","closed_at":"2026-01-12T13:34:25.964694-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-mqn.3","depends_on_id":"northstar-mqn","type":"parent-child","created_at":"2026-01-12T12:30:59.714724-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-mqn.4","title":"Add tests for background jobs (notification jobs, daily digest, status updates)","description":"Objective\n- Cover background jobs that mutate state or send notifications so cron regressions are caught.\n\nFiles\n- New: `test/lib/actions/notification-jobs.test.ts`\n- New: `test/lib/actions/daily-digest.test.ts`\n- New: `test/lib/actions/status-updates.test.ts`\n\nNotification Jobs (`processPendingNotificationJobs`)\n- Cancels job if item missing.\n- Cancels job if event status != scheduled.\n- Cancels job if task status not in pending/in_progress/overdue.\n- Successful send → job status `sent`, processed++.\n- Failed send with attempts \u003c 3 → attempts++ and status stays pending.\n- Failed send with attempts \u003e= 3 → status `failed` + lastError.\n\nDaily Digest (`sendAllDailyDigests`)\n- Skips users without notificationEmail (does not count as processed).\n- No items for today → considered success, no email sent.\n- Items in user’s local day are included (timezone boundary test).\n- Recurring event/task occurs today → included in digest.\n- sendEmail failures trigger retry path (use fake timers to avoid real waits).\n- Aggregated result counts (usersProcessed/emailsSent/emailsFailed) are correct.\n\nStatus Updates (`updatePastItemStatuses`)\n- Events with endAt \u003c now and status scheduled → status completed.\n- Tasks with dueAt \u003c now and status pending/in_progress → status overdue.\n- Non-eligible items remain unchanged.\n\nAcceptance Criteria\n- Time-dependent tests use fake timers + explicit system time.\n- Email sender mocked (`lib/email/send.ts`).\n- All branches above asserted with DB state checks.\n\nImplementation Notes\n- Seed userSettings with notificationsEnabled + notificationEmail for digest tests.\n- Use UTC + a non-UTC timezone (e.g., America/Sao_Paulo) to validate date boundaries.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T12:31:21.547197-03:00","created_by":"caiodgallo","updated_at":"2026-01-12T13:34:44.210052-03:00","closed_at":"2026-01-12T13:34:44.210052-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-mqn.4","depends_on_id":"northstar-mqn","type":"parent-child","created_at":"2026-01-12T12:31:21.548448-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-mqn.5","title":"Add API route tests for cron and calendar sync","description":"Objective\n- Add API route coverage for cron + calendar sync endpoints to lock down behavior and error handling.\n\nFiles\n- New: `test/app/api/cron/daily.route.test.ts`\n- New: `test/app/api/calendar-sync.route.test.ts`\n- New: `test/app/api/calendar-sync-test.route.test.ts`\n\nCron Daily (`app/api/cron/daily/route.ts`)\n- Unauthorized when Authorization header does not match `CRON_SECRET`.\n- `job` query param:\n  - `notifications` runs only notification jobs.\n  - `status-updates` runs only status updates.\n  - `calendar-sync` runs only calendar sync.\n  - `balance-reconciliation` runs only balance reconciliation.\n  - `daily-digest` runs only digest.\n  - `all` runs all jobs.\n- Success response includes expected shape with each job result.\n- Any job throws → response 500.\n\nCalendar Sync (`app/api/calendar-sync/route.ts`)\n- Calls `getCurrentUserId` guard (mocked).\n- With `calendarSourceId` in body → calls `syncCalendarSource` and returns its result.\n- Without id → calls `syncAllCalendars` and returns summary counts.\n- Errors thrown → 500 response.\n\nCalendar Sync Test (`app/api/calendar-sync/test/route.ts`)\n- Missing `url` → 400 with error.\n- fetchICalUrl failure → success false with error.\n- parseICalendar throws → success false with parse error.\n- Success → returns calendarName + eventCount.\n\nAcceptance Criteria\n- Mock action functions + auth; assert they are called (or not) based on params.\n- Use Request objects with explicit headers/body/query params.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T12:31:44.244376-03:00","created_by":"caiodgallo","updated_at":"2026-01-12T13:35:01.413367-03:00","closed_at":"2026-01-12T13:35:01.413367-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-mqn.5","depends_on_id":"northstar-mqn","type":"parent-child","created_at":"2026-01-12T12:31:44.24535-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-mqn.6","title":"Add component tests for core finance forms","description":"Objective\n- Add component-level coverage for core finance forms and validation UI.\n\nFiles\n- New: `test/components/transaction-form.test.tsx`\n- New: `test/components/transfer-form.test.tsx`\n- New: `test/components/budget-form.test.tsx`\n\nTransaction Form (`components/transaction-form.tsx`)\nExpense mode\n- Renders expense labels + installments slider.\n- Shows per-installment text when installments \u003e 1.\n- Submit disabled when no accounts or no categories.\n- Create path calls `createExpense` with cents + selected ids.\n- Edit path calls `updateExpense` with transaction id.\nIncome mode\n- Does not render installments slider.\n- Create path calls `createIncome`; edit calls `updateIncome`.\n\nTransfer Form (`components/transfer-form.tsx`)\n- Type change toggles from/to account fields (deposit hides from, withdrawal hides to).\n- Internal transfer with same account shows error and does not submit.\n- Amount \u003c= 0 keeps submit disabled.\n- Create path calls `createTransfer`; edit path calls `updateTransfer`.\n- Form resets on successful create.\n\nBudget Form (`components/budget-form.tsx`)\n- Monthly budget blur calls `upsertMonthlyBudget` (success clears error; failure shows error).\n- Category budget blur calls `upsertBudget` (success clears error; failure shows error).\n- Remaining/over-budget text + progress bar reflect allocations.\n\nAcceptance Criteria\n- `next-intl` mocked to stable strings (similar to existing dashboard tests).\n- Actions mocked; assertions on calls with expected payloads.\n- No snapshots; rely on visible text + form state assertions.\n\nImplementation Notes\n- Use RTL user-event for inputs/slider; ensure `AlertDialog` is opened in tests.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T12:32:06.338398-03:00","created_by":"caiodgallo","updated_at":"2026-01-12T14:22:30.761458-03:00","closed_at":"2026-01-12T14:22:30.761458-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-mqn.6","depends_on_id":"northstar-mqn","type":"parent-child","created_at":"2026-01-12T12:32:06.339469-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-mqn.7","title":"Introduce Playwright E2E smoke tests for critical journeys","description":"Objective\n- Establish a minimal Playwright smoke suite covering the highest-value user flows end-to-end.\n\nSetup Tasks\n- Add Playwright config and `pnpm test:e2e` script.\n- Decide auth strategy:\n  - Preferred: local Supabase + seed test user.\n  - Alternative: test-only auth bypass via env flag if local auth is too heavy.\n- Seed data helper (accounts/categories) to keep flows deterministic.\n\nSmoke Flows\n1) Login → Dashboard\n- Sign in with seeded user; confirm redirect to `/dashboard` and summary cards visible.\n\n2) Create Account + Category → Create Expense\n- Add account + expense category.\n- Create expense with 3 installments.\n- Verify expense list shows 3 entries and dashboard reflects total spent.\n\n3) Create Income → Dashboard Net Balance\n- Add income category.\n- Create income record.\n- Verify dashboard net balance updates and recent income appears.\n\n4) Transfer (deposit/withdrawal/internal)\n- Create a deposit or internal transfer.\n- Verify transfers list reflects new record; dashboard cashflow updates.\n\nAcceptance Criteria\n- Playwright tests run headless locally and finish in \u003c2–3 minutes.\n- Tests are deterministic (no network calls, no shared state across runs).\n- Clear setup/teardown or database reset between tests.\n\nImplementation Notes\n- Use stable selectors (data-testid) only where necessary.\n- Keep assertions on high-signal UI text and counts (avoid brittle layout checks).\n","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T12:32:27.85227-03:00","created_by":"caiodgallo","updated_at":"2026-01-12T22:04:03.507755-03:00","closed_at":"2026-01-12T22:04:03.507755-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-mqn.7","depends_on_id":"northstar-mqn","type":"parent-child","created_at":"2026-01-12T12:32:27.853418-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-mqn.8","title":"Improve test utilities: time control, factories, coverage baseline","description":"Objective\n- Add shared helpers and fixtures so future tests are easier to write and less flaky.\n\nFiles\n- New: `test/time-utils.ts` (freeze/advance/reset time helpers).\n- Update: `test/fixtures.ts` with builders for transfers, faturas, monthly budgets.\n- Optional: `test/helpers/factories.ts` to centralize `build*` helpers.\n\nTasks\n- Add `freezeTime(date: string | Date)` + `resetTime()` helpers wrapping `vi.useFakeTimers()`.\n- Add `withTimezone(tz)` helper for tests that need explicit timezone handling.\n- Expand fixtures:\n  - `createTestTransfer` (internal/deposit/withdrawal variants).\n  - `createTestFatura` (accountId, yearMonth, dueDate, total).\n  - `createTestMonthlyBudget`.\n- Add coverage baseline documentation (e.g., `docs/test-coverage.md`) summarizing current gaps and target areas.\n\nAcceptance Criteria\n- Helpers are used by at least one new test in other issues.\n- No production code changes required for helpers.\n- Coverage report can be generated via `pnpm test:coverage` without failing.\n\nImplementation Notes\n- Keep helpers in `test/` to avoid bundling into app code.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T12:32:49.780087-03:00","created_by":"caiodgallo","updated_at":"2026-01-12T14:22:44.900059-03:00","closed_at":"2026-01-12T14:22:44.900059-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-mqn.8","depends_on_id":"northstar-mqn","type":"parent-child","created_at":"2026-01-12T12:32:49.781302-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-mt2","title":"Add transfers management UI and backfill trigger","description":"Provide UI to create/edit/delete transfers and a safe trigger for backfillFaturaTransfers.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-08T13:03:31.282227-03:00","created_by":"caiodgallo","updated_at":"2026-01-08T14:36:18.555008-03:00","closed_at":"2026-01-08T14:36:18.555008-03:00","close_reason":"Closed"}
{"id":"northstar-nek","title":"Phase 4: Translate transaction-detail-sheet component","description":"Phase 4: Translate transaction-detail-sheet component\n\nFile: components/transaction-detail-sheet.tsx (205 lines)\n\nHardcoded strings to translate:\n- Status labels: 'Paid', 'Pending', 'Received' (lines 34-35)\n- Date labels: 'Due Date', 'Received Date' (line 37)\n- Field labels: 'Amount', 'Status', 'Category', 'Account', 'Purchase Date', 'Fatura', 'Installment' (lines 65, 76, 93, 96, 114, 125, 135)\n- Installment text: '{n} of {n}' (line 138)\n- Buttons: 'View All {n} Installments', 'Edit' (lines 60, 74)\n\nMost keys already exist in messages:\n- transactionDetail namespace has: amount, status, category, account, dueDate, receivedDate, purchaseDate, fatura, installment, paid, pending, received, edit\n- Need to add: 'of' (line 138)\n- Need to update: 'viewAllInstallments' (already exists in messages/transactionDetail: 'View All {count} Installments')\n\nSteps:\n1. Add useTranslations('transactionDetail') hook\n2. Replace all hardcoded strings with t() calls\n3. Add 'transactionDetail.of' key to messages (English: 'of', Portuguese: 'de')\n4. Verify sheet works correctly in both languages\n\nNote: This component uses a DetailRow helper component that accepts a label prop.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T07:06:46.359939-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T09:58:48.907979-03:00","closed_at":"2026-01-05T09:58:48.907979-03:00","close_reason":"Closed"}
{"id":"northstar-nlu","title":"Fix AlertDialog accessibility warning in event detail sheet","description":"Tests emit a warning: Missing Description or aria-describedby for DialogContent in event-detail-sheet. Add proper description or aria-describedby to silence and improve a11y.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-08T14:34:58.105722-03:00","created_by":"caiodgallo","updated_at":"2026-01-09T07:43:10.195648-03:00","closed_at":"2026-01-09T07:43:10.195648-03:00","close_reason":"Closed"}
{"id":"northstar-nrwd","title":"Fix calendar sync overwriting completed events as cancelled","description":"## Problem\nPast calendar events were being marked as 'cancelled' instead of remaining 'completed' after the daily cronjob.\n\n## Root Cause\n1. updatePastItemStatuses() marks past events as 'completed'\n2. syncAllUsersCalendars() runs in parallel and fetches iCal feeds\n3. External calendar providers don't include past events in feeds\n4. calculateDiff() identified completed events as 'orphaned' and marked them 'cancelled'\n\n## Solution\nModified lib/actions/calendar-sync.ts:330 to exclude completed events from orphan cancellation logic.\n\nChanged:\n```typescript\nif (!parsedUids.has(uid) \u0026\u0026 existingEvent.status !== 'cancelled')\n```\n\nTo:\n```typescript\nif (!parsedUids.has(uid) \u0026\u0026 existingEvent.status !== 'cancelled' \u0026\u0026 existingEvent.status !== 'completed')\n```\n\n## Testing\nAdded test case 'does not overwrite completed events when missing from feed' to verify fix.","status":"open","priority":1,"issue_type":"bug","owner":"caiogallo88@gmail.com","created_at":"2026-01-15T06:07:22.471616-03:00","created_by":"Caio Gallo","updated_at":"2026-01-15T06:09:06.158632-03:00"}
{"id":"northstar-nth","title":"Add error handling to calendar loadData function","description":"loadData Promise.all has zero error handling for fetching events/tasks/bill reminders/settings.\n\nLocation: app/(app)/calendar/page.tsx\nImpact: If any fetch fails, user sees infinite loading spinner with no error message\n\nCurrent behavior:\n- setIsLoading(false) never executes on error\n- No error logging or user feedback\n- App appears frozen\n\nFix: Wrap Promise.all in try-catch, show toast/error message, call setIsLoading(false) in finally block\n\nFound by: silent-failure-hunter agent\nConfidence: CRITICAL","status":"closed","priority":0,"issue_type":"bug","owner":"caiogallo88@gmail.com","created_at":"2026-01-14T15:39:14.553283-03:00","created_by":"Caio Gallo","updated_at":"2026-01-14T16:22:25.065499-03:00","closed_at":"2026-01-14T16:22:25.065499-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-nth","depends_on_id":"northstar-dal","type":"blocks","created_at":"2026-01-14T15:39:50.059621-03:00","created_by":"Caio Gallo"}]}
{"id":"northstar-o3p","title":"Security Hardening for Public Launch","description":"Complete security audit and hardening before public launch with multi-user support. Addresses critical multi-tenancy vulnerabilities, authorization, rate limiting, and auth hardening.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-02T15:50:42.526809-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T06:59:41.762679-03:00","closed_at":"2026-01-05T06:59:41.762679-03:00","close_reason":"Closed"}
{"id":"northstar-o3p.1","title":"Add userId to schema and migrate existing data","description":"CRITICAL: Add userId column to all tables (accounts, categories, budgets, monthlyBudgets, transactions, income, faturas). Create Drizzle migration, write data migration SQL, and add RLS policies.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T15:51:24.712209-03:00","created_by":"caiodgallo","updated_at":"2026-01-03T05:59:33.331082-03:00","closed_at":"2026-01-03T05:59:33.331082-03:00","close_reason":"Closed","labels":["database","security"],"dependencies":[{"issue_id":"northstar-o3p.1","depends_on_id":"northstar-o3p","type":"parent-child","created_at":"2026-01-02T15:51:24.716313-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-o3p.2","title":"Implement authorization checks in all server actions","description":"CRITICAL: Create lib/auth/get-current-user.ts helper. Update all server actions (accounts, categories, expenses, budgets, income, faturas, import) with userId filtering and ownership verification.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T15:51:25.848561-03:00","created_by":"caiodgallo","updated_at":"2026-01-04T06:44:27.641225-03:00","closed_at":"2026-01-04T06:44:27.641225-03:00","close_reason":"Closed","labels":["authorization","security"],"dependencies":[{"issue_id":"northstar-o3p.2","depends_on_id":"northstar-o3p","type":"parent-child","created_at":"2026-01-02T15:51:25.862439-03:00","created_by":"caiodgallo"},{"issue_id":"northstar-o3p.2","depends_on_id":"northstar-o3p.1","type":"blocks","created_at":"2026-01-02T15:52:17.215987-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-o3p.3","title":"Add Upstash rate limiting to server actions","description":"Install @upstash/ratelimit and @upstash/redis. Create rate limiter utility. Apply to auth actions and bulk operations.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T15:51:26.935934-03:00","created_by":"caiodgallo","updated_at":"2026-01-04T12:15:36.727782-03:00","closed_at":"2026-01-04T12:15:36.727782-03:00","close_reason":"Closed","labels":["rate-limiting","security"],"dependencies":[{"issue_id":"northstar-o3p.3","depends_on_id":"northstar-o3p","type":"parent-child","created_at":"2026-01-02T15:51:26.939627-03:00","created_by":"caiodgallo"},{"issue_id":"northstar-o3p.3","depends_on_id":"northstar-o3p.2","type":"blocks","created_at":"2026-01-02T15:52:17.349329-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-o3p.4","title":"Add security headers and strengthen auth","description":"Add security headers to next.config.ts (CSP, HSTS, X-Frame-Options). Update supabase/config.toml for 8+ char passwords. Enable email confirmation. Add hCaptcha/Turnstile to login.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T15:51:28.473209-03:00","created_by":"caiodgallo","updated_at":"2026-01-04T11:58:28.094268-03:00","closed_at":"2026-01-04T11:58:28.094268-03:00","close_reason":"Closed","labels":["auth","headers","security"],"dependencies":[{"issue_id":"northstar-o3p.4","depends_on_id":"northstar-o3p","type":"parent-child","created_at":"2026-01-02T15:51:28.476001-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-o3p.5","title":"Harden input validation and cleanup secrets","description":"Add validation to accounts.ts, income.ts, categories.ts. Add file upload validation (MIME type, size limits). Remove commented credentials from .env. Reduce error logging verbosity.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T15:51:29.592432-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T06:59:52.980097-03:00","closed_at":"2026-01-05T06:59:52.980097-03:00","close_reason":"Closed","labels":["security","validation"],"dependencies":[{"issue_id":"northstar-o3p.5","depends_on_id":"northstar-o3p","type":"parent-child","created_at":"2026-01-02T15:51:29.594404-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-o7n","title":"Add categoryForm namespace to en.json and pt-BR.json","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:03.083352-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T07:20:20.292835-03:00","closed_at":"2026-01-05T07:20:20.292835-03:00","close_reason":"Closed"}
{"id":"northstar-oas","title":"Phase 5: Manual testing of all translations","description":"Phase 5: Manual testing of all translations\n\nTest the complete i18n implementation by:\n1. Switching between languages (en/pt-BR) in settings\n2. Navigating through all pages (dashboard, expenses, income, budgets, faturas, settings)\n3. Testing all user flows:\n   - Login/logout\n   - Create/edit/delete expenses and income\n   - Create/edit/delete categories and accounts\n   - Import CSV files\n   - Pay faturas\n   - Switch themes\n4. Verifying all server action errors are translated\n5. Checking form placeholders, labels, buttons, and error messages\n\nFile locations to test:\n- All pages in app/ directory\n- All components in components/ directory\n- All server actions in lib/actions/ directory\n\nExpected outcome: All user-facing text should display correctly in both English and Portuguese without any hardcoded strings remaining.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:46.684904-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T10:09:19.565629-03:00","closed_at":"2026-01-05T10:09:19.565629-03:00","close_reason":"Closed"}
{"id":"northstar-ogl","title":"Convert expense to fatura payment from expense card","description":"Goal: let users turn an imported/recorded expense into a fatura payment (creates a fatura_payment transfer and marks the bill paid) from the ExpenseCard context menu.\n\nPlan:\n1) UX + eligibility\n- Add a context-menu action in components/expense-card.tsx (e.g., \"Convert to fatura payment\").\n- Only enable for single-installment entries (totalInstallments === 1) and non-credit-card source accounts; show a disabled state or toast otherwise.\n- Open a dialog to select the target unpaid fatura (card + statement month + due date + total). Preselect best match when amount equals total and due date is near the expense date.\n\n2) Server actions + data\n- Add getUnpaidFaturas() (or similar) returning fatura id, accountId/accountName, yearMonth, dueDate, totalAmount, paidAt; filter to credit-card accounts and unpaid.\n- Add convertExpenseToFaturaPayment(entryId, faturaId) server action that:\n  - Loads entry + transaction; validates ownership, account type != credit_card, single installment, amount matches fatura total.\n  - Loads fatura (unpaid) and validates card account.\n  - Creates transfer {type: fatura_payment, faturaId, fromAccountId: entry.accountId, toAccountId: fatura.accountId, amount: entry.amount, date: entry.purchaseDate}.\n  - Marks fatura paidAt using entry purchase date (timestamp) + paidFromAccountId.\n  - Marks all entries in the fatura as paid (same paidAt).\n  - Deletes the expense transaction/entries and syncs balances.\n  - Revalidates /expenses, /faturas, /transfers, /dashboard, /settings/accounts.\n\n3) Client state\n- Add a context method in lib/contexts/expense-context.tsx to optimistically remove the transaction on convert, then call the server action and toast errors if it fails (refresh on error).\n\n4) Copy/i18n\n- Add new strings under expenses for menu label + dialog copy; add new error keys for invalid conversion (installments, amount mismatch, invalid fatura, etc.) in both messages/en.json and messages/pt-BR.json.\n\n5) Manual verification\n- Import an expense with description \"Pagamento de fatura\"; convert it; confirm expense disappears, transfer appears, and fatura becomes paid with correct date + balances update.\n\nOpen questions:\n- Should we allow conversion when amount != fatura total (partial payment), or hard-block with an error?\n- Should the dialog allow selecting paid faturas or only unpaid?\n","notes":"Decisions: conversion must be full amount only (no partials). Selection dialog should list only unpaid faturas.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T15:14:06.472247-03:00","created_by":"caiodgallo","updated_at":"2026-01-09T07:37:13.325396-03:00","closed_at":"2026-01-09T07:37:13.325396-03:00","close_reason":"Closed"}
{"id":"northstar-os7","title":"Test updateEvent with notification rescheduling","description":"6 test cases: updates, authorization, notification rescheduling logic, updatedAt","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-08T07:13:07.02781-03:00","created_by":"caiodgallo","updated_at":"2026-01-08T08:09:27.395024-03:00","closed_at":"2026-01-08T08:09:27.395024-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-os7","depends_on_id":"northstar-s19","type":"blocks","created_at":"2026-01-08T07:13:24.424618-03:00","created_by":"caiodgallo"},{"issue_id":"northstar-os7","depends_on_id":"northstar-5ad","type":"blocks","created_at":"2026-01-08T07:13:24.606182-03:00","created_by":"caiodgallo"},{"issue_id":"northstar-os7","depends_on_id":"northstar-62p","type":"parent-child","created_at":"2026-01-08T07:13:41.319437-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-p86","title":"iCal URL Calendar Syncing","description":"One-way sync from external iCal URLs to local events. Full UI for managing calendar subscriptions. Includes schema changes, parsing with ical.js, sync engine with 6-month window, cron integration, and complete settings UI.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-09T07:27:10.01976-03:00","created_by":"caiodgallo","updated_at":"2026-01-09T11:27:23.269767-03:00","closed_at":"2026-01-09T11:27:23.269767-03:00","close_reason":"Closed"}
{"id":"northstar-qyq","title":"Fix test suite for NextAuth migration","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-13T08:20:55.914759-03:00","created_by":"caiodgallo","updated_at":"2026-01-14T05:54:18.455195-03:00","closed_at":"2026-01-14T05:54:18.455195-03:00","close_reason":"Closed"}
{"id":"northstar-r0i","title":"Auto-assign categories during import based on historical data","description":"## Goal\nAuto-assign categories during import based on historical transaction data. Show suggestions in preview, use them during import (fallback to default if no match).\n\n## Context (Updated Jan 2026)\n**Import feature was refactored to be generic (not expense-only):**\n- Folder: `components/import/` (was `import-expenses/`)\n- Available on both `/expenses` and `/income` pages\n- Both parsers now set `type` field:\n  - `nubank` (credit card): positive = expense, negative = income (refunds)\n  - `nubank-extrato` (checking): positive = income, negative = expense\n- Import modal uses `importMixed()` when any row has type info (no hardcoded parser checks)\n\n## Design Decisions\n- **Matching**: Exact string match on description\n- **Source**:\n  - Expense rows (`type='expense'`) → query `transactions` table only\n  - Income rows (`type='income'`) → query `income` table only\n  - (No cross-pollination between pools)\n- **UX**: Suggestions shown in preview (read-only) - editing happens after import\n- **Fallback**: No match → use default import category\n- **Scope**: Both expenses AND income (but separate category pools)\n\n## Implementation Steps\n\n### 1. Add Types (`/lib/import/types.ts`)\n```typescript\nexport type CategorySuggestion = {\n  id: number;\n  name: string;\n  color: string;\n};\n\nexport type ImportRowWithSuggestion = ValidatedImportRow \u0026 {\n  suggestedCategory?: CategorySuggestion;\n};\n```\n\n### 2. Add Server Action (`/lib/actions/import.ts`)\nNew `getCategorySuggestions` function with separate pools:\n\n```typescript\ntype SuggestionsInput = {\n  expenseDescriptions: string[];  // from rows with type='expense'\n  incomeDescriptions: string[];   // from rows with type='income'\n};\n\ntype SuggestionsResult = {\n  expense: Record\u003cstring, CategorySuggestion\u003e;  // description → category\n  income: Record\u003cstring, CategorySuggestion\u003e;\n};\n\nexport async function getCategorySuggestions(\n  input: SuggestionsInput\n): Promise\u003cSuggestionsResult\u003e\n```\n\n- Query `transactions` for expense descriptions\n- Query `income` for income descriptions\n- Each returns separate map\n- Most recent category wins within each pool\n\n### 3. Update Import Modal (`/components/import/import-modal.tsx`)\n**Note: Path changed from `import-expenses/` to `import/`**\n\n- Add state: `rowsWithSuggestions: ImportRowWithSuggestion[]`\n- Make `handleFileSelect` async\n- After parsing:\n  - Separate descriptions by type (ALL rows now have type field)\n  - Call `getCategorySuggestions` with separated lists\n  - Match suggestions back to rows using correct pool per row type\n- Pass enriched rows to `ImportPreview`\n\n### 4. Update Preview Component (`/components/import/import-preview.tsx`)\n**Note: Path changed from `import-expenses/` to `import/`**\n\n- Accept optional `rowsWithSuggestions` prop\n- Add Category column (conditional - only if suggestions exist)\n- Show colored badge per row with category name + type (expense/income)\n- Show \"Default (Expense)\" or \"Default (Income)\" badge for rows without suggestions\n- Add summary stat: \"Auto-categorized: X / Y (N expenses, M income)\"\n\n### 5. Update Import Actions (`/lib/actions/import.ts`)\nModify `importMixed` to accept per-row category overrides:\n\n**For `importMixed`:**\n- Accept `categoryOverrides?: Record\u003cnumber, number\u003e` (rowIndex → categoryId)\n- For each expense row: use override if exists, else use default expense category\n- For each income row: use override if exists, else use default income category\n\n**Import Modal changes:**\n- Build `categoryOverrides` map from `rowsWithSuggestions`\n- Pass to `importMixed` action\n- Note: `importExpenses` is now legacy (only used when no type info present)\n\n## Files to Modify\n| File | Changes |\n|------|---------|\n| `/lib/import/types.ts` | Add `CategorySuggestion`, `ImportRowWithSuggestion` |\n| `/lib/actions/import.ts` | Add `getCategorySuggestions`, modify `importMixed` to accept overrides |\n| `/components/import/import-modal.tsx` | Fetch suggestions, build overrides, pass to preview + import |\n| `/components/import/import-preview.tsx` | Render category column with type-aware badges |\n\n## Edge Cases\n- Empty descriptions list → return empty map for that pool\n- No matching history → use default import category, show \"Default (Expense/Income)\" badge\n- Multiple history entries for same description → most recent wins within its pool\n- Same description as expense AND income → each gets its own pool's suggestion (no cross-pollination)\n- All rows now have type field (no undefined cases after refactor)","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-06T06:34:27.95007-03:00","created_by":"caiodgallo","updated_at":"2026-01-06T07:00:19.392454-03:00","closed_at":"2026-01-06T07:00:19.392454-03:00","close_reason":"Closed"}
{"id":"northstar-r2g","title":"Test edge cases and error handling","description":"5 test cases: null fields, DB constraints, all-day events, priority/status filtering","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-08T07:13:09.722917-03:00","created_by":"caiodgallo","updated_at":"2026-01-08T09:16:13.359667-03:00","closed_at":"2026-01-08T09:16:13.359667-03:00","close_reason":"Completed: Added comprehensive edge case tests covering null fields (description/location), DB constraints (startBeforeEnd), all-day events (single/multi-day), and priority/status filtering (22 tests total)","dependencies":[{"issue_id":"northstar-r2g","depends_on_id":"northstar-s19","type":"blocks","created_at":"2026-01-08T07:13:27.522936-03:00","created_by":"caiodgallo"},{"issue_id":"northstar-r2g","depends_on_id":"northstar-5ad","type":"blocks","created_at":"2026-01-08T07:13:27.700296-03:00","created_by":"caiodgallo"},{"issue_id":"northstar-r2g","depends_on_id":"northstar-62p","type":"parent-child","created_at":"2026-01-08T07:13:41.81552-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-rxa","title":"Phase 4: Cron integration for calendar sync","description":"Add syncAllCalendars() to app/api/cron/daily/route.ts. Create app/api/calendar-sync/route.ts for manual sync endpoint with user authentication.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T07:28:53.200765-03:00","created_by":"caiodgallo","updated_at":"2026-01-09T11:26:46.908196-03:00","closed_at":"2026-01-09T11:26:46.908196-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-rxa","depends_on_id":"northstar-p86","type":"parent-child","created_at":"2026-01-09T07:29:20.167391-03:00","created_by":"caiodgallo"},{"issue_id":"northstar-rxa","depends_on_id":"northstar-20h","type":"blocks","created_at":"2026-01-09T07:29:28.530563-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-s19","title":"Create test fixtures for events","description":"Add testEvents and createTestEvent() to test/fixtures.ts following existing patterns","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-08T07:13:03.434487-03:00","created_by":"caiodgallo","updated_at":"2026-01-08T07:17:26.201026-03:00","closed_at":"2026-01-08T07:17:26.201026-03:00","close_reason":"Completed: Added testEvents fixtures and createTestEvent() to test/fixtures.ts; Added events-related tables to clearAllTables() in test/db-utils.ts","dependencies":[{"issue_id":"northstar-s19","depends_on_id":"northstar-62p","type":"parent-child","created_at":"2026-01-08T07:13:40.56525-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-sbt","title":"Add user context to notification job processing","description":"File: lib/actions/notification-jobs.ts:17-118. Jobs processed without verifying ownership. Could leak data cross-user. Add user context verification.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-07T08:11:22.445602-03:00","created_by":"caiodgallo","updated_at":"2026-01-07T08:50:10.15473-03:00","closed_at":"2026-01-07T08:50:10.15473-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-sbt","depends_on_id":"northstar-vau","type":"blocks","created_at":"2026-01-07T08:11:56.099502-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-seb","title":"Phase 3: Translate import.ts server action errors","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:29.576049-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T09:44:53.664224-03:00","closed_at":"2026-01-05T09:44:53.664224-03:00","close_reason":"Closed"}
{"id":"northstar-sql","title":"Fix drizzle-seed db:seed failure","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-13T10:47:11.215597-03:00","created_by":"caiodgallo","updated_at":"2026-01-13T10:51:03.508061-03:00","closed_at":"2026-01-13T10:51:03.508061-03:00","close_reason":"Closed"}
{"id":"northstar-ss7","title":"Add chrono-node dependency","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T07:25:19.813887-03:00","created_by":"caiodgallo","updated_at":"2026-01-09T07:27:37.325316-03:00","closed_at":"2026-01-09T07:27:37.325316-03:00","close_reason":"Closed"}
{"id":"northstar-t72","title":"Update Schedule-X NextJS setup","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T15:46:17.884409-03:00","created_by":"caiodgallo","updated_at":"2026-01-06T15:53:49.371508-03:00","closed_at":"2026-01-06T15:53:49.371508-03:00","close_reason":"Closed"}
{"id":"northstar-t9p","title":"Translate the Budgets(settings) page","description":"The Budgets(settings) page is still mainly hardcoded strings. They need to following the internalitzation pattern established accross the codebase and translated the suitable strings. Mainly UI components and layout at the present moment.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T12:33:11.3106-03:00","created_by":"caiodgallo","updated_at":"2026-01-02T14:51:32.827899-03:00","closed_at":"2026-01-02T14:51:32.827899-03:00","close_reason":"Closed"}
{"id":"northstar-tb9","title":"Extract addMonthsToDate to shared utility","description":"addMonthsToDate is duplicated across multiple files:\n- app/(app)/calendar/page.tsx line 61\n- lib/task-schedule.ts line 18\n\nViolates DRY principle. CLAUDE.md mentions addMonths() for month arithmetic.\n\nFix: Export from @/lib/utils.ts and import where needed\n\nFound by: code-reviewer agent\nConfidence: 85%","status":"open","priority":2,"issue_type":"task","owner":"caiogallo88@gmail.com","created_at":"2026-01-14T15:39:17.819029-03:00","created_by":"Caio Gallo","updated_at":"2026-01-14T15:39:17.819029-03:00","dependencies":[{"issue_id":"northstar-tb9","depends_on_id":"northstar-dal","type":"blocks","created_at":"2026-01-14T15:39:50.699362-03:00","created_by":"Caio Gallo"}]}
{"id":"northstar-th0","title":"Tests: Budgets - Test CRUD and calculation logic","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T10:27:32.902025-03:00","created_by":"caiodgallo","updated_at":"2026-01-14T11:27:20.876138-03:00","closed_at":"2026-01-05T12:35:48.50381-03:00","dependencies":[{"issue_id":"northstar-th0","depends_on_id":"northstar-v0d","type":"blocks","created_at":"2026-01-05T10:46:48.629948-03:00","created_by":"caiodgallo"}],"comments":[{"id":8,"issue_id":"northstar-th0","author":"caiodgallo","text":"# User Journey: Budgets CRUD\n\n## Server Actions: `/lib/actions/budgets.ts`\n\n### Happy Path Tests\n\n#### 1. `getBudgetsForMonth(yearMonth)`\n- Returns all categories for the month\n- Includes categories even without budgets (budgetId = null, budgetAmount = null)\n- Left joins with budgets table\n- Ordered by category name\n- Filters by userId correctly (user isolation)\n- Returns empty array if user has no categories\n\n#### 2. `upsertBudget(categoryId, yearMonth, amount)` - Happy Paths\n- Create new budget for category+month\n- Update existing budget (same category+month)\n- Create budget for amount 0 (allowed)\n- Update budget to different amount\n- Verify userId is auto-assigned\n- Verify amount stored in cents (convert from display)\n- Verify unique constraint (userId, categoryId, yearMonth)\n\n#### 3. `getMonthlyBudget(yearMonth)`\n- Returns monthly budget for month\n- Returns null if no monthly budget set\n- Filters by userId correctly\n- Returns correct amount in cents\n\n#### 4. `upsertMonthlyBudget(yearMonth, amount)` - Happy Paths\n- Create new monthly budget for month\n- Update existing monthly budget\n- Set to amount 0 (allowed)\n- Verify userId is auto-assigned\n- Verify unique constraint (userId, yearMonth)\n\n#### 5. `getBudgetsWithSpending(yearMonth)` - Happy Paths\n- Returns budgets with spending data\n- Calculates totalSpent correctly (sum of all category spending)\n- Calculates totalBudget correctly (sum of all category budgets)\n- Returns budget array with spent and budget per category\n- Calculates spent by purchaseDate (budget impact), NOT dueDate\n- Handles categories with budgets but no spending (spent=0)\n- Handles spending in categories without budgets (budget=0 or null)\n\n#### 6. `copyBudgetsFromMonth(sourceMonth, targetMonth)` - Happy Paths\n- Copy budgets from previous month to current month\n- Copies all category budgets that don't exist in target\n- Copies monthlyBudget if exists in source\n- Skips categories that already have budgets in target month\n- Returns stats: { copied, skipped, total, monthlyBudgetCopied }\n\n### Edge Case Tests\n\n#### 1. Budget Amount Constraints\n- Negative amounts should fail (validation)\n- Zero amount is allowed\n- Very large amounts should work (within integer range)\n- Non-integer amounts should fail (stored as cents, must be integer)\n\n#### 2. YearMonth Format Validation\n- Valid format: \"YYYY-MM\" (2025-01, 2025-12)\n- Invalid format should fail validation\n- Month out of range (00, 13) should fail\n- Future months should be allowed\n- Past months should be allowed\n\n#### 3. Upsert Logic\n- upsertBudget called twice with same params → updates existing\n- getBudgetsForMonth shows latest amount after update\n- Verify no duplicates created\n\n#### 4. Spending Calculation Edge Cases\n- No spending for the month → totalSpent = 0\n- Spending in categories without budgets → included in totalSpent\n- Categories with budgets but no spending → spent = 0 in breakdown\n- Multiple entries in same category → sum correctly\n- Installment expenses → only entries in target month counted\n\n#### 5. Budget Deletion via Cascade\n- Delete category → budget should cascade delete\n- Verify ON DELETE CASCADE works\n- Update budget to 0 is not deletion (budget still exists)\n\n### Error Handling Tests\n\n#### 1. Upsert Budget Errors\n- Invalid categoryId (doesn't exist)\n- Invalid yearMonth format\n- Negative amount\n- Non-integer amount\n\n#### 2. Get Monthly Budget Errors\n- Invalid yearMonth format\n- Month with no monthly budget (returns null, not error)\n\n#### 3. Copy Budgets Errors\n- Source month has no budgets (no error, returns copied=0)\n- Invalid yearMonth formats\n- Source same as target (no error, no budgets copied)\n\n#### 4. Referential Integrity\n- Create budget for non-existent category (should fail FK constraint)\n- Create budget for another user's category (should fail userId check or FK)\n\n### Integration Tests\n\n#### 1. Budget-Spending Calculation\n- Create budgets and expenses for month\n- Verify getBudgetsWithSpending calculates correctly\n- Spending filtered by purchaseDate in month range\n- Verify spending = sum of entry amounts\n- Verify totalBudget = sum of category budget amounts\n\n#### 2. Category-Budget Relationship\n- Create category → create budget\n- Delete category → budget should cascade delete\n- getBudgetsForMonth should not include deleted category's budget\n\n#### 3. Monthly Budget Integration\n- Set monthly budget → getMonthlyBudget returns it\n- Create category budgets → monthlyBudget is separate\n- Total budget = monthlyBudget OR sum of category budgets (depending on usage)\n- Test how dashboard uses monthlyBudget vs category budgets\n\n#### 4. Multi-Month Data\n- Create budgets for Jan and Feb\n- Query Jan → only Jan budgets returned\n- Query Feb → only Feb budgets returned\n- Verify months don't leak into each other\n\n#### 5. User Isolation\n- Create budgets for two users\n- User A cannot see User B's budgets\n- User A cannot update/delete User B's budgets\n- getBudgetsForMonth returns only current user's budgets\n\n#### 6. Copy Budgets Logic\n- Source: 3 budgets, Target: 1 budget (different category)\n- Result: 2 copied (categories not in target), 1 skipped\n- Verify monthlyBudget copied if exists in source\n- Verify budgets that exist in target are not overwritten\n\n#### 7. Budget Progress Calculation\n- Budget \u003e spent → percentage \u003c 100%\n- Budget = spent → percentage = 100%\n- Budget \u003c spent → percentage \u003e 100%\n- Budget = 0, spent \u003e 0 → division by zero (handle this case)\n- Spent = 0, budget \u003e 0 → percentage = 0%\n\n#### 8. Installment Expenses and Budgets\n- Create 3-installment expense in Jan\n- Each installment appears in different month\n- Verify each month's budget only counts that month's installment\n- Verify totalSpent per month is correct\n\n### Revalidation Tests\n\n#### 1. Cache Invalidation\n- upsertBudget → revalidatePath('/settings/budgets') and '/budgets' called\n- upsertMonthlyBudget → revalidatePath('/settings/budgets') called\n- Verify caching works correctly (use React cache)\n\n### Business Logic Tests\n\n#### 1. Budget Types\n- Per-category budgets (budgets table)\n- Monthly total budget (monthlyBudgets table)\n- How they interact and are used in dashboard\n\n#### 2. Zero Budgets\n- Budget of 0 is valid\n- Spending \u003e 0 with budget of 0 → over budget\n- Should display correctly in UI (red progress bar)\n\n#### 3. Missing Budgets\n- Category with spending but no budget\n- Should appear in breakdown with budget = 0 or null\n- Dashboard should handle this correctly\n\n### Test File Location\n`/test/lib/actions/budgets.test.ts`\n\n### Implementation Notes\n- Create category fixtures for testing\n- Mock auth with test user ID\n- Use in-memory PGlite database\n- Test spending calculation logic extensively (critical)\n- Test purchaseDate vs dueDate filtering\n- Test user isolation extensively\n- Test cascade delete with categories\n- Follow pattern from expenses.test.ts\n- Verify money handling in cents (conversion utilities)\n","created_at":"2026-01-05T13:43:32Z"}]}
{"id":"northstar-tm6","title":"Write parser tests (lib/natural-language-parser.test.ts)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T07:25:20.273461-03:00","created_by":"caiodgallo","updated_at":"2026-01-09T07:31:35.016924-03:00","closed_at":"2026-01-09T07:31:35.016924-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-tm6","depends_on_id":"northstar-0a6","type":"blocks","created_at":"2026-01-09T07:25:30.125645-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-tt8","title":"QA: Expenses page UI and flow testing results","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T13:13:30.222388-03:00","created_by":"caiodgallo","updated_at":"2026-01-12T22:04:25.1304-03:00","closed_at":"2026-01-12T22:04:25.1304-03:00","close_reason":"Closed"}
{"id":"northstar-v0d","title":"Tests: Categories - Test CRUD operations","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T10:27:32.665432-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T11:03:48.280287-03:00","closed_at":"2026-01-05T11:03:48.280287-03:00","close_reason":"Closed","comments":[{"id":9,"issue_id":"northstar-v0d","author":"caiodgallo","text":"# User Journey: Categories CRUD\n\n## Server Actions: `/lib/actions/categories.ts`\n\n### Happy Path Tests\n\n#### 1. `getCategories(type?)`\n- Returns all expense categories (no filter)\n- Returns all income categories (filter by type='income')\n- Returns empty array if no categories\n- Ordered by name alphabetically\n- Filters by userId correctly (user isolation)\n\n#### 2. `createCategory(data)` - Happy Paths\n- Create expense category successfully\n- Create income category successfully\n- Create category with custom color\n- Create category with icon\n- Create category with both color and icon\n- Create category without icon (icon = null)\n- Verify userId is auto-assigned\n- Verify default color is '#6b7280' when not provided\n- Verify default type is 'expense' when not provided\n\n#### 3. `updateCategory(id, data)` - Happy Paths\n- Update category name\n- Update category color\n- Update category icon\n- Update category type (expense ↔ income)\n- Update all fields simultaneously\n- Verify both id and userId must match (cannot update another user's category)\n\n#### 4. `deleteCategory(id)` - Happy Paths\n- Delete unused category successfully\n- Verify both id and userId must match\n- Verify category no longer exists after deletion\n- Verify returns { success: true }\n\n### Edge Case Tests\n\n#### 1. Category Name Constraints\n- Empty name should fail (validation)\n- Very long name (should work but test it)\n- Duplicate names (should be allowed - no unique constraint)\n- Special characters in name (should work)\n- Names with spaces (should work)\n- Leading/trailing whitespace (should be trimmed or preserved)\n\n#### 2. Color Constraints\n- Valid hex colors (6 digits with # prefix)\n- Invalid color formats (should fail validation)\n- Empty color (should use default or fail?)\n- Very long color string (should fail)\n\n#### 3. Icon Validation\n- Valid icon names from predefined list (38 icons)\n- Invalid icon names (should fail validation)\n- Null icon (should be allowed)\n- Empty string icon (should fail or convert to null?)\n- Icon case sensitivity\n\n#### 4. Type Constraints\n- Valid types: 'expense', 'income'\n- Invalid type should be rejected\n\n#### 5. Referential Integrity on Delete\n- Delete category used by transactions → should fail with error\n- Delete category used by income → should fail with error\n- Verify error message is user-friendly (\"Cannot delete category with transactions/income\")\n- Delete category used by budgets → should succeed (CASCADE)\n  - Verify budgets are deleted when category deleted (ON DELETE CASCADE)\n\n### Error Handling Tests\n\n#### 1. Create Category Errors\n- Missing required fields (name, type)\n- Invalid type\n- Invalid color format\n- Invalid icon name\n\n#### 2. Update Category Errors\n- Update non-existent category\n- Update category belonging to another user\n- Invalid data (color, icon, type)\n\n#### 3. Delete Category Errors\n- Delete non-existent category\n- Delete category belonging to another user\n- Delete category with transactions (error returned, not exception)\n- Delete category with income (error returned, not exception)\n\n### Integration Tests\n\n#### 1. Category-Transaction Relationship\n- Create category → create expense with this category\n- Try to delete category → should fail\n- Update expense to different category → delete original → should succeed\n- Verify transactions reference correct category\n\n#### 2. Category-Income Relationship\n- Create category → create income with this category\n- Try to delete category → should fail\n- Update income to different category → delete original → should succeed\n- Verify income references correct category\n\n#### 3. Category-Budget Relationship\n- Create category → create budget for this category\n- Delete category → budget should cascade delete\n- Verify foreign key cascade works correctly\n\n#### 4. User Isolation\n- Create categories for two users\n- User A cannot see User B's categories\n- User A cannot update/delete User B's categories\n- getCategories() returns only current user's categories\n\n#### 5. Type Filtering\n- Create expense categories and income categories\n- getCategories('expense') → only expense categories\n- getCategories('income') → only income categories\n- getCategories() → all categories\n\n#### 6. Category Uniqueness and Display\n- Create categories with same name but different types (should work)\n- Create categories with same name but different users (should work)\n- Verify they appear correctly in UI (distinguished by type/user)\n\n#### 7. Icon Picker Integration\n- Verify all 38 predefined icons are valid\n- Test CategoryIcon component with each icon (if testing UI)\n- Verify icon display in category cards\n\n### Revalidation Tests\n\n#### 1. Cache Invalidation\n- createCategory → revalidatePath('/settings/categories') called\n- updateCategory → revalidatePath('/settings/categories') called\n- deleteCategory → revalidatePath('/settings/categories') called\n- Verify tags: 'categories', 'expense-categories', 'income-categories' revalidated\n\n### Business Logic Tests\n\n#### 1. Category Type Usage\n- Expense categories can only be used for transactions\n- Income categories can only be used for income\n- Verify type is enforced in forms (if testing UI)\n\n#### 2. Default Values\n- Default color: '#6b7280'\n- Default type: 'expense'\n- Default icon: null\n\n### Test File Location\n`/test/lib/actions/categories.test.ts`\n\n### Implementation Notes\n- Use existing fixtures (testCategories)\n- Mock auth with test user ID\n- Use in-memory PGlite database\n- Test referential integrity checks before deletion (explicit query)\n- Test icon name validation (type guard)\n- Test user isolation extensively\n- Test cascade delete with budgets\n- Follow pattern from expenses.test.ts\n","created_at":"2026-01-05T13:43:32Z"}]}
{"id":"northstar-vau","title":"Calendar Feature: Events \u0026 Tasks","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-07T08:03:31.023962-03:00","created_by":"caiodgallo","updated_at":"2026-01-07T08:19:14.822666-03:00","closed_at":"2026-01-07T08:19:14.822666-03:00","close_reason":"Calendar feature implementation complete - events, tasks, notifications, recurrence all implemented"}
{"id":"northstar-vzq","title":"Phase 3: Translate income.ts server action errors","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:06:29.216082-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T09:43:54.219678-03:00","closed_at":"2026-01-05T09:43:54.219678-03:00","close_reason":"Closed"}
{"id":"northstar-wgc","title":"Phase 1: Schema \u0026 Types for iCal sync","description":"Create migration for calendar_sources table and events modifications. Add externalId, calendarSourceId, externalUpdatedAt columns to events. Update lib/schema.ts. Create lib/ical/types.ts with ParsedEvent, ParsedCalendar, SyncResult interfaces.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T07:28:50.183957-03:00","created_by":"caiodgallo","updated_at":"2026-01-09T09:18:38.9805-03:00","closed_at":"2026-01-09T09:18:38.9805-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-wgc","depends_on_id":"northstar-p86","type":"parent-child","created_at":"2026-01-09T07:29:19.643521-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-wjg","title":"Remove redundant null from optional fields in ExtendedCalendarEvent","description":"Optional fields use redundant '| null' when '?' already means 'or undefined'.\n\nLocation: components/calendar/calendar-helpers.ts:17-18\n\nCurrent:\n- amount?: number | null\n- categoryId?: number | null\n\nIssue: Double-nullability adds no value, increases cognitive load\n\nFix:\n- amount?: number\n- categoryId?: number\n\nFound by: type-design-analyzer agent\nConfidence: HIGH","status":"open","priority":2,"issue_type":"task","owner":"caiogallo88@gmail.com","created_at":"2026-01-14T15:45:46.575447-03:00","created_by":"Caio Gallo","updated_at":"2026-01-14T15:45:46.575447-03:00","dependencies":[{"issue_id":"northstar-wjg","depends_on_id":"northstar-dal","type":"blocks","created_at":"2026-01-14T15:47:15.63942-03:00","created_by":"Caio Gallo"}]}
{"id":"northstar-wvj","title":"Tests: Faturas - Test CRUD operations and payment flows","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T10:27:32.106982-03:00","created_by":"caiodgallo","updated_at":"2026-01-14T11:27:20.876539-03:00","closed_at":"2026-01-05T12:18:06.246211-03:00","dependencies":[{"issue_id":"northstar-wvj","depends_on_id":"northstar-aos","type":"blocks","created_at":"2026-01-05T10:46:48.414587-03:00","created_by":"caiodgallo"}],"comments":[{"id":10,"issue_id":"northstar-wvj","author":"caiodgallo","text":"# User Journey: Faturas CRUD\n\n## Server Actions: `/lib/actions/faturas.ts`\n\n### Happy Path Tests\n\n#### 1. `ensureFaturaExists(accountId, yearMonth)`\n- Creates fatura for account/month that doesn't exist\n- Does nothing if fatura already exists (no duplicate)\n- Sets initial totalAmount to 0\n- Calculates dueDate correctly from account billing config\n- Uses fallback values (day 1/7) if no billing config\n\n#### 2. `updateFaturaTotal(accountId, yearMonth)`\n- Sums all entries for the fatura correctly\n- Updates totalAmount field with correct sum\n- Handles fatura with no entries (totalAmount should be 0)\n- Handles fatura with multiple entries\n\n#### 3. `getFaturasByMonth(yearMonth)`\n- Returns all faturas for specific month\n- Includes account information via join\n- Orders by account name\n- Returns empty array if no faturas for month\n\n#### 4. `getFaturasByAccount(accountId)`\n- Returns all faturas for specific account\n- Orders by month descending (newest first)\n- Returns empty array if account has no faturas\n\n#### 5. `getFaturaWithEntries(faturaId)`\n- Returns fatura with all its entries\n- Joins with transactions and categories\n- Includes correct entry details (description, amounts, category info, installment numbers)\n- Returns null if fatura not found\n\n### Edge Case Tests\n\n#### 1. Billing Configuration Edge Cases\n- Account with closingDay=1 (all purchases go to next month)\n- Account with closingDay=28 (all purchases go to current month)\n- Account with paymentDueDay \u003c= closingDay (payment due next month)\n- Account with paymentDueDay \u003e closingDay (payment due same month)\n- Account without billing config (uses fallback due dates)\n\n#### 2. Fatura Creation on Expense Creation\n- Create credit card expense → fatura created for correct month\n- Create installment expense spanning multiple months → faturas created for each month\n- Create expense on closing day → goes to current month's fatura\n- Create expense day after closing day → goes to next month's fatura\n\n#### 3. Fatura Update on Expense Changes\n- Update expense amount → fatura total updated correctly\n- Update expense date → moves entry to different fatura, both faturas updated\n- Delete expense → fatura total decreased correctly\n- Last entry deleted → fatura total becomes 0 (fatura still exists)\n\n#### 4. Multiple Credit Cards\n- Create expenses on different credit cards\n- Verify faturas created for each account\n- Verify each fatura has correct total for its account\n- Query by month returns all faturas for all accounts\n\n### Payment Flow Tests\n\n#### 5. `payFatura(faturaId, fromAccountId)` - Happy Paths\n- Pays unpaid fatura successfully\n- Marks fatura as paid (paidAt set)\n- Sets paidFromAccountId\n- Marks all entries in fatura as paid\n- Cannot pay same fatura twice (error: faturaAlreadyPaid)\n- Cannot pay from credit card (error: cannotPayFromCreditCard)\n- Validates fatura exists (error: faturaNotFound)\n\n#### 6. `markFaturaUnpaid(faturaId)` - Happy Paths\n- Marks paid fatura as unpaid\n- Clears paidAt timestamp\n- Clears paidFromAccountId\n- Marks all entries in fatura as unpaid (paidAt = null)\n- Can re-mark as paid after marking unpaid\n\n### Integration Tests\n\n#### 1. Expense-Fatura Lifecycle\n- Create expense → fatura created → expense deleted → fatura total updated\n- Update expense → fatura total recalculated\n- Entry moves between faturas (date change) → both faturas updated\n\n#### 2. Payment-Repayment Cycle\n- Pay fatura → verify all entries marked paid\n- Mark unpaid → verify all entries marked pending\n- Pay again → verify works correctly\n\n#### 3. Multiple Faturas Same Month\n- Multiple credit cards with expenses in same month\n- Verify each fatura has correct total\n- Pay one fatura → doesn't affect other faturas\n- Verify account isolation\n\n#### 4. Fatura with Zero Total\n- Fatura created but all entries deleted\n- Verify totalAmount is 0\n- Can still be paid (edge case, should work)\n- Verify display handles zero correctly\n\n#### 5. User Isolation\n- Create faturas for different users with same accounts (different userId)\n- Query by user → returns only user's faturas\n- Verify no data leakage\n\n### Data Integrity Tests\n\n#### 1. Cascade Deletion\n- Delete account → all faturas cascade deleted\n- Verify foreign key constraint works\n\n#### 2. Fatura Uniqueness\n- Try to create duplicate fatura for same account+month\n- Verify unique constraint prevents duplicates\n\n#### 3. Entry-Fatura Consistency\n- Entries must have faturaMonth matching account billing logic\n- Verify updateFaturaTotal uses correct faturaMonth filter\n- Test edge cases around closing day\n\n### Test File Location\n`/test/lib/actions/faturas.test.ts`\n\n### Implementation Notes\n- Use existing fixtures (creditCardWithBilling)\n- Mock auth with test user ID\n- Use in-memory PGlite database\n- Test billing cycle logic extensively (critical for faturas)\n- Verify fatura total calculations match entry sums\n- Follow pattern from expenses.test.ts\n","created_at":"2026-01-05T13:40:39Z"}]}
{"id":"northstar-x3o","title":"Locale-safe currency parsing for inputs and CSV imports","description":"displayToCents uses parseFloat and CSV parsers expect '.' decimals. In pt-BR inputs/exports with commas or thousand separators, amounts parse incorrectly (cents drift or truncation). Add robust parsing/sanitization for BRL formats across UI inputs and import parsers.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-14T06:01:30.052776-03:00","created_by":"caiodgallo","updated_at":"2026-01-14T08:20:39.087528-03:00","closed_at":"2026-01-14T07:12:14.163381-03:00"}
{"id":"northstar-xr3","title":"Phase 2: Translate login page (/app/(auth)/login/page.tsx)","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-05T07:06:15.839799-03:00","created_by":"caiodgallo","updated_at":"2026-01-05T07:10:52.118484-03:00","closed_at":"2026-01-05T07:10:52.118484-03:00","close_reason":"Closed"}
{"id":"northstar-y2q","title":"Add default case to recurrence switch in bill-reminder-schedule","description":"Switch statement for recurrenceType advancement lacks default case.\n\nLocation: lib/bill-reminder-schedule.ts:59-75\n\nImpact: Unknown recurrence types only advance +1 second instead of proper skip-ahead, causing performance issues (tight loop)\n\nFix: Add default case that logs error and advances by reasonable amount (e.g., 1 day) to prevent infinite loops\n\nFound by: silent-failure-hunter agent\nConfidence: HIGH","status":"closed","priority":1,"issue_type":"bug","owner":"caiogallo88@gmail.com","created_at":"2026-01-14T15:39:18.916365-03:00","created_by":"Caio Gallo","updated_at":"2026-01-14T16:28:42.069008-03:00","closed_at":"2026-01-14T16:28:42.069008-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-y2q","depends_on_id":"northstar-dal","type":"blocks","created_at":"2026-01-14T15:39:50.926696-03:00","created_by":"Caio Gallo"}]}
{"id":"northstar-z18","title":"Fix expandOccurrences hardcoded itemType","description":"File: lib/recurrence.ts:48. Always returns itemType: 'event' regardless of actual item type. Should accept itemType as parameter.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-07T08:11:20.029141-03:00","created_by":"caiodgallo","updated_at":"2026-01-07T08:34:04.913941-03:00","closed_at":"2026-01-07T08:34:04.913941-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-z18","depends_on_id":"northstar-vau","type":"blocks","created_at":"2026-01-07T08:11:55.662018-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-z3v","title":"Clean up orphaned data when deleting events/tasks","description":"Files: lib/actions/events.ts:71-82, lib/actions/tasks.ts:71-82. When event/task deleted, recurrence rules, notification configs, and pending notification jobs are not cleaned up. Add cascade delete or manual cleanup in delete functions.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-07T08:04:21.450755-03:00","created_by":"caiodgallo","updated_at":"2026-01-07T08:29:36.568872-03:00","closed_at":"2026-01-07T08:29:36.568872-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-z3v","depends_on_id":"northstar-vau","type":"blocks","created_at":"2026-01-07T08:11:52.767513-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-z66","title":"Validate duration input to prevent NaN","description":"File: components/task-form.tsx:175. parseInt(e.target.value) can produce NaN on non-numeric input. Add validation.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-07T08:11:08.86332-03:00","created_by":"caiodgallo","updated_at":"2026-01-07T08:31:37.291326-03:00","closed_at":"2026-01-07T08:31:37.291326-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-z66","depends_on_id":"northstar-vau","type":"blocks","created_at":"2026-01-07T08:11:54.475809-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-zs6","title":"Test completeEvent and cancelEvent","description":"6 test cases: status changes, updatedAt, error handling for non-existent events","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-08T07:13:08.834559-03:00","created_by":"caiodgallo","updated_at":"2026-01-08T08:53:56.421604-03:00","closed_at":"2026-01-08T08:53:56.421604-03:00","close_reason":"Added 8 test cases covering completeEvent and cancelEvent: status changes to completed/cancelled, updatedAt verification, user ownership enforcement, non-existent event handling, and cache revalidation","dependencies":[{"issue_id":"northstar-zs6","depends_on_id":"northstar-s19","type":"blocks","created_at":"2026-01-08T07:13:26.47838-03:00","created_by":"caiodgallo"},{"issue_id":"northstar-zs6","depends_on_id":"northstar-5ad","type":"blocks","created_at":"2026-01-08T07:13:26.660842-03:00","created_by":"caiodgallo"},{"issue_id":"northstar-zs6","depends_on_id":"northstar-62p","type":"parent-child","created_at":"2026-01-08T07:13:41.644101-03:00","created_by":"caiodgallo"}]}
{"id":"northstar-zvc","title":"Make type parameter required in CalendarEventItemProps callbacks","description":"onEdit and onDelete callbacks have optional 'type' parameter but it seems necessary for routing.\n\nLocation: components/calendar/calendar-helpers.ts:23-24\n\nCurrent:\n- onEdit?: (id: number, type?: 'event' | 'task' | 'bill_reminder') =\u003e void\n- onDelete?: (id: number, type?: 'event' | 'task' | 'bill_reminder') =\u003e void\n\nIssue: Optional type parameter forces implementer to handle undefined case, weakens type safety\n\nFix: Make type required:\n- onEdit?: (id: number, type: 'event' | 'task' | 'bill_reminder') =\u003e void\n- onDelete?: (id: number, type: 'event' | 'task' | 'bill_reminder') =\u003e void\n\nFound by: type-design-analyzer agent\nConfidence: MEDIUM (check if breaking change is acceptable)","status":"closed","priority":1,"issue_type":"task","owner":"caiogallo88@gmail.com","created_at":"2026-01-14T15:45:47.699592-03:00","created_by":"Caio Gallo","updated_at":"2026-01-14T16:28:42.275329-03:00","closed_at":"2026-01-14T16:28:42.275329-03:00","close_reason":"Closed","dependencies":[{"issue_id":"northstar-zvc","depends_on_id":"northstar-dal","type":"blocks","created_at":"2026-01-14T15:47:15.910018-03:00","created_by":"Caio Gallo"}]}
